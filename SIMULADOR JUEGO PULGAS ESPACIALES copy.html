<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego Espacial â€“ Jacobo vs Pulgas Mutantes</title>
<style>
  body {
    background:#000;
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
    flex-direction:column;
    color:white;
    font-family:Arial, sans-serif;
  }
  canvas {
    border:3px solid #22d3ee;
    background: radial-gradient(circle at center, #0f172a 0%, #000 100%);
    display:none;
  }
  #menu { text-align:center; }
  button {
    margin:10px; padding:10px 20px;
    background:#22d3ee; border:none; border-radius:8px;
    font-size:18px; cursor:pointer;
  }
  button:hover { background:#0ea5e9; }
</style>
</head>
<body>
<div id="menu">
  <h1>ðŸš€ Juego Espacial â€“ Jacobo vs Pulgas</h1>
  <p>Elige un modo de juego</p>
  <button onclick="iniciarJuego(1)">ðŸŽ® 1 Jugador</button>
  <button onclick="iniciarJuego(2)">ðŸ‘¥ 2 Jugadores</button>
</div>

<canvas id="game" width="800" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function crearJugador(x,color,nombre){
  return { x:x, y:430, w:50, h:50, color:color, nombre:nombre,
           balas:[], score:0, vidas:7, disparo:false };
}

let j1, j2;
let modo = 1;
let pulgas = [];
let mutantes = [];

// === Pulgas normales ===
function crearPulga(){
  return { x:Math.random()*(canvas.width-40)+20, y:-40,
           w:40, h:40, v:2+Math.random()*2, vivo:true };
}

// === Pulga Mutante ===
function crearMutante(){
  return { x:Math.random()*(canvas.width-40)+20, y:-40,
           w:50, h:50, v:3, vivo:true, mutante:true, objetivo:null };
}

// === Controles ===
let keys = {};
document.addEventListener("keydown",e=>{ keys[e.key]=true; });
document.addEventListener("keyup",e=>{ keys[e.key]=false; });

// === Sonidos ===
let audioCtx;
function beep(freq,type,dur){
  try{
    audioCtx=audioCtx||new (window.AudioContext||window.webkitAudioContext)();
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type=type; o.frequency.value=freq;
    g.gain.value=0.001; o.connect(g); g.connect(audioCtx.destination);
    const t=audioCtx.currentTime;
    g.gain.exponentialRampToValueAtTime(0.15,t+0.01);
    g.gain.exponentialRampToValueAtTime(0.001,t+dur);
    o.start(); o.stop(t+dur);
  }catch(e){}
}
function sonidoHit(){beep(700,"triangle",0.25);}
function sonidoVida(){beep(1000,"sine",0.4);}
function sonidoMutante(){beep(200,"sawtooth",0.5);}

// === Dibujar nave ===
function drawNave(j){
  ctx.save(); ctx.translate(j.x+j.w/2,j.y+j.h/2); ctx.scale(j.w/60,j.h/60);
  ctx.fillStyle=j.color;
  ctx.beginPath(); ctx.moveTo(0,-30); ctx.lineTo(20,20); ctx.lineTo(-20,20); ctx.closePath(); ctx.fill();
  ctx.fillStyle="white"; ctx.beginPath(); ctx.arc(0,-10,6,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

// === Dibujar pulga normal ===
function drawPulga(p){
  if(!p.vivo) return;
  ctx.save(); ctx.translate(p.x,p.y);
  ctx.fillStyle="limegreen";
  ctx.beginPath(); ctx.ellipse(0,0,p.w/2,p.h/2,0,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="white"; ctx.beginPath(); ctx.arc(-8,-5,5,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(8,-5,5,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="black"; ctx.beginPath(); ctx.arc(-8,-5,2,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(8,-5,2,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

// === Dibujar pulga mutante con dientes ===
function drawMutante(m){
  if(!m.vivo) return;
  ctx.save(); ctx.translate(m.x,m.y);

  // cuerpo rojo
  ctx.fillStyle="red";
  ctx.beginPath(); ctx.ellipse(0,0,m.w/2,m.h/2,0,0,Math.PI*2); ctx.fill();

  // ojos amarillos
  ctx.fillStyle="yellow";
  ctx.beginPath(); ctx.arc(-10,-10,6,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(10,-10,6,0,Math.PI*2); ctx.fill();

  // dientes (zig-zag)
  ctx.strokeStyle="white"; ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(-12,10);
  ctx.lineTo(-8,16);
  ctx.lineTo(-4,10);
  ctx.lineTo(0,16);
  ctx.lineTo(4,10);
  ctx.lineTo(8,16);
  ctx.lineTo(12,10);
  ctx.stroke();

  ctx.restore();
}

// === Dibujar bala ===
function drawBala(b){ ctx.fillStyle=b.color; ctx.fillRect(b.x,b.y,b.w,b.h); }

// === HUD ===
function drawHUD(){
  ctx.fillStyle="white"; ctx.font="16px Arial";
  ctx.fillText(j1.nombre+" â€“ Puntos: "+j1.score+" Vidas: "+j1.vidas,20,25);
  if(modo===2){
    ctx.fillText(j2.nombre+" â€“ Puntos: "+j2.score+" Vidas: "+j2.vidas,20,50);
  }
}

// === Disparo ===
function disparar(j){
  j.balas.push({x:j.x+j.w/2-2,y:j.y-10,w:4,h:10,v:-8,color:"yellow"});
}

// === Iniciar ===
function iniciarJuego(m){
  document.getElementById("menu").style.display="none";
  canvas.style.display="block";
  modo = m;

  j1 = crearJugador(canvas.width/3,"#3b82f6","Jugador 1 (Jacobo)");
  if(modo===2){
    j2 = crearJugador(canvas.width/3*2,"#f87171","Jugador 2 (Amigo)");
  }

  pulgas=[]; for(let i=0;i<8;i++) pulgas.push(crearPulga());
  mutantes=[];
  setInterval(()=>{ mutantes.push(crearMutante()); },8000); // cada 8s
  loop();
}

// === LOOP ===
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Movimiento J1
  if(keys["ArrowLeft"]) j1.x-=6;
  if(keys["ArrowRight"]) j1.x+=6;
  if(keys[" "] && !j1.disparo){ disparar(j1); j1.disparo=true; }
  if(!keys[" "]) j1.disparo=false;
  j1.x=Math.max(0,Math.min(canvas.width-j1.w,j1.x));

  // Movimiento J2
  if(modo===2){
    if(keys["a"]||keys["A"]) j2.x-=6;
    if(keys["s"]||keys["S"]) j2.x+=6;
    if(keys["z"]||keys["Z"]){
      if(!j2.disparo){ disparar(j2); j2.disparo=true; }
    } else j2.disparo=false;
    j2.x=Math.max(0,Math.min(canvas.width-j2.w,j2.x));
  }

  // Dibujar naves
  drawNave(j1);
  if(modo===2) drawNave(j2);

  // Pulgas normales
  pulgas.forEach(p=>{
    if(p.vivo){
      p.y+=p.v;
      if(p.y>canvas.height+30){
        p.vivo=false;
        setTimeout(()=>pulgas.push(crearPulga()),1000);
      }
    }
    drawPulga(p);
  });

  // Pulgas mutantes (persiguen naves)
  mutantes.forEach(m=>{
    if(!m.vivo) return;
    let objetivo = j1;
    if(modo===2 && Math.abs(j2.x-m.x)<Math.abs(j1.x-m.x)) objetivo=j2;
    // mover hacia la nave
    m.x += (objetivo.x-m.x)*0.05;
    m.y += m.v;

    // ColisiÃ³n con nave
    [j1, ...(modo===2?[j2]:[])].forEach(j=>{
      if(m.vivo &&
        m.x < j.x+j.w && m.x+m.w > j.x &&
        m.y < j.y+j.h && m.y+m.h > j.y){
          j.vidas--; m.vivo=false; sonidoMutante();
      }
    });
    drawMutante(m);
  });

  // Balas
  [j1, ...(modo===2?[j2]:[])].forEach(j=>{
    j.balas.forEach(b=>{
      b.y+=b.v; drawBala(b);
      // ColisiÃ³n con pulgas normales
      pulgas.forEach(p=>{
        if(p.vivo &&
          b.x < p.x+p.w/2 && b.x+b.w > p.x-p.w/2 &&
          b.y < p.y+p.h/2 && b.y+b.h > p.y-p.h/2){
            p.vivo=false; b.y=-50; j.score+=100; sonidoHit();
            if(j.score % 1000===0){ j.vidas++; sonidoVida(); }
            setTimeout(()=>pulgas.push(crearPulga()),1000);
        }
      });
      // ColisiÃ³n con mutantes
      mutantes.forEach(m=>{
        if(m.vivo &&
          b.x < m.x+m.w/2 && b.x+b.w > m.x-m.w/2 &&
          b.y < m.y+m.h/2 && b.y+b.h > m.y-p.h/2){
            m.vivo=false; b.y=-50; j.score+=250; sonidoHit();
        }
      });
    });
    j.balas=j.balas.filter(b=>b.y>-20);
  });

  // HUD
  drawHUD();

  // Game Over
  if(j1.vidas<=0 || (modo===2 && j2.vidas<=0)){
    ctx.fillStyle="red"; ctx.font="40px Arial Black";
    if(modo===1){
      ctx.fillText("ðŸ’€ GAME OVER ðŸ’€",canvas.width/2-160,canvas.height/2);
    } else {
      let ganador = (j1.score===j2.score) ? "Â¡Empate!" : (j1.score>j2.score? j1.nombre+" gana ðŸŽ‰": j2.nombre+" gana ðŸŽ‰");
      ctx.fillText("Fin del Juego",canvas.width/2-100,canvas.height/2-40);
      ctx.fillText(ganador,canvas.width/2-120,canvas.height/2+10);
    }
    return;
  }

  requestAnimationFrame(loop);
}
</script>
</body>
</html>
