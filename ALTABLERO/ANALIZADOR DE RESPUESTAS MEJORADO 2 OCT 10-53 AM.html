<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analizador de Complejidad</title>

  <!-- Librer√≠as externas -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Estilos -->
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    #data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    #data-table th, #data-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    #data-table th {
      background-color: #4CAF50;
      color: white;
    }

    /* Colores por cuartil */
   .cuartil-1 { background-color: #ccffcc; }  /* f√°cil */
   .cuartil-2 { background-color: #ffffcc; }  /* medio-bajo */
   .cuartil-3 { background-color: #f8c837; }  /* medio-alto */
   .cuartil-4 { background-color: #f6c4c4; }  /* dif√≠cil */

    #chart-container {
      width: 100%;
      height: 400px;
      margin-top: 20px;
    }

    #legend {
      margin-top: 10px;
      text-align: center;
      font-weight: bold;
    }

    #summary {
      margin-top: 20px;
      font-weight: bold;
    }

    #myChart {
      display: block;
      margin: 0 auto;
      background-color: white;
    }

    button {
      background-color: #f0f0f0;
      color: #000;
      border: 1px solid #a0a0a0;
      padding: 6px 14px;
      margin: 4px 3px;
      font-size: 13px;
      font-family: system-ui, sans-serif;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    button:hover { background-color: #e0e0e0; }
    button:active { background-color: #d0d0d0; }

    #input-section {
      display: none;
      margin-bottom: 10px;
    }

    /* Explicaci√≥n */
    #complexity-explanation {
      margin-top: 30px;
      padding: 20px;
      background-color: #f9f9ff;
      border: 2px solid #cce;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-size: 14.5px;
    }
    #complexity-explanation h3 { margin-top: 0; color: #333399; }
    #complexity-explanation ul { margin-left: 20px; }
    #complexity-explanation table {
      border-collapse: collapse;
      width: 80%;
      margin: 15px auto;
      background-color: #fff;
      border: 1px solid #bbb;
    }
    #complexity-explanation th, #complexity-explanation td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    #complexity-explanation th {
      background-color: #e0e0ff;
      color: #333;
    }

    /* Modal */
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);}
    .modal-content {
      background-color: #fff; margin: 10% auto; padding: 20px; border: 2px solid #888;
      border-radius: 8px; width: 70%; max-width: 700px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
    .close:hover { color: #000; }
    #exampleData {
      text-align: left; background: #f9f9f9; padding: 10px; border-radius: 6px; border: 1px solid #ddd; max-height: 300px; overflow-y: auto;
    }
  </style>
</head>

<body>
  <h2>Ingrese la evaluaci√≥n en el formato adecuado</h2>
  <button onclick="toggleInput()">üìÇ Abrir √Årea de Texto</button>
  <div id="input-section">
    <textarea id="input-text" rows="20" cols="100" placeholder="Pegue aqu√≠ la evaluaci√≥n..."></textarea><br>
    <input type="file" id="file-input" accept=".txt">
  </div>

  <button onclick="generateTable()">Generar Tabla</button>
  <button id="sortComplexityBtn" onclick="sortTableByCuartil()">üîΩ Ordenar por Cuartil (4 ‚Üí 1)</button>
  <button onclick="downloadTableAsXLSX()">Descargar Tabla en XLSX</button>
  <button onclick="downloadTableAsImage()">Descargar Tabla como Imagen</button>
  <button onclick="clearInputs()">Limpiar Todo</button>
  <button onclick="createChart()">Crear Gr√°fico de Barras</button>
  <button onclick="downloadChartAsImage()">Descargar Gr√°fico de Barras</button>
  <button onclick="createDoughnutChart()">Crear Gr√°fico Circular</button>
  <button onclick="downloadDoughnutChartAsImage()">Descargar Gr√°fico Circular como Imagen</button>
  <button onclick="openExampleModal()">üìñ Ver Ejemplo de Datos</button>

  <!-- Modal -->
  <div id="exampleModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeExampleModal()">&times;</span>
      <h3>Ejemplo de Datos a Pegar</h3>
      <pre id="exampleData">
Range   Mean   Median   Standard Deviation   Variance
From    To
1       10     82,50   83,00   4,75   22,56
11      20     70,20   71,00   6,40   40,96
21      30     55,80   56,00   7,10   50,41
31      40     43,60   44,00   8,30   68,89
41      50     28,90   29,00   9,50   90,25
      </pre>
      <button onclick="copyExample()">üìã Copiar Ejemplo</button>
    </div>
  </div>

  <h2>Tabla Generada</h2>
  <table id="data-table">
    <thead>
      <tr>
        <th>Pregunta</th>
        <th>Promedio</th>
        <th>Mediana</th>
        <th>Desviaci√≥n est√°ndar</th>
        <th>Varianza</th>
        <th>Cuartil</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<div style="margin-top:10px; font-weight:bold; text-align:center;">
  <span style="background:#ccffcc; padding:4px 10px;">Cuartil 1 (f√°cil)</span>
  <span style="background:#ffffcc; padding:4px 10px;">Cuartil 2</span>
  <span style="background:#f8c837; padding:4px 10px;">Cuartil 3</span>
  <span style="background:#f6c4c4; padding:4px 10px;">Cuartil 4 (dif√≠cil)</span>
</div>




  <div id="summary"></div>
  <div id="complexity-explanation"></div>

  <div style="text-align: center; margin-top: 20px;">
    <button id="downloadBothBtn" onclick="downloadBothCharts()" style="display: none;">üì• Descargar Ambos Gr√°ficos</button>
  </div>

  <div id="charts-container" style="display: flex; justify-content: center; gap: 30px; margin-top: 20px;">
    <div id="chart-container" style="overflow-x: auto;">
      <canvas id="myChart" style="width: 100%;"></canvas>
      <div id="legend" style="text-align: center; display: none;">Promedio por Preguntas</div>
    </div>
    <div>
      <canvas id="doughnutChart" width="350" height="350" style="display: none;"></canvas>
      <div id="doughnut-legend" style="text-align: center; display: none;">Porcentaje seg√∫n Cuartil</div>
    </div>
  </div>



<script>

let currentSortMode = "original";  // original | asc | desc
let originalOrder = []; // Para guardar el orden original

let barChartReady = false;
let doughnutChartReady = false;

const fileInput = document.getElementById("file-input");
fileInput.addEventListener("change", function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById("input-text").value = e.target.result;
        }
        reader.readAsText(file);
    }
});

function calculateComplexityLevels(meanValues) {
    const sorted = [...meanValues].sort((a, b) => a - b);
    const q1 = sorted[Math.floor(sorted.length * 0.25)];
    const q2 = sorted[Math.floor(sorted.length * 0.50)];
    const q3 = sorted[Math.floor(sorted.length * 0.75)];
    return { q1, q2, q3 };
}

function generateTable() {
    const inputText = document.getElementById("input-text").value.trim();
    const lines = inputText.split("\n").map(l => l.trim()).filter(l => l.length > 0);
    const tableBody = document.querySelector("#data-table tbody");
    tableBody.innerHTML = "";

    // Ignorar las 2 primeras l√≠neas (encabezados)
    const dataLines = lines.slice(2);

    let cuartil1 = 0, cuartil2 = 0, cuartil3 = 0, cuartil4 = 0;
    let questionCount = 0;
    let meanValues = [];

    // Extraer promedios
    dataLines.forEach(line => {
        const parts = line.split(/\s+/);
        const mean = parseFloat(parts[2].replace(",", "."));
        meanValues.push(mean);
    });

    // Calcular cuartiles
    const { q1, q2, q3 } = calculateComplexityLevels(meanValues);

    // Procesar fila por fila
    dataLines.forEach((line, i) => {
        const parts = line.split(/\s+/);

        const mean = parseFloat(parts[2].replace(",", "."));
        const median = parseFloat(parts[3].replace(",", "."));
        const stdDev = parseFloat(parts[4].replace(",", "."));
        const variance = parseFloat(parts[5].replace(",", "."));

        let cuartil, clase;
        if (mean > q3) {
            cuartil = "Cuartil 1 (m√°s f√°cil)"; clase = "cuartil-1"; cuartil1++;
        } else if (mean > q2) {
            cuartil = "Cuartil 2"; clase = "cuartil-2"; cuartil2++;
        } else if (mean > q1) {
            cuartil = "Cuartil 3"; clase = "cuartil-3"; cuartil3++;
        } else {
            cuartil = "Cuartil 4 (m√°s dif√≠cil)"; clase = "cuartil-4"; cuartil4++;
        }

        const row = document.createElement("tr");
        row.classList.add(clase);
        row.innerHTML = `
            <td>Pregunta ${i+1}</td>
            <td>${mean.toFixed(2)}</td>
            <td>${median.toFixed(2)}</td>
            <td>${stdDev.toFixed(2)}</td>
            <td>${variance.toFixed(2)}</td>
            <td>${cuartil}</td>
        `;
        tableBody.appendChild(row);
        questionCount++;
    });

    document.getElementById("summary").innerText =
        `Total: ${questionCount} preguntas | Cuartil 1 (f√°cil): ${cuartil1} | Cuartil 2: ${cuartil2} | Cuartil 3: ${cuartil3} | Cuartil 4 (dif√≠cil): ${cuartil4}`;

    // Guardar orden original
    originalOrder = Array.from(document.querySelectorAll("#data-table tbody tr")).map(row => row.cloneNode(true));
    currentSortMode = "original";

    // Mostrar la leyenda de colores si estaba oculta
    document.querySelector("div[style*='margin-top:10px']").style.display = "block";

    // Construir explicaci√≥n de cuartiles
    buildComplexityExplanation(meanValues);
}

function buildComplexityExplanation(meanValues) {
    const sorted = [...meanValues].sort((a, b) => a - b);
    const q1 = sorted[Math.floor(sorted.length * 0.25)];
    const q2 = sorted[Math.floor(sorted.length * 0.50)];
    const q3 = sorted[Math.floor(sorted.length * 0.75)];

    const explanationHTML = `
        <h3>üìò Explicaci√≥n de los Cuartiles de Dificultad</h3>
        <p>Las preguntas se clasifican en <strong>cuatro cuartiles estad√≠sticos</strong>, con base en el <strong>promedio de aciertos</strong> 
        de los estudiantes. Esto permite ver la <strong>dificultad relativa</strong> de cada √≠tem:</p>
        <ul>
            <li><strong>Cuartil 1 (m√°s f√°cil):</strong> Preguntas con los <strong>promedios m√°s altos</strong>.</li>
            <li><strong>Cuartil 2:</strong> Dificultad media-baja.</li>
            <li><strong>Cuartil 3:</strong> Dificultad media-alta.</li>
            <li><strong>Cuartil 4 (m√°s dif√≠cil):</strong> Preguntas con los <strong>promedios m√°s bajos</strong>.</li>
        </ul>

        <p><strong>Rangos definidos din√°micamente en esta evaluaci√≥n:</strong></p>
        <table border="1" style="width: 80%; margin: auto; text-align: center; border-collapse: collapse;">
            <thead style="background-color: #f0f0f0;">
                <tr>
                    <th>Cuartil</th>
                    <th>Rango de Promedio</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Cuartil 4 (m√°s dif√≠cil)</td><td>Promedio ‚â§ ${q1.toFixed(2)}</td></tr>
                <tr><td>Cuartil 3</td><td>${q1.toFixed(2)} &lt; Promedio ‚â§ ${q2.toFixed(2)}</td></tr>
                <tr><td>Cuartil 2</td><td>${q2.toFixed(2)} &lt; Promedio ‚â§ ${q3.toFixed(2)}</td></tr>
                <tr><td>Cuartil 1 (m√°s f√°cil)</td><td>Promedio &gt; ${q3.toFixed(2)}</td></tr>
            </tbody>
        </table>
    `;

    document.getElementById("complexity-explanation").innerHTML = explanationHTML;

    // Guardar tabla para exportar a Excel
    window.explanationTableForExcel = [
        ["Cuartil", "Rango de Promedio"],
        [`Cuartil 4 (m√°s dif√≠cil)`, `Promedio ‚â§ ${q1.toFixed(2)}`],
        [`Cuartil 3`, `${q1.toFixed(2)} < Promedio ‚â§ ${q2.toFixed(2)}`],
        [`Cuartil 2`, `${q2.toFixed(2)} < Promedio ‚â§ ${q3.toFixed(2)}`],
        [`Cuartil 1 (m√°s f√°cil)`, `Promedio > ${q3.toFixed(2)}`]
    ];
}

// ‚úÖ Ordenar por cuartil
function sortTableByCuartil() {
    const tableBody = document.querySelector("#data-table tbody");
    const rows = Array.from(tableBody.rows);
    const sortBtn = document.getElementById("sortComplexityBtn");

    const cuartilOrder = {
        "Cuartil 1 (m√°s f√°cil)": 1,
        "Cuartil 2": 2,
        "Cuartil 3": 3,
        "Cuartil 4 (m√°s dif√≠cil)": 4
    };

    if (currentSortMode === "original" || currentSortMode === "asc") {
        currentSortMode = "desc";
        sortBtn.innerText = "üîΩ Ordenar por Cuartil (4 ‚Üí 1)";
        rows.sort((a, b) => cuartilOrder[b.cells[5].innerText.trim()] - cuartilOrder[a.cells[5].innerText.trim()]);
    } else {
        currentSortMode = "asc";
        sortBtn.innerText = "üîº Ordenar por Cuartil (1 ‚Üí 4)";
        rows.sort((a, b) => cuartilOrder[a.cells[5].innerText.trim()] - cuartilOrder[b.cells[5].innerText.trim()]);
    }

    tableBody.innerHTML = "";
    rows.forEach(row => tableBody.appendChild(row));
}



// üëá Pega esto fuera de cualquier otra funci√≥n
function downloadTableAsXLSX() {
    const tableBody = document.querySelector("#data-table tbody");
    if (tableBody.rows.length === 0) {
        alert("Primero genere la tabla.");
        return;
    }

    const wb = XLSX.utils.book_new();

    const headers = ["Pregunta", "Promedio", "Mediana", "Desviaci√≥n est√°ndar", "Varianza", "Cuartil", "Visual"];
    const data = [headers];

    let cuartil1 = 0, cuartil2 = 0, cuartil3 = 0, cuartil4 = 0;

    const rows = Array.from(tableBody.rows);
    rows.forEach(row => {
        const cells = Array.from(row.cells).map(cell => cell.innerText);
        const cuartil = cells[5];
        let icono = "";

        if (cuartil.includes('Cuartil 4')) {
            icono = "‚ö´"; cuartil4++;
        } else if (cuartil.includes('Cuartil 3')) {
            icono = "‚ö™"; cuartil3++;
        } else if (cuartil.includes('Cuartil 2')) {
            icono = "‚óê"; cuartil2++;
        } else if (cuartil.includes('Cuartil 1')) {
            icono = "‚óâ"; cuartil1++;
        }

        cells.push(icono);
        data.push(cells);
    });

    const ws1 = XLSX.utils.aoa_to_sheet(data);
    XLSX.utils.book_append_sheet(wb, ws1, "Tabla de Preguntas");

    const total = cuartil1 + cuartil2 + cuartil3 + cuartil4;
    const resumenData = [
        ["Cuartil de Dificultad", "Cantidad de Preguntas", "Visual", "Porcentaje"],
        ["Cuartil 4 (M√°s dif√≠cil)", cuartil4, "‚ö´", `${((cuartil4 / total) * 100).toFixed(2)}%`],
        ["Cuartil 3", cuartil3, "‚ö™", `${((cuartil3 / total) * 100).toFixed(2)}%`],
        ["Cuartil 2", cuartil2, "‚óê", `${((cuartil2 / total) * 100).toFixed(2)}%`],
        ["Cuartil 1 (M√°s f√°cil)", cuartil1, "‚óâ", `${((cuartil1 / total) * 100).toFixed(2)}%`],
        ["Total", total, "", "100%"]
    ];

    const ws2 = XLSX.utils.aoa_to_sheet(resumenData);
    XLSX.utils.book_append_sheet(wb, ws2, "Resumen de Cuartiles");

    // Hoja con explicaci√≥n textual
    if (window.explanationTableForExcel) {
        const ws3 = XLSX.utils.aoa_to_sheet(window.explanationTableForExcel);
        XLSX.utils.book_append_sheet(wb, ws3, "Explicaci√≥n Cuartiles");
    }

    const fecha = new Date().toISOString().split("T")[0];
    XLSX.writeFile(wb, `tabla_cuartiles_${fecha}.xlsx`);
}



function downloadTableAsImage() {
    
    const tableBody = document.querySelector("#data-table tbody");
    if (tableBody.rows.length === 0) {
        alert("Primero genere la tabla.");
        return;
    }
    
    const table = document.getElementById("data-table");
    html2canvas(table).then(canvas => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = "tabla_cuartiles.png";
        link.click();
    });
}

function clearInputs() {
    document.getElementById("input-text").value = "";
    document.querySelector("div[style*='margin-top:10px']").style.display = "none";
    document.getElementById("summary").innerText = "";

    // Ocultar gr√°fico de barras y leyenda
    document.getElementById("myChart").style.display = 'none';
    document.getElementById("legend").style.display = 'none';

    // Ocultar gr√°fico circular y su leyenda
    document.getElementById("doughnutChart").style.display = 'none';
    document.getElementById("doughnut-legend").style.display = 'none';

    // Ocultar bot√≥n de descarga de ambos gr√°ficos
    document.getElementById("downloadBothBtn").style.display = "none";

    // Ocultar el √°rea de texto
    document.getElementById("input-section").style.display = "none";

    // Limpiar explicaci√≥n de complejidad (Tabla 2)
    document.getElementById("complexity-explanation").innerHTML = "";

    // Reiniciar banderas de estado
    barChartReady = false;
    doughnutChartReady = false;
}


function createChart() {
    const tableBody = document.querySelector("#data-table tbody");
    if (tableBody.rows.length === 0) {
        alert("Primero genere la tabla.");
        return;
    }

    const canvas = document.getElementById("myChart");
    const container = document.getElementById("chart-container");
    const ctx = canvas.getContext("2d");

    // Mostrar elementos
    canvas.style.display = 'block';
    document.getElementById("legend").style.display = 'block';

    const totalPreguntas = tableBody.rows.length;
    const minBarWidth = 40;
    const baseHeight = 400;

    // Ajustar dimensiones din√°micas
    const newCanvasWidth = Math.max(container.offsetWidth, totalPreguntas * minBarWidth);
    const newCanvasHeight = totalPreguntas > 25 ? 500 : baseHeight;
    canvas.width = newCanvasWidth;
    canvas.height = newCanvasHeight;

    // Destruir gr√°fico anterior si existe
    if (window.chartInstance) {
        window.chartInstance.destroy();
    }

    // Extraer datos
    const labels = [], data = [], colors = [];
    for (const row of tableBody.rows) {
        labels.push(row.cells[0].innerText);
        data.push(parseFloat(row.cells[1].innerText));
        const cuartil = row.cells[5].innerText.trim();

        if (cuartil.includes('Cuartil 4')) colors.push('#ff9999');      // rojo claro
        else if (cuartil.includes('Cuartil 3')) colors.push('#ffcc99'); // naranja
        else if (cuartil.includes('Cuartil 2')) colors.push('#ffff99'); // amarillo
        else if (cuartil.includes('Cuartil 1')) colors.push('#ccffcc'); // verde claro
        else colors.push('#dddddd'); // fallback gris
    }

    // Crear gr√°fico
    window.chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: colors,
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                },
                x: {
                    ticks: {
                        maxRotation: totalPreguntas > 15 ? 60 : 0,
                        minRotation: totalPreguntas > 15 ? 45 : 0,
                        autoSkip: false
                    }
                }
            },
            plugins: {
                legend: { display: false },
                title: {
                    display: true,
                    text: `Pregunta seg√∫n Cuartil (n=${totalPreguntas})`,
                    font: {
                        size: 23,
                        weight: 'bold'
                    },
                    padding: { top: 10, bottom: 20 }
                },
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: value => value.toFixed(2),
                    font: {
                        weight: 'bold',
                        size: 12
                    },
                    color: '#000'
                }
            }
        },
        plugins: [ChartDataLabels]
    });

    barChartReady = true;
    checkIfBothChartsReady();
}


function downloadChartAsImage() {
    const tableBody = document.querySelector("#data-table tbody");
    if (tableBody.rows.length === 0) {
        alert("Primero genere la tabla.");
        return;
    }

    const canvas = document.getElementById("myChart");

    // Crear un nuevo canvas auxiliar con fondo blanco
    const backgroundCanvas = document.createElement("canvas");
    backgroundCanvas.width = canvas.width;
    backgroundCanvas.height = canvas.height;

    const ctx = backgroundCanvas.getContext("2d");

    // Fondo blanco
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, backgroundCanvas.width, backgroundCanvas.height);

    // Dibujar el gr√°fico encima
    ctx.drawImage(canvas, 0, 0);

    // Crear enlace de descarga
    const link = document.createElement("a");
    link.href = backgroundCanvas.toDataURL("image/png");
    link.download = "grafico_cuartiles.png";
    link.click();
}


let doughnutChartInstance = null;

// REGISTRO DEL PLUGIN (agrega esto solo una vez en tu c√≥digo, idealmente al inicio)
Chart.register(ChartDataLabels);

function createDoughnutChart() {
    const tableBody = document.querySelector("#data-table tbody");
    if (tableBody.rows.length === 0) {
        alert("Primero genere la tabla.");
        return;
    }

    let cuartil1 = 0, cuartil2 = 0, cuartil3 = 0, cuartil4 = 0;

    for (const row of tableBody.rows) {
        const cuartil = row.cells[5].innerText.trim();
        if (cuartil.includes('Cuartil 1')) cuartil1++;
        else if (cuartil.includes('Cuartil 2')) cuartil2++;
        else if (cuartil.includes('Cuartil 3')) cuartil3++;
        else if (cuartil.includes('Cuartil 4')) cuartil4++;
    }

    const data = [cuartil4, cuartil3, cuartil2, cuartil1];
    const labels = ['Cuartil 4 (dif√≠cil)', 'Cuartil 3', 'Cuartil 2', 'Cuartil 1 (f√°cil)'];
    const colors = ['#ff9999', '#ffcc99', '#ffff99', '#ccffcc'];
    const total = data.reduce((sum, value) => sum + value, 0);

    const canvas = document.getElementById("doughnutChart");
    canvas.style.display = 'block';
    const legend = document.getElementById("doughnut-legend");
    legend.innerHTML = "<strong>Porcentaje seg√∫n Cuartil</strong>";
    legend.style.display = 'block';

    // Ajustar altura al gr√°fico de barras
    const barCanvas = document.getElementById("myChart");
    canvas.height = barCanvas.height;

    const ctx = canvas.getContext("2d");

    if (window.doughnutChartInstance) {
        window.doughnutChartInstance.destroy();
    }

    window.doughnutChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: colors,
                borderColor: '#ffffff',
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            const count = context.parsed;
                            const percent = ((count / total) * 100).toFixed(1);
                            return `${context.label}: ${count} (${percent}%)`;
                        }
                    }
                },
                datalabels: {
                    color: '#000',
                    font: {
                        weight: 'bold',
                        size: 14
                    },
                    formatter: function (value) {
                        const percent = ((value / total) * 100).toFixed(1);
                        return `${percent}% (${value})`;
                    }
                }
            }
        },
        plugins: [ChartDataLabels]
    });

    alert("Gr√°fico circular creado correctamente.");
    doughnutChartReady = true;
    checkIfBothChartsReady();
}




function downloadDoughnutChartAsImage() {
    const tableBody = document.querySelector("#data-table tbody");
    if (tableBody.rows.length === 0) {
        alert("Primero genere la tabla.");
        return;
    }

    const canvas = document.getElementById("doughnutChart");

    // Crear un nuevo canvas auxiliar con fondo blanco
    const backgroundCanvas = document.createElement("canvas");
    backgroundCanvas.width = canvas.width;
    backgroundCanvas.height = canvas.height;

    const ctx = backgroundCanvas.getContext("2d");
    ctx.fillStyle = "#ffffff"; // fondo blanco
    ctx.fillRect(0, 0, backgroundCanvas.width, backgroundCanvas.height);
    ctx.drawImage(canvas, 0, 0);

    const link = document.createElement("a");
    link.href = backgroundCanvas.toDataURL("image/png");
    link.download = "grafico_cuartiles.png";
    link.click();
}

   

function downloadBothCharts() {
    
       const tableBody = document.querySelector("#data-table tbody");
    if (tableBody.rows.length === 0) {
        alert("Primero genere la tabla.");
        return;
    }
    
    const barCanvas = document.getElementById("myChart");
    const doughnutCanvas = document.getElementById("doughnutChart");

    // Crear canvas combinado
    const combinedCanvas = document.createElement("canvas");
    const spacing = 50;
    const width = barCanvas.width + doughnutCanvas.width + spacing;
    const height = Math.max(barCanvas.height, doughnutCanvas.height);

    combinedCanvas.width = width;
    combinedCanvas.height = height;
    const ctx = combinedCanvas.getContext("2d");

    // Fondo blanco
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, width, height);

    // Dibujar ambos gr√°ficos
    ctx.drawImage(barCanvas, 0, 0);
    ctx.drawImage(doughnutCanvas, barCanvas.width + spacing, 0);

    // Descargar
    const link = document.createElement("a");
    link.href = combinedCanvas.toDataURL("image/png");
    link.download = "graficos_cuartiles.png";
    link.click();
}

function toggleInput() {
    const inputSection = document.getElementById("input-section");
    const currentDisplay = window.getComputedStyle(inputSection).display;
    inputSection.style.display = currentDisplay === "none" ? "block" : "none";
}




function checkIfBothChartsReady() {
    const downloadBtn = document.getElementById("downloadBothBtn");
    if (barChartReady && doughnutChartReady) {
        downloadBtn.style.display = "inline-block";
    } else {
        downloadBtn.style.display = "none";
    }
}


function openExampleModal() {
  document.getElementById("exampleModal").style.display = "block";
}

function closeExampleModal() {
  document.getElementById("exampleModal").style.display = "none";
}

function copyExample() {
  const exampleText = document.getElementById("exampleData").innerText;
  navigator.clipboard.writeText(exampleText).then(() => {
    document.getElementById("input-text").value = exampleText; // pegar en textarea
    alert("Ejemplo copiado y pegado en el √°rea de texto ‚úÖ");
    closeExampleModal();
  });
}

</script>

</body>
</html> 