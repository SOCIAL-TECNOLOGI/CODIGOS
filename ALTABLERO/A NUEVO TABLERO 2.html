<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galería de Imágenes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
       #lienzo {
            border: 1px solid #107c8a;
            background-color: #107c8a;
            cursor: crosshair;
        }

        #tools {
            margin-top: 10px;
        }

        #imageContainer {
            text-align: center;
            margin-top: 10px;
        }


    /* CONTENEDOR FLOTANTE Y ARRASTRABLE*/
        #floatingMenu {
    position: fixed; /* Cambiado a 'fixed' para mantener la posición incluso al desplazarse */
    top: 180px;
    left: 20px;
    display: flex;
    flex-direction: column;
    background-color: #fff;
    border: 1px solid #000;
    padding: 10px;
    cursor: grab; /* Cambia el cursor al símbolo de agarre */
    z-index: 2;
    border-radius: 5px; /* Añadido un borde redondeado */
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2); /* Añadida una sombra para resaltar el menú */
    transition: background-color 0.3s ease; /* Agregada transición para cambios suaves de color */
}

#floatingMenu:hover {
    background-color: #f8f8f8; /* Cambia el color de fondo al pasar el ratón sobre el menú */
}

#floatingMenu button {
    margin: 5px;
    cursor: pointer;
    background-color: #326c92; /* Color de fondo base para los botones */
    color: #fff; /* Color de texto para los botones */
    border: none;
    padding: 8px;
    border-radius: 3px;
    transition: background-color 0.3s ease; /* Agregada transición para cambios suaves de color */
}

#floatingMenu button:hover {
    background-color: #4CAF50; /* Cambia el color de fondo al pasar el ratón sobre los botones */
}

#floatingMenu button i {
    margin-right: 5px;
}


    
        #iconColorMenu {
        /* Estilo del menú de cambio de color del ícono (inicialmente oculto) */
        display: none;
        flex-direction: row; /* Alinea los elementos en fila (horizontalmente) */
    }


    /* CUADROS DE COLOR DE FONDO*/
    .colorSquare {
        width: 20px;
        height: 20px;
        margin-right: 5px;
        cursor: pointer;
    }


    .colorDroplet {
        width: 0;
        height: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        border-bottom: 30px solid; /* Altura del cuadro-gota de agua */
        margin-right: 5px;
        cursor: pointer;
    }


/* Estilo del menú de cambio de color del trazo (inicialmente oculto) */
#strokeColorMenu {
            display: none;
            flex-direction: row;
        }


        
 /* CUADROS DE COLOR DEL TRAZO*/
        .strokeColorSquare {
            width: 12px;
            height: 12px;
            margin-right: 5px;
            cursor: pointer;
            border: 1px solid #000;
        }

 /* CUADROS DE COLOR DEL FONDO*/
#colorPicker {
    width: 12px; /* Ajusta el tamaño según tus preferencias */
    height: 12px; /* Ajusta la altura según tus preferencias */
    margin: 0 5px; /* Ajusta el margen según tus preferencias */
    border: 1px solid #000;
}

#colorPickerBtn {
    display: flex;
    margin: 0 5px; /* Ajusta el margen según tus preferencias */
}

/* MENÚ VERDE HERRAMIENTAS */

.dropdown {
    position: relative;
    display: inline-block;
}

.dropbtn {
    background-color: #4CAF50;
    color: white;
    padding: 8px;
    font-size: 16px;
    border: none;
    cursor: pointer;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
    z-index: 1;
}

.dropdown-content button {
    display: block;
    width: 100%;
    padding: 8px;
    text-align: left;
}

.dropdown-content button:hover {
    background-color: #ddd;
}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #3e8e41;
}


    </style>
</head>
<body>

  
    <!-- MENÚ FLOTANTE-->
    <div id="floatingMenu">

   <!-- Otros botones de menú aquí  -->
   
   

                <!-- MENÚ DE HERAMIENTAS-->
            <div class="dropdown">



                
                <button class="dropbtn" onclick="toggleColorPickerMenu()">
                    <i class="fas fa-sliders-h"></i>
                </button>
                <div id="colorPickerMenu" class="dropdown-content">
                    <input type="color" id="colorPicker" value="#000000" style="display: none;">
                    <button onclick="mostrarSelectorColor()">
                        <i class="fas fa-palette"></i>
                    </button>
                     
<!-- GROSOR -->
<button onclick="mostrarOcultarGrosor()">
    <i class="fas fa-sliders-h"></i> Ajustar Grosor
</button>

<!-- Contenedor para la barra de grosor -->
<div id="grosorContainer" style="display: none;">
    <label for="thickness">Grosor:</label>
    <input type="range" id="thickness" min="1" max="150" value="2" oninput="cambiarGrosor()">
</div>

<!-- COLOR DEL TRAZO -->
<button onclick="toggleStrokeColorMenu(event)"><i class="fas fa-paint-brush"></i></button>
<!-- Menú de cambio de color del trazo -->
<div id="strokeColorMenu">
        <!-- Colores para el trazo -->
        <div class="strokeColorSquare" style="background-color: #0000ff;" onclick="cambiarColorTrazo('#0000ff')"></div>
        <div class="strokeColorSquare" style="background-color: #ff0000;" onclick="cambiarColorTrazo('#ff0000')"></div>
        <div class="strokeColorSquare" style="background-color: #00ff00;" onclick="cambiarColorTrazo('#00ff00')"></div>
        <div class="strokeColorSquare" style="background-color: #ffdd00;" onclick="cambiarColorTrazo('#ffDD00')"></div>
        <div class="strokeColorSquare" style="background-color: #00fff2;" onclick="cambiarColorTrazo('#00fff2')"></div>
        <div class="strokeColorSquare" style="background-color: #f941c5;" onclick="cambiarColorTrazo('#d000ff')"></div>
        <div class="strokeColorSquare" style="background-color: #f6ff00;" onclick="cambiarColorTrazo('#f6ff00')"></div>
        <div class="strokeColorSquare" style="background-color: #7300ff;" onclick="cambiarColorTrazo('#7300ff')"></div>
        <div class="strokeColorSquare" style="background-color: #a9a89d;" onclick="cambiarColorTrazo('#aeb0ae')"></div>
        <div class="strokeColorSquare" style="background-color: #906c5d;" onclick="cambiarColorTrazo('#906c5d')"></div>
        <div class="strokeColorSquare" style="background-color: #ffffff;" onclick="cambiarColorTrazo('#ffffff')"></div>
        <div class="strokeColorSquare" style="background-color: #000000;" onclick="cambiarColorTrazo('#000000')"></div>
</div>

                    <!-- COLOR DE FONDO -->
                    <div class="fondo">

                        <button onclick="toggleIconColorMenu()"><i class="fas fa-fill-drip"></i></button>
                        <div id="iconColorMenu" style="display: none;" class="horizontal-menu">
                            <!-- Contenido del menú de cambio de color del ícono -->
                            <div class="colorSquare" style="background-color: #e00303;" onclick="cambiarColorFondo('#e00303')"></div>
                            <div class="colorSquare" style="background-color: #06cb2a;" onclick="cambiarColorFondo('#06cb2a')"></div>
                            <div class="colorSquare" style="background-color: #0338c9;" onclick="cambiarColorFondo('#0338c9')"></div>
                            <!-- Colores adicionales para el fondo del lienzo -->
                            <div class="colorSquare" style="background-color: #8d8d8d;" onclick="cambiarColorFondo('#8d8d8d')"></div>
                            <div class="colorSquare" style="background-color: #3c573e;" onclick="cambiarColorFondo('#3c573e')"></div>
                            <div class="colorSquare" style="background-color: #107c8a;" onclick="cambiarColorFondo('#107c8a')"></div>
                            <div class="colorSquare" style="background-color: #140265;" onclick="cambiarColorFondo('#140265')"></div>
                            <div class="colorSquare" style="background-color: #000000;" onclick="cambiarColorFondo('#000000')"></div>
                        </div>

                            <!-- RESTAURAR FONDO -->
                            <button onclick="restaurarFondoPorDefecto()"><i class="fas fa-sync"></i></button>

                            <!-- CAPTURA DEL LIENZO -->
                            <button onclick="capturarImagenLienzo()"><i class="fas fa-camera"></i></button>

                            

                    </div>
                  
                    <!-- CAPTURA DEl ESCRITORIO PC -->
                    <button onclick="capturarPantalla()"><i class="fas fa-desktop"></i></button>
                
                    

                   

                </div>

            



            </div>

  
             <!-- BORRADOR -->
             <button onclick="activarBorrador()"><i class="fas fa-eraser"></i></button>
              <!-- DESHACER -->
            <button onclick="deshacerTrazo()"><i class="fas fa-undo"></i></button>
             <!-- LIMPIAR LIENZO -->
            <button onclick="limpiarLienzo()"><i class="fas fa-trash-alt"></i></button>
            
     
               <!-- SUBIR IMÁGENES -->
               <button onclick="abrirCargaImagenes()">
                <i class="fas fa-image"></i>
            </button>
            <!-- RESTAURAR CONTENEDOR DE IMÁGENES -->
            <button onclick="restaurarImagenPorDefecto()"><i class="fas fa-sync"></i></button>
                 <!-- Botón de pantalla completa -->
                 <button onclick="toggleFullScreen()"><i class="fas fa-expand"></i></button>

  
</div>


    

<div id="tools">
    <!-- Resto de tu código de herramientas aquí -->

</div>


    <div id="imageAndCanvasContainer">
            <!-- Resto de tu código aquí -->
            <!-- Canvas y contenedor de imágenes -->
            <canvas id="lienzo" width="5000" height="2500"></canvas>
            <div id="imageContainer">
                <!-- Tu entrada de imagen y botones existentes aquí -->
            
            <button onclick="imagenAnterior()">Anterior</button>
            <button onclick="imagenSiguiente()">Siguiente</button>
            <img id="imagenActual" src="" alt="Imagen Actual">
            <!-- Ocultamos el campo de entrada de archivos -->
            <input type="file" id="imageInput" accept="image/*" onchange="cargarImagen(event)" multiple style="display: none;">
                    
            </div>
    </div>
      


    <script>

//FUNCIÓN LÁPIZ

        const canvas = document.getElementById('lienzo');
        const ctx = canvas.getContext('2d');
        let isErasing = false;


        // Ajustar el tamaño del lienzo al tamaño original
        canvas.width = 5000;
        canvas.height = 2500;



        let images = [];
        let currentImageIndex = -1;

        let drawing = false;
        let points = [];

        // Historial de trazos
        let trazos = [];
        let indiceTrazo = -1;

        function activarBorrador() {
    isErasing = !isErasing;
    if (isErasing) {
        ctx.globalCompositeOperation = 'destination-out';
    } else {
        ctx.globalCompositeOperation = 'source-over';
    }
}
        // Historial de trazos

        function dibujar(e) {
    if (isErasing) return;

    const color = document.getElementById('colorPicker').value;
    const thickness = document.getElementById('thickness').value;

    // Ajustar las coordenadas al tamaño real del lienzo
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    points.push({ x, y, color, thickness });

    if (points.length > 1) {
        for (let i = 1; i < points.length; i++) {
            dibujarSegmento(points[i - 1], points[i]);
        }
    }
}

function dibujarTrazos() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let i = 0; i <= indiceTrazo; i++) {
        const trazo = trazos[i];

        if (trazo.length > 1) {
            for (let j = 1; j < trazo.length; j++) {
                const start = trazo[j - 1];
                const end = trazo[j];

                dibujarSegmento(start, end);
            }
        }
    }
}


function dibujarSegmento(start, end) {
    ctx.beginPath();
    ctx.moveTo(start.x, start.y);
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';

    ctx.lineWidth = end.thickness;
    ctx.strokeStyle = end.color;

    ctx.lineTo(end.x, end.y);
    ctx.stroke();
}

function borrar(e) {
    if (!isErasing) return;

    const thickness = document.getElementById('thickness').value;

    // Ajustar las coordenadas al tamaño real del lienzo
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    ctx.clearRect(x - thickness / 2, y - thickness / 2, thickness, thickness);
}
    
function handleStart(e) {
    e.preventDefault();
    drawing = true;
    points = [];
    if (e.touches.length === 1) {
        dibujar(e.touches[0]);
        borrar(e.touches[0]);
    }
}

function handleMove(e) {
    e.preventDefault();
    if (drawing && e.touches.length === 1) {
        dibujar(e.touches[0]);
        borrar(e.touches[0]);
    }
}

function handleEnd() {
    drawing = false;

    // Almacenar el trazo actual en el historial
    if (points.length > 0) {
        trazos.push([...points]);
        indiceTrazo = trazos.length - 1;
    }
}

        canvas.addEventListener('mousedown', (e) => {
            if (e.button === 0) {
                handleStart(e);
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (e.buttons === 1) {
                handleMove(e);
            }
        });

        canvas.addEventListener('mouseup', () => {
            handleEnd();
        });

        canvas.addEventListener('touchstart', handleStart);
        canvas.addEventListener('touchmove', handleMove);
        canvas.addEventListener('touchend', handleEnd);

        // Actualizar grosor para el trazo y el borrador
        document.getElementById('thickness').addEventListener('input', () => {
            const thickness = document.getElementById('thickness').value;
            ctx.lineWidth = thickness;
        });

    

        function deshacerTrazo() {
    if (indiceTrazo >= 0) {
        // Limpiar y redibujar los trazos antes de deshacer el último
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        trazos.pop();
        indiceTrazo--;

        // Restaurar el color y grosor actual
        const colorActual = document.getElementById('colorPicker').value;
        const grosorActual = document.getElementById('thickness').value;
        points.push({ x: 0, y: 0, color: colorActual, thickness: grosorActual });

        // Redibujar los trazos restantes
        dibujarTrazos();
    }
}





//.......FUNCIÓN REHACER ............

//......FUNCIÓN REHACER.........




//..............FUNCIÓN IMÁGENES..........................

        function cargarImagen(event) {
            const input = event.target;
            const files = input.files;

            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                if (file.type.startsWith('image')) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        const img = new Image();
                        img.src = e.target.result;

                        images.push(img);

                        // Mostrar la primera imagen al cargar
                        if (currentImageIndex === -1) {
                            currentImageIndex = 0;
                            mostrarImagen();
                        }
                    };

                    reader.readAsDataURL(file);
                }
            }
        }

        function mostrarImagen() {
            if (images.length > 0) {
                const imagenActual = document.getElementById('imagenActual');
                imagenActual.src = images[currentImageIndex].src;
                document.getElementById('imageContainer').style.display = 'block';

                // Habilitar o deshabilitar botones según la cantidad de imágenes
                document.getElementById('anteriorBtn').disabled = currentImageIndex === 0;
                document.getElementById('siguienteBtn').disabled = currentImageIndex === images.length - 1;
            }
        }

        function imagenAnterior() {
            if (images.length > 1) {
                currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
                mostrarImagen();
            }
        }

        function imagenSiguiente() {
            if (images.length > 1) {
                currentImageIndex = (currentImageIndex + 1) % images.length;
                mostrarImagen();
            }
        }

        function limpiarLienzo() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Limpiar historial de trazos al limpiar el lienzo
            trazos = [];
            indiceTrazo = -1;
        }

        // Navegación con teclado
        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' && images.length > 1) {
                imagenAnterior();
            } else if (e.key === 'ArrowRight' && images.length > 1) {
                imagenSiguiente();
            }
        });

//...........................................................



//LÁPIZ Y BORRADOR SOBRE IMÁGENES



//..........................................................................

// FULL SCREEN
// ... (Tu código existente)

// Función para cambiar al modo de pantalla completa
function toggleFullScreen() {
    const canvasContainer = document.getElementById('imageAndCanvasContainer');

    if (!document.fullscreenElement) {
        canvasContainer.requestFullscreen().catch(err => {
            alert(`Error al intentar activar el modo de pantalla completa: ${err.message}`);
        });
    } else {
        document.exitFullscreen();
    }
}

// ... (Más código existente)


// ...................................

// ... FUNCIÓN CONTENEDOR FLOTANTE
// Definir variables para los menús
let colorMenuVisible = false;
let thicknessMenuVisible = false;
let canvasColorMenuVisible = false;

// Funciones para mostrar/ocultar menús
function toggleColorPicker() {
    const colorMenu = document.getElementById('colorMenu'); // Asegúrate de tener un elemento con el ID 'colorMenu'
    
    // Mostrar u ocultar el menú horizontal correspondiente
    if (!colorMenuVisible) {
        colorMenu.style.display = 'block';
    } else {
        colorMenu.style.display = 'none';
    }

    colorMenuVisible = !colorMenuVisible; // Invertir el estado de visibilidad
}

function toggleThicknessMenu() {
    const thicknessMenu = document.getElementById('thicknessMenu'); // Asegúrate de tener un elemento con el ID 'thicknessMenu'
    
    // Mostrar u ocultar el menú horizontal correspondiente
    if (!thicknessMenuVisible) {
        thicknessMenu.style.display = 'block';
    } else {
        thicknessMenu.style.display = 'none';
    }

    thicknessMenuVisible = !thicknessMenuVisible; // Invertir el estado de visibilidad
}

function toggleCanvasColorPicker() {
    const canvasColorMenu = document.getElementById('canvasColorMenu'); // Asegúrate de tener un elemento con el ID 'canvasColorMenu'
    
    // Mostrar u ocultar el menú horizontal correspondiente
    if (!canvasColorMenuVisible) {
        canvasColorMenu.style.display = 'block';
    } else {
        canvasColorMenu.style.display = 'none';
    }

    canvasColorMenuVisible = !canvasColorMenuVisible; // Invertir el estado de visibilidad
}



function cambiarColorIcono(color) {
    const icono = document.querySelector('.fa-paint-brush'); // Selecciona el ícono utilizando una clase específica
    icono.style.color = color;
}

function cambiarColorFondo(color) { //está es funcional y activa
    // Crea un nuevo lienzo temporal
    const tempCanvas = document.createElement('canvas');
    tempCanvas.width = canvas.width;
    tempCanvas.height = canvas.height;
    const tempContext = tempCanvas.getContext('2d');

    // Dibuja la imagen actual en el lienzo temporal
    tempContext.drawImage(canvas, 0, 0);

    // Cambia el color de fondo del lienzo original
    canvas.style.backgroundColor = color;

    // Dibuja la imagen del lienzo temporal en el lienzo original
    ctx.drawImage(tempCanvas, 0, 0);
}



// Función para mostrar/ocultar el menú de cambio de color del ícono
let iconColorMenuVisible = false;

function toggleIconColorMenu() {
    const iconColorMenu = document.getElementById('iconColorMenu');

    if (!iconColorMenuVisible) {
        iconColorMenu.style.display = 'flex';
    } else {
        iconColorMenu.style.display = 'none';
    }

    iconColorMenuVisible = !iconColorMenuVisible;
}



function handleScroll() {
    // Ajustar la posición del contenedor flotante según el desplazamiento vertical u horizontal
    const floatingMenu = document.getElementById('floatingMenu');
    const imageAndCanvasContainer = document.getElementById('imageAndCanvasContainer');

    floatingMenu.style.top = `${10 + imageAndCanvasContainer.scrollTop}px`;
    floatingMenu.style.left = `${10 + imageAndCanvasContainer.scrollLeft}px`;
}

// ...................................



// MENÚ MOSTRAR/OCULTAR CAMBIO DE COLOR DEL TRAZO
let strokeColorMenuVisible = false;

function toggleStrokeColorMenu() {
    const strokeColorMenu = document.getElementById('strokeColorMenu');

    if (!strokeColorMenuVisible) {
        strokeColorMenu.style.display = 'flex';
    } else {
        strokeColorMenu.style.display = 'none';
    }

    strokeColorMenuVisible = !strokeColorMenuVisible;
}

// CAMBIAR COLOR DEL TRAZO
function cambiarColorTrazo(color) {
    const colorPicker = document.getElementById('colorPicker');
    
    colorPicker.value = color;
    ctx.strokeStyle = color;
}

// RESTAURAR FONDO
function restaurarFondoPorDefecto() {
    // Restaurar el fondo del tablero por defecto
    const fondoPorDefecto = '#107c8a'; // Puedes ajustar el color según sea necesario
    cambiarColorFondo(fondoPorDefecto);
}


// RESTAURAR CONTENEDOR DE IMÁGENES
function restaurarImagenPorDefecto() {
    // Restaurar la imagen por defecto (puedes ajustar según sea necesario)
    document.getElementById('imagenActual').src = ""; // Coloca la ruta de la imagen por defecto o deja el atributo src vacío

    // Restaurar el campo de entrada de imágenes
    const inputImagen = document.getElementById('imageInput');
    inputImagen.value = ""; // Limpiar el valor del campo de entrada
}

// IMAGEN CAPTURA DEL LIENZO
function capturarImagenLienzo() {
    // Obtener el color de fondo actual
    const colorFondo = window.getComputedStyle(canvas).backgroundColor;

    // Crear un lienzo temporal con el color de fondo actual
    const lienzoTemporal = document.createElement("canvas");
    lienzoTemporal.width = canvas.width;
    lienzoTemporal.height = canvas.height;
    const contextoTemporal = lienzoTemporal.getContext("2d");
    contextoTemporal.fillStyle = colorFondo;
    contextoTemporal.fillRect(0, 0, lienzoTemporal.width, lienzoTemporal.height);

    // Dibujar la imagen del lienzo en el lienzo temporal
    contextoTemporal.drawImage(canvas, 0, 0);

    // Obtener la imagen del lienzo temporal en formato JPEG
    const imagenCapturada = lienzoTemporal.toDataURL("image/jpeg");

    // Crear un enlace de descarga
    const enlaceDescarga = document.createElement("a");
    enlaceDescarga.href = imagenCapturada;
    enlaceDescarga.download = "captura_lienzo.jpg"; // Nombre del archivo descargado

    // Hacer clic en el enlace para iniciar la descarga
    document.body.appendChild(enlaceDescarga);
    enlaceDescarga.click();
    document.body.removeChild(enlaceDescarga);
}


// IMAGEN CAPTURA DE LA VENTANA
function capturarPantalla() {
    // Obtener las dimensiones visibles del área de trabajo
    const viewportWidth = window.innerWidth || document.documentElement.clientWidth;
    const viewportHeight = window.innerHeight || document.documentElement.clientHeight;

    // Crear un lienzo temporal para combinar el contenido
    const tempCanvas = document.createElement('canvas');
    tempCanvas.width = viewportWidth;
    tempCanvas.height = viewportHeight;
    const tempContext = tempCanvas.getContext('2d');

    // Obtener el desplazamiento de la ventana
    const scrollX = window.scrollX || window.pageXOffset;
    const scrollY = window.scrollY || window.pageYOffset;

    // Dibujar el fondo actual en el lienzo temporal
    tempContext.fillStyle = window.getComputedStyle(canvas).backgroundColor;
    tempContext.fillRect(0, 0, viewportWidth, viewportHeight);

    // Dibujar los trazos visibles en el lienzo temporal
    dibujarTrazosEnContexto(tempContext, scrollX, scrollY);

    // Crear una URL de datos de la imagen combinada
    const dataURL = tempCanvas.toDataURL('image/jpeg');

    // Crear un enlace de descarga y hacer clic en él
    const enlaceDescarga = document.createElement('a');
    enlaceDescarga.href = dataURL;
    enlaceDescarga.download = 'captura_pantalla.jpg';
    enlaceDescarga.click();
}

function dibujarTrazosEnContexto(context, scrollX, scrollY) {
    for (let i = 0; i < trazos.length; i++) {
        const trazo = trazos[i];

        if (trazo.length > 1) {
            for (let j = 1; j < trazo.length; j++) {
                const start = trazo[j - 1];
                const end = trazo[j];

                // Ajustar las coordenadas de inicio y fin con el desplazamiento
                start.x -= scrollX;
                start.y -= scrollY;
                end.x -= scrollX;
                end.y -= scrollY;

                // Verificar si el segmento es visible en la ventana
                if (
                    (start.x >= 0 && start.x <= viewportWidth && start.y >= 0 && start.y <= viewportHeight) ||
                    (end.x >= 0 && end.x <= viewportWidth && end.y >= 0 && end.y <= viewportHeight)
                ) {
                    dibujarSegmentoEnContexto(context, start, end);
                }
            }
        }
    }
}

function dibujarSegmentoEnContexto(context, start, end) {
    context.beginPath();
    context.moveTo(start.x, start.y);
    context.lineCap = 'round';
    context.lineJoin = 'round';

    context.lineWidth = end.thickness;
    context.strokeStyle = end.color;

    context.lineTo(end.x, end.y);
    context.stroke();
}

// ÍCONO SUBIR IMÁGENES
function abrirCargaImagenes() {
            document.getElementById('imageInput').click();
        }

        function cargarImagen(event) {
            const input = event.target;
            const files = input.files;

            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                if (file.type.startsWith('image')) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        const img = new Image();
                        img.src = e.target.result;

                        images.push(img);

                        // Mostrar la primera imagen al cargar
                        if (currentImageIndex === -1) {
                            currentImageIndex = 0;
                            mostrarImagen();
                        }
                    };

                    reader.readAsDataURL(file);
                }
            }
        }
    
    // ÍCONO SELECTOR DE COLORES
        function mostrarSelectorColor() {
            var colorPicker = document.getElementById("colorPicker");
            colorPicker.style.display = (colorPicker.style.display === "none" || colorPicker.style.display === "") ? "inline" : "none";
        }
    // MENÚ ÍCONO DE PALETA
        function toggleColorPickerMenu() {
        var menu = document.getElementById("colorPickerMenu");
        menu.style.display = (menu.style.display === "none" || menu.style.display === "") ? "block" : "none";
    }
    
    
// ARRASTRE PARA DIV FLOTANTE

var floatingMenu = document.getElementById("floatingMenu");

// Variables para almacenar la posición inicial del mouse y la posición inicial del menú flotante
var initialX, initialY;

// Función que se activa cuando se inicia el arrastre
function dragStart(e) {
    initialX = e.clientX - floatingMenu.getBoundingClientRect().left;
    initialY = e.clientY - floatingMenu.getBoundingClientRect().top;

    // Añade eventos de escucha para el movimiento del mouse y la liberación del botón
    document.addEventListener("mousemove", dragMove);
    document.addEventListener("mouseup", dragEnd);
}

// Función que se activa durante el arrastre
function dragMove(e) {
    var currentX = e.clientX - initialX;
    var currentY = e.clientY - initialY;

    // Aplica las nuevas coordenadas al menú flotante
    floatingMenu.style.left = currentX + "px";
    floatingMenu.style.top = currentY + "px";
}

// Función que se activa al finalizar el arrastre
function dragEnd() {
    // Elimina los eventos de escucha una vez que se ha soltado el botón del mouse
    document.removeEventListener("mousemove", dragMove);
    document.removeEventListener("mouseup", dragEnd);
}

// Agrega un evento de escucha al menú flotante para iniciar el arrastre
floatingMenu.addEventListener("mousedown", dragStart);



// MENÚ CONTENEDOR DE GROSOR

// Función para mostrar u ocultar el contenedor de grosor
// Función para mostrar u ocultar el contenedor de grosor y gestionar el arrastre
function mostrarOcultarGrosor() {
    var grosorContainer = document.getElementById("grosorContainer");
    grosorContainer.style.display = grosorContainer.style.display === "none" ? "block" : "none";

    // Verifica si la barra deslizante está oculta y gestiona el arrastre en consecuencia
    if (grosorContainer.style.display === "none") {
        // Si la barra deslizante está oculta, activa el arrastre del menú flotante
        enableFloatingMenuDrag();
    } else {
        // Si la barra deslizante está visible, desactiva el arrastre del menú flotante
        disableFloatingMenuDrag();
    }
}

// Función para activar el arrastre del menú flotante
function enableFloatingMenuDrag() {
    floatingMenu.removeEventListener("mousedown", disableFloatingMenuDrag);
    floatingMenu.addEventListener("mousedown", dragStart);
}

// Función para desactivar el arrastre del menú flotante
function disableFloatingMenuDrag() {
    floatingMenu.removeEventListener("mousedown", dragStart);
    floatingMenu.addEventListener("mousedown", disableFloatingMenuDrag);
}


// Función para cambiar el grosor del trazo
function cambiarGrosor() {
    var grosor = document.getElementById("thickness").value;
    // Aquí puedes hacer lo que necesites con el valor de grosor, por ejemplo, aplicarlo al trazo
    console.log("Nuevo grosor:", grosor);
}












</script>



    
    </script>
</body>
</html>
