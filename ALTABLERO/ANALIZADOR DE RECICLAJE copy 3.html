<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Reciclaje</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        textarea {
            width: 100%;
            height: 150px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .empty-cell {
            background-color: rgba(255, 182, 193, 0.5); /* Color rojo pastel suave */
        }
        #myChart, #dailyChart {
            margin-top: 20px;
            width: 100%;
            height: 400px;
            display: none; 
        }
        #impactResult {
            margin-top: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h1>Registro de Reciclaje</h1>
<textarea id="inputData" placeholder="Pega aquí la información sobre reciclaje..."></textarea>
<br>
<button onclick="processData()">Procesar Datos</button>
<button onclick="sortTable()">Ordenar de Mayor a Menor</button>
<button onclick="toggleChart()">Ver Gráfico</button> <!-- Se actualizó el nombre de la función aquí -->
<button onclick="showDailyChart()">Ver Gráfico Diario</button>

<table id="outputTable">
    <thead>
        <tr>
            <th>Nº</th>
            <th>Nombre Estudiante</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div id="impactResult"></div> <!-- Sección para mostrar el impacto ambiental -->

<canvas id="myChart"></canvas>
<canvas id="dailyChart"></canvas>
<button onclick="showImpactChart()">Ver Gráfico de Impacto Ambiental</button>
<canvas id="impactChart" style="display: none; width: 100%; height: 400px; margin-top: 20px;"></canvas>


<script>
    let currentData = []; 
    let dates = []; 
    let dailyTotals = {}; 
    let sortedData = []; 
   
    const recyclingData = {
        lata: { peso: 12, energia: 0.168, agua: 0.0168, co2: 0.108 }, // por lata
        botella: { peso: 13, energia: 0.224, agua: 0.0234, co2: 0.0195 } // por botella
    };

    function processData() {
        const input = document.getElementById('inputData').value.trim();
        const lines = input.split('\n');
        const outputTable = document.getElementById('outputTable').getElementsByTagName('tbody')[0];

        outputTable.innerHTML = '';
        currentData = []; 
        dates = []; 
        dailyTotals = {}; 
        sortedData = []; 

        const headerRow = lines[0].split('\t');
        const header = document.getElementById('outputTable').getElementsByTagName('thead')[0];

        while (header.rows.length > 1) {
            header.deleteRow(1);
        }

        const newHeaderRow = header.insertRow(1);
        newHeaderRow.insertCell(0).textContent = 'Nº';
        newHeaderRow.insertCell(1).textContent = 'Nombre Estudiante';

        for (let i = 2; i < headerRow.length; i += 2) {
            const cell = newHeaderRow.insertCell();
            cell.colSpan = 2; 
            dates.push(headerRow[i]); 
            cell.textContent = headerRow[i];
        }

        const studentData = lines.slice(1);
        studentData.forEach(line => {
            if (line.trim() === '') return; 
            const data = line.split('\t');

            if (data[0] && data[1]) {
                const row = outputTable.insertRow();
                currentData.push(data); 

                for (let i = 0; i < data.length; i++) {
                    const cell = row.insertCell(i);
                    cell.textContent = data[i] || ''; 
                    if (!data[i]) { 
                        cell.classList.add('empty-cell');
                    }
                }
            }
        });

        calculateImpact();
        drawChart(currentData); // Dibuja el gráfico original después de procesar los datos
    }

    function calculateImpact() {
        const impactResultDiv = document.getElementById('impactResult');

        for (let data of currentData) {
            for (let i = 2; i < data.length; i += 2) {
                if (i + 1 >= data.length) break;

                const dateIndex = Math.floor((i - 2) / 2); 
                if (dateIndex >= dates.length) break;

                const date = dates[dateIndex];
                const cans = parseInt(data[i]) || 0;
                const bottles = parseInt(data[i + 1]) || 0;

                if (!dailyTotals[date]) {
                    dailyTotals[date] = { cans: 0, bottles: 0 };
                }

                dailyTotals[date].cans += cans;
                dailyTotals[date].bottles += bottles;
            }
        }

        let impactHtml = '<h2>Impacto Ambiental Diario por Material</h2>';
        impactHtml += '<table><tr><th>Fecha</th><th>Peso Latas (kg)</th><th>Peso Botellas (kg)</th><th>Energía Latas (kWh)</th><th>Energía Botellas (kWh)</th><th>Agua Latas (m³)</th><th>Agua Botellas (m³)</th><th>CO₂ Latas (kg)</th><th>CO₂ Botellas (kg)</th></tr>';

        for (const date in dailyTotals) {
            const totalCans = dailyTotals[date].cans;
            const totalBottles = dailyTotals[date].bottles;

            const pesoLatas = (totalCans * recyclingData.lata.peso) / 1000;
            const pesoBotellas = (totalBottles * recyclingData.botella.peso) / 1000;
            const energiaLatas = totalCans * recyclingData.lata.energia;
            const energiaBotellas = totalBottles * recyclingData.botella.energia;
            const aguaLatas = totalCans * recyclingData.lata.agua;
            const aguaBotellas = totalBottles * recyclingData.botella.agua;
            const co2Latas = totalCans * recyclingData.lata.co2;
            const co2Botellas = totalBottles * recyclingData.botella.co2;

            impactHtml += `<tr>
                <td>${date}</td>
                <td>${pesoLatas.toFixed(2)}</td>
                <td>${pesoBotellas.toFixed(2)}</td>
                <td>${energiaLatas.toFixed(2)}</td>
                <td>${energiaBotellas.toFixed(2)}</td>
                <td>${aguaLatas.toFixed(2)}</td>
                <td>${aguaBotellas.toFixed(2)}</td>
                <td>${co2Latas.toFixed(2)}</td>
                <td>${co2Botellas.toFixed(2)}</td>
            </tr>`;
        }

        impactHtml += '</table>';
        impactResultDiv.innerHTML = impactHtml;
    }

    function sortTable() {
        const sortableData = currentData.map((data, index) => {
            const totalRecycling = data.slice(2).reduce((total, num) => total + (parseInt(num) || 0), 0);
            return { index, data, totalRecycling };
        });

        sortableData.sort((a, b) => b.totalRecycling - a.totalRecycling);
        sortedData = sortableData.map(item => item.data);

        const outputTable = document.getElementById('outputTable').getElementsByTagName('tbody')[0];
        outputTable.innerHTML = '';

        sortableData.forEach(item => {
            const row = outputTable.insertRow();
            item.data.forEach((cellData, i) => {
                const cell = row.insertCell(i);
                cell.textContent = cellData || ''; 
                if (!cellData) { 
                    cell.classList.add('empty-cell'); 
                }
            });
        });
    }

    function toggleChart() {
        // Alterna entre el gráfico ordenado y el original
        if (myChart) {
            myChart.destroy(); // Destruir el gráfico existente
        }
        if (isSorted) {
            drawChart(currentData); // Volver al gráfico original
        } else {
            drawChart(sortedData); // Dibujar gráfico ordenado
        }
        isSorted = !isSorted; // Alternar la bandera
    }
    let myChart; // Declaración global para el gráfico de reciclaje
    let dailyChart; // Declaración global para el gráfico diario
    let isSorted = false; // Bandera para alternancia entre gráfico original y ordenado

    function toggleChart() {
        // Alterna entre el gráfico ordenado y el original
        if (dailyChart) {
            dailyChart.destroy(); // Ocultar el gráfico diario si está activo
            document.getElementById('dailyChart').style.display = 'none'; 
        }
        if (myChart) {
            myChart.destroy(); // Destruir el gráfico de reciclaje existente
        }
        if (isSorted) {
            drawChart(currentData); // Volver al gráfico original
        } else {
            drawChart(sortedData); // Dibujar gráfico ordenado
        }
        isSorted = !isSorted; // Alternar la bandera
    }

    function drawChart(data) {
        const ctx = document.getElementById('myChart').getContext('2d');
        const labels = data.map(row => row[1]); // Nombre de estudiantes
        const totalCans = data.map(row => row.slice(2).reduce((total, num, index) => total + (index % 2 === 0 ? parseInt(num) || 0 : 0), 0));
        const totalBottles = data.map(row => row.slice(2).reduce((total, num, index) => total + (index % 2 === 1 ? parseInt(num) || 0 : 0), 0));

        document.getElementById('myChart').style.display = 'block'; // Mostrar el gráfico de reciclaje
        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Latas Recicladas',
                        data: totalCans,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Botellas Recicladas',
                        data: totalBottles,
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    function showDailyChart() {
        if (myChart) {
            myChart.destroy(); // Ocultar el gráfico de reciclaje si está activo
            document.getElementById('myChart').style.display = 'none'; 
        }
        const ctx = document.getElementById('dailyChart').getContext('2d');
        const labels = Object.keys(dailyTotals); // Fechas
        const totalCans = labels.map(date => dailyTotals[date].cans); 
        const totalBottles = labels.map(date => dailyTotals[date].bottles); 

        document.getElementById('dailyChart').style.display = 'block'; // Mostrar el gráfico diario
        dailyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Latas Recicladas',
                        data: totalCans,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    },
                    {
                        label: 'Botellas Recicladas',
                        data: totalBottles,
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }


    let impactChart; // Declaración global para el gráfico de impacto ambiental

function showImpactChart() {
    // Ocultar otros gráficos activos
    if (myChart) {
        myChart.destroy();
        document.getElementById('myChart').style.display = 'none';
    }
    if (dailyChart) {
        dailyChart.destroy();
        document.getElementById('dailyChart').style.display = 'none';
    }
    if (impactChart) {
        impactChart.destroy(); // Destruir gráfico anterior si existe
    }

    const ctx = document.getElementById('impactChart').getContext('2d');
    document.getElementById('impactChart').style.display = 'block'; // Mostrar el gráfico de impacto ambiental

    const dates = Object.keys(dailyTotals);
    const co2DataLatas = dates.map(date => (dailyTotals[date].cans * recyclingData.lata.co2).toFixed(2));
    const co2DataBotellas = dates.map(date => (dailyTotals[date].bottles * recyclingData.botella.co2).toFixed(2));
    const aguaDataLatas = dates.map(date => (dailyTotals[date].cans * recyclingData.lata.agua).toFixed(2));
    const aguaDataBotellas = dates.map(date => (dailyTotals[date].bottles * recyclingData.botella.agua).toFixed(2));
    const energiaDataLatas = dates.map(date => (dailyTotals[date].cans * recyclingData.lata.energia).toFixed(2));
    const energiaDataBotellas = dates.map(date => (dailyTotals[date].bottles * recyclingData.botella.energia).toFixed(2));

    impactChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                { label: 'CO₂ Latas (kg)', data: co2DataLatas, borderColor: 'rgba(255, 99, 132, 1)', fill: false },
                { label: 'CO₂ Botellas (kg)', data: co2DataBotellas, borderColor: 'rgba(54, 162, 235, 1)', fill: false },
                { label: 'Agua Latas (m³)', data: aguaDataLatas, borderColor: 'rgba(75, 192, 192, 1)', fill: false },
                { label: 'Agua Botellas (m³)', data: aguaDataBotellas, borderColor: 'rgba(153, 102, 255, 1)', fill: false },
                { label: 'Energía Latas (kWh)', data: energiaDataLatas, borderColor: 'rgba(255, 206, 86, 1)', fill: false },
                { label: 'Energía Botellas (kWh)', data: energiaDataBotellas, borderColor: 'rgba(201, 203, 207, 1)', fill: false }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Impacto Ambiental Diario por Material'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}




</script>

</body>
</html>
