
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos de Barras</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>  
   
   <style>
        #graficos {
            display: flex;
            flex-wrap: wrap;
        }

        .grafico {
            width: 45%;
            margin: 10px;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>Gráficos de Matemáticas</h1>
    <div id="graficos"></div>

    <script>

const respuestasCorrectas = {
    1: 'B', 2: 'B', 3: 'C', 4: 'A', 5: 'B', 6: 'D', 7: 'B', 8: 'A', 9: 'D',
    10: 'C', 11: 'C', 12: 'C', 13: 'A', 14: 'C', 15: 'A', 16: 'D'
};
        const datosTabla =`Pregunta,Institución,A (Conteo),A (%),B (Conteo),B (%),C (Conteo),C (%),D (Conteo),D (%)
1,CIUDAD CÓRDOBA - SEDE PRINCIPAL,3,5.00%,34,58.00%,15,25.00%,7,12.00%
1,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,3,9.00%,29,83.00%,3,9.00%,0,0.00%
2,CIUDAD CÓRDOBA - SEDE PRINCIPAL,10,17.00%,21,36.00%,7,12.00%,21,36.00%
2,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,13,37.00%,13,37.00%,5,14.00%,4,11.00%
3,CIUDAD CÓRDOBA - SEDE PRINCIPAL,25,42.00%,15,25.00%,12,20.00%,7,12.00%
3,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,9,26.00%,4,11.00%,20,57.00%,2,6.00%
4,CIUDAD CÓRDOBA - SEDE PRINCIPAL,29,49.00%,4,7.00%,15,25.00%,11,19.00%
4,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,19,54.00%,3,9.00%,2,6.00%,11,31.00%
5,CIUDAD CÓRDOBA - SEDE PRINCIPAL,14,24.00%,24,41.00%,10,17.00%,11,19.00%
5,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,7,20.00%,15,43.00%,7,20.00%,6,17.00%
6,CIUDAD CÓRDOBA - SEDE PRINCIPAL,9,15.00%,5,8.00%,8,14.00%,37,63.00%
6,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,1,3.00%,1,3.00%,4,11.00%,29,83.00%
7,CIUDAD CÓRDOBA - SEDE PRINCIPAL,14,24.00%,19,32.00%,18,31.00%,8,14.00%
7,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,3,9.00%,9,26.00%,13,37.00%,10,29.00%
8,CIUDAD CÓRDOBA - SEDE PRINCIPAL,23,39.00%,6,10.00%,16,27.00%,14,24.00%
8,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,9,26.00%,0,0.00%,11,31.00%,15,43.00%
9,CIUDAD CÓRDOBA - SEDE PRINCIPAL,19,32.00%,10,17.00%,13,22.00%,17,29.00%
9,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,8,23.00%,7,20.00%,7,20.00%,13,37.00%
10,CIUDAD CÓRDOBA - SEDE PRINCIPAL,13,22.00%,4,7.00%,32,54.00%,10,17.00%
10,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,3,9.00%,7,20.00%,9,26.00%,16,46.00%
11,CIUDAD CÓRDOBA - SEDE PRINCIPAL,11,19.00%,11,19.00%,19,32.00%,18,31.00%
11,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,2,6.00%,14,40.00%,15,43.00%,4,11.00%
12,CIUDAD CÓRDOBA - SEDE PRINCIPAL,13,22.00%,10,17.00%,28,47.00%,8,14.00%
12,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,8,23.00%,7,20.00%,19,54.00%,1,3.00%
13,CIUDAD CÓRDOBA - SEDE PRINCIPAL,38,64.00%,7,12.00%,6,10.00%,8,14.00%
13,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,24,69.00%,0,0.00%,9,26.00%,2,6.00%
14,CIUDAD CÓRDOBA - SEDE PRINCIPAL,12,20.00%,7,12.00%,18,31.00%,22,37.00%
14,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,6,17.00%,3,9.00%,15,43.00%,11,31.00%
15,CIUDAD CÓRDOBA - SEDE PRINCIPAL,10,17.00%,9,15.00%,22,37.00%,18,31.00%
15,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,3,9.00%,7,20.00%,22,63.00%,3,9.00%
16,CIUDAD CÓRDOBA - SEDE PRINCIPAL,13,22.00%,18,31.00%,8,14.00%,20,34.00%
16,CIUDAD CÓRDOBA - SEDE ENRIQUE OLAYA HERRERA,9,26.00%,6,17.00%,3,9.00%,17,49.00%`;

const graficosDiv = document.getElementById('graficos');  
        const filas = datosTabla.trim().split('\n');  
        const preguntas = {};  

        for (let i = 1; i < filas.length; i++) {  
            const valores = filas[i].split(',');  
            const pregunta = valores[0];  
            const institucion = valores[1];  
            const conteos = [  
                parseInt(valores[2]),   
                parseInt(valores[4]),   
                parseInt(valores[6]),   
                parseInt(valores[8])  
            ];  

            if (!preguntas[pregunta]) {  
                preguntas[pregunta] = [];  
            }  

            preguntas[pregunta].push({ institucion, conteos });  
        }  

        // Generar gráficos para cada pregunta  
       // Generar gráficos para cada pregunta  
for (let pregunta in preguntas) {  
    const datosPregunta = preguntas[pregunta];  
    const canvasContainer = document.createElement('div');  
    canvasContainer.classList.add('grafico');  
    graficosDiv.appendChild(canvasContainer);  

    // Obtener la respuesta correcta para la pregunta actual  
    const solucion = respuestasCorrectas[pregunta] || '?';  

    const tituloPregunta = document.createElement('h2');  
    tituloPregunta.textContent = `Pregunta ${pregunta} - Solución: ${solucion}`;  
    canvasContainer.appendChild(tituloPregunta);  

    const canvas = document.createElement('canvas');  
    canvasContainer.appendChild(canvas);  

    // Preparar los datos para el gráfico  
    const etiquetas = ['A', 'B', 'C', 'D'];  
    const institucion1Datos = [];  
    const institucion2Datos = [];  

    datosPregunta.forEach((d, index) => {  
        if (index === 0) {  
            institucion1Datos.push(...d.conteos);  
        } else {  
            institucion2Datos.push(...d.conteos);  
        }  
    });  

    const data = {  
        labels: etiquetas,  
        datasets: [  
            {  
                label: 'CIUDAD CÓRDOBA - SP',  
                data: institucion1Datos,  
                backgroundColor: '#6EC1E4', // Azul  
            },  
            {  
                label: 'CIUDAD CÓRDOBA - EOH',  
                data: institucion2Datos,  
                backgroundColor: '#F7B7A3', // Rosado  
            }  
        ]  
    };  

    // Configuración del gráfico  
    new Chart(canvas, {  
        type: 'bar',  
        data: data,  
        options: {  
            responsive: true,  
            scales: {  
                y: {  
                    beginAtZero: true  
                },  
                x: {  
                    stacked: false // Asegura que las barras estén agrupadas  
                }  
            },  
            plugins: {  
                legend: {  
                    display: true  
                }  
            }  
        }  
    });  
}

     

const descargarPDF = () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
    const graficos = document.querySelectorAll('.grafico canvas');
    const preguntas = document.querySelectorAll('.grafico h2');
    const anchoPagina = 210;
    const altoPagina = 297;
    const margen = 10;

    const anchoGrafico = (anchoPagina - 3 * margen) / 2;
    const altoGrafico = (altoPagina - 7 * margen - 40) / 3;
    const alturaTexto = 6;

    let x = margen;
    let y = 35;
    let contador = 0;

    pdf.setFontSize(14);
    pdf.text('Cuestionario de Matemáticas', 105, 20, { align: 'center' });

    graficos.forEach((canvas, index) => {
        const imgData = canvas.toDataURL('image/png', 1.0);
        const numeroPregunta = index + 1;
        const respuesta = respuestasCorrectas[numeroPregunta] || '?';
        const titulo = `Pregunta ${numeroPregunta} - Solución: ${respuesta}`;

        pdf.setFontSize(9);
        pdf.text(titulo, x + 2, y - 2);
        pdf.addImage(imgData, 'PNG', x, y, anchoGrafico, altoGrafico);

        contador++;

        if (contador % 2 === 0) {
            x = margen;
            y += altoGrafico + alturaTexto + 5;
        } else {
            x += anchoGrafico + margen;
        }

        if (contador % 6 === 0 && index < graficos.length - 1) {
            pdf.addPage();
            y = 35;
            x = margen;
            pdf.setFontSize(14);
            pdf.text('Cuestionario de Matemáticas', 105, 20, { align: 'center' });
        }
    });

    pdf.save('Cuestionario_de_Matemáticas.pdf');
};

document.body.insertAdjacentHTML('beforeend', '<button onclick="descargarPDF()">Descargar PDF</button>');


        
    </script>
</body>
</html>
