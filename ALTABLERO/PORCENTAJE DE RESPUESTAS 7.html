<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Análisis de Respuestas de Estudiantes</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-5JZ1b7tVgCwTZzzguyWOR6jLz2ZFn8Hv1b86ki34Swv0SQl4TMzTw1U3A3jVnb8sA7f0F9FOzprvHDbw09PtSg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  

<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f2f2f2;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    .container {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        width: 90%;
        max-width: 1200px;
        overflow: hidden;
        max-height: 80vh; /* Altura máxima del contenedor */
        overflow-y: auto; /* Habilita el scroll vertical cuando el contenido excede la altura máxima */
    }

    h1, h2 {
        text-align: center;
        color: #3498db;
    }

    textarea {
        width: calc(100% - 16px);
        height: 120px;
        margin-bottom: 10px;
        padding: 8px;
        box-sizing: border-box;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
/* Estilos para los botones */
button {
            background-color: #649a7c;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            margin-right: 10px;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:focus {
            outline: none;
        }
    .table-container {
        overflow-x: auto;
        margin-top: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    table, th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
        font-size: 14px;
    }

    th {
        background-color: #3498db;
        color: white;
        cursor: pointer;
    }

    th, td {
        min-width: 80px;
    }

    tr:nth-child(even) {
        background-color: #f8f9fa;
    }

    .correct {
        background-color: #d4edda;
        color: #155724;
    }

    .incorrect {
        background-color: #f8d7da;
        color: #721c24;
    }

    .chart-container {
        width: 100%;
        margin: 20px 0;
    }



    #search-student {
        width: 100%;
        margin: 20px 0;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    #student-list {
        width: 100%;
        margin: 10px 0;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .summary-table {
        width: 100%;
        margin: 20px 0;
        overflow-x: auto;
    }

    .summary-table table {
        width: 100%;
        border-collapse: collapse;
    }

    .summary-table th, .summary-table td {
        padding: 12px;
        text-align: center;
    }

    .summary-table th {
        background-color: #34495e;
        color: white;
        cursor: pointer;
    }

    .summary-table th:hover {
        background-color: #2c3e50;
    }

    /* Estilos para el botón flotante */
    .restore-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 999;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #3498db;
        color: white;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s ease;
    }

    .restore-button:hover {
        background-color: #2980b9;
    }

    .restore-button i {
        font-size: 24px;
    }

 
    .container {
            max-width: 950px;
            margin: auto;
        }

        .chart-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .chart-container canvas {
            display: inline-block;
        }







</style>
</head>


<body>
<div class="container">
    <h1>Análisis de Respuestas de Estudiantes</h1>
    <textarea id="survey-data" placeholder="Pegue los datos del encabezado y respuestas de los estudiantes aquí..."></textarea>
    <button onclick="procesarDatos()">Procesar Datos</button>
    
    <div class="table-container">
        <table id="results-table">
            <thead id="table-head">
                <!-- Encabezado de la tabla se generará dinámicamente -->
            </thead>
            <tbody id="table-body">
                <!-- Cuerpo de la tabla se generará dinámicamente -->
            </tbody>
        </table>
    </div>
    <div class="chart-container">
        <h2>Análisis General</h2>
        <div class="chart-js-container">
            <canvas id="chart"></canvas>
            <button onclick="descargarGrafico('chart', 'AnalisisGeneral')">Descargar Gráfico</button>
        </div>
    </div>
    <h2>Análisis Personalizado por Estudiante</h2>
    <select id="student-list" onchange="mostrarGraficoEstudiante()">
        <option value="">Seleccionar estudiante...</option>
    </select>
    <div id="student-chart-container" class="chart-container">
        <div class="chart-js-container">
            <canvas id="student-chart"></canvas>
            <button onclick="descargarGrafico('student-chart', 'AnalisisEstudiante')">Descargar Gráfico</button>
        </div>
    </div>
    

    <div class="summary-table">
        <h2>Resumen de Desempeño por Estudiante</h2>
        <button onclick="ordenarTablaResumen()">Ordenar por Errores (Ascendente)</button>
        <table id="summary-table">
            <thead>
                <tr>
                    <th onclick="ordenarTablaResumen()">Nombre</th>
                    <th>% Aciertos</th>
                    <th>% Errores</th>
                </tr>
            </thead>
            <tbody id="summary-body">
                <!-- Contenido de la tabla de resumen se generará dinámicamente -->
            </tbody>
        </table>
    </div>
</div>
<button class="restore-button" onclick="restaurarPagina()"><i class="fas fa-redo"></i> Reset</button>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>

<script>
    let estudiantes = [];
    let preguntas = [];
    let respuestasCorrectas = [];

    function procesarDatos() {
        const textarea = document.getElementById('survey-data');
        const datos = textarea.value.trim().split('\n');

        if (datos.length < 1) return;

        const headers = datos[0].split('\t');
        estudiantes = [];

        for (let i = 1; i < datos.length; i++) {
            const values = datos[i].split('\t');
            const estudiante = {};
            for (let j = 0; j < headers.length; j++) {
                estudiante[headers[j]] = values[j];
            }
            estudiantes.push(estudiante);
        }

        preguntas = headers.filter(h => h.startsWith('Pregunta'));
        respuestasCorrectas = headers.filter(h => h.startsWith('Respuesta'));

        crearEncabezado(preguntas, respuestasCorrectas);
        poblarTabla(estudiantes, preguntas, respuestasCorrectas);
        generarGrafico(estudiantes, preguntas, respuestasCorrectas);
        llenarListaDesplegable(estudiantes);
        generarTablaResumen(estudiantes);
    }

    function crearEncabezado(preguntas, respuestasCorrectas) {
        const thead = document.getElementById('table-head');
        thead.innerHTML = '';

        const filaEncabezado = document.createElement('tr');
        const nombreEstudiante = document.createElement('th');
        nombreEstudiante.textContent = 'Nombre Estudiante';
        filaEncabezado.appendChild(nombreEstudiante);

        preguntas.forEach(pregunta => {
            const thPregunta = document.createElement('th');
            thPregunta.textContent = pregunta;
            filaEncabezado.appendChild(thPregunta);
        });

        respuestasCorrectas.forEach(respuesta => {
            const thRespuesta = document.createElement('th');
            thRespuesta.textContent = respuesta;
            filaEncabezado.appendChild(thRespuesta);
        });

        thead.appendChild(filaEncabezado);
    }

    function poblarTabla(estudiantes, preguntas, respuestasCorrectas) {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';

        estudiantes.forEach(estudiante => {
            const fila = document.createElement('tr');
            const celdaNombre = document.createElement('td');
            celdaNombre.textContent = `${estudiante['Nombres']} ${estudiante['Apellidos']}`;
            fila.appendChild(celdaNombre);

            preguntas.forEach(pregunta => {
                const celda = document.createElement('td');
                const respuestaEstudiante = estudiante[pregunta];
                const respuestaCorrecta = estudiante['Respuesta ' + pregunta.split(' ')[1]];

                if (respuestaEstudiante === respuestaCorrecta) {
                    celda.classList.add('correct');
                } else {
                    celda.classList.add('incorrect');
                }

                celda.textContent = respuestaEstudiante;
                fila.appendChild(celda);
            });

            respuestasCorrectas.forEach(respuesta => {
                const celda = document.createElement('td');
                celda.textContent = estudiante[respuesta];
                fila.appendChild(celda);
            });

            tbody.appendChild(fila);
        });
    }


    function generarGrafico(estudiantes, preguntas, respuestasCorrectas) {
    const ctx = document.getElementById('chart').getContext('2d');
    const correctas = new Array(preguntas.length).fill(0);
    const incorrectas = new Array(preguntas.length).fill(0);

    estudiantes.forEach(estudiante => {
        preguntas.forEach((pregunta, index) => {
            const respuestaEstudiante = estudiante[pregunta];
            const respuestaCorrecta = estudiante['Respuesta ' + pregunta.split(' ')[1]];

            if (respuestaEstudiante === respuestaCorrecta) {
                correctas[index]++;
            } else {
                incorrectas[index]++;
            }
        });
    });

    const totalRespuestas = estudiantes.length;
    const porcentajeCorrectas = correctas.map(c => (c / totalRespuestas) * 100);
    const porcentajeIncorrectas = incorrectas.map(i => (i / totalRespuestas) * 100);

    const chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: preguntas,
            datasets: [{
                label: '% Respuestas Correctas',
                data: porcentajeCorrectas,
                backgroundColor: '#3498db',
                borderWidth: 1
            }, {
                label: '% Respuestas Incorrectas',
                data: porcentajeIncorrectas,
                backgroundColor: '#e74c3c',
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'top'
                },
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const totalEvaluados = `Total de evaluados: ${totalRespuestas}`;
                            return tooltipItems[0].label + '\n' + totalEvaluados;
                        },
                        label: function(tooltipItem) {
                            const dataset = tooltipItem.dataset;
                            const index = tooltipItem.dataIndex;
                            const label = dataset.label;
                            const value = dataset.data[index];
                            const respuestas = label.includes('Correctas') ? correctas[index] : incorrectas[index];
                            return `${label}: ${value.toFixed(2)}% = ${respuestas} respuestas`;
                        }
                    }
                },
                datalabels: {
                    display: true, // Mostrar etiquetas dinámicas
                    formatter: (value, context) => {
                        const datasetLabel = context.dataset.label;
                        const index = context.dataIndex;
                        const respuestas = datasetLabel.includes('Correctas') ? correctas[index] : incorrectas[index];
                        return `${value.toFixed(2)}% = ${respuestas} respuestas`;
                    },
                    anchor: 'end',
                    align: 'end'
                }
            },
            scales: {
                x: {
                    stacked: true,
                },
                y: {
                    stacked: true,
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });

    // Guardar referencia al gráfico en el canvas para descarga posterior
    ctx.canvas.chart = chart;
}

function descargarGrafico() {
    const canvas = document.getElementById('chart');
    
    // Activar etiquetas dinámicas para mostrar porcentajes en la descarga
    canvas.chart.options.plugins.datalabels.display = true;
    canvas.chart.update();

    // Crear un enlace para la descarga del gráfico como imagen PNG
    const link = document.createElement('a');
    link.href = canvas.toDataURL('image/png');
    link.download = 'grafico.png';
    link.click();

    // Desactivar etiquetas dinámicas después de la descarga
    canvas.chart.options.plugins.datalabels.display = false; // No mostrar etiquetas dinámicas en el gráfico interactivo por defecto
    canvas.chart.update();
}


    
    function llenarListaDesplegable(estudiantes) {
        const select = document.getElementById('student-list');
        select.innerHTML = '<option value="">Seleccionar estudiante...</option>';

        estudiantes.forEach((estudiante, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = `${estudiante['Nombres']} ${estudiante['Apellidos']}`;
            select.appendChild(option);
        });
    }

    function mostrarGraficoEstudiante() {
        const select = document.getElementById('student-list');
        const selectedIndex = select.value;

        if (selectedIndex === '') {
            // Mostrar gráfico general si no se selecciona ningún estudiante
            generarGrafico(estudiantes, preguntas, respuestasCorrectas);
            return;
        }

        const estudiante = estudiantes[selectedIndex];
        const ctx = document.getElementById('student-chart').getContext('2d');
        const correctas = [];
        const incorrectas = [];

        preguntas.forEach(pregunta => {
            const respuestaEstudiante = estudiante[pregunta];
            const respuestaCorrecta = estudiante['Respuesta ' + pregunta.split(' ')[1]];

            if (respuestaEstudiante === respuestaCorrecta) {
                correctas.push(1);
                incorrectas.push(0);
            } else {
                correctas.push(0);
                incorrectas.push(1);
            }
        });

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: preguntas,
                datasets: [{
                    label: 'Respuestas Correctas',
                    data: correctas,
                    backgroundColor: '#3498db',
                    borderWidth: 1
                }, {
                    label: 'Respuestas Incorrectas',
                    data: incorrectas,
                    backgroundColor: '#e74c3c',
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    x: {
                        stacked: true,
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        max: 1
                    }
                }
            }
        });

        // Guardar referencia al gráfico en el canvas para descarga posterior
        ctx.canvas.chart = chart;
     
    }



    function generarTablaResumen(estudiantes) {
        const tbody = document.getElementById('summary-body');
        tbody.innerHTML = '';

        estudiantes.forEach(estudiante => {
            const fila = document.createElement('tr');
            const nombreCompleto = `${estudiante['Nombres']} ${estudiante['Apellidos']}`;
            const aciertos = calcularAciertos(estudiante);
            const errores = 100 - aciertos;

            const tdNombre = document.createElement('td');
            tdNombre.textContent = nombreCompleto;
            fila.appendChild(tdNombre);

            const tdAciertos = document.createElement('td');
            tdAciertos.textContent = `${aciertos.toFixed(2)}%`;
            fila.appendChild(tdAciertos);

            const tdErrores = document.createElement('td');
            tdErrores.textContent = `${errores.toFixed(2)}%`;
            fila.appendChild(tdErrores);

            tbody.appendChild(fila);
        });
    }

    function calcularAciertos(estudiante) {
        const totalPreguntas = preguntas.length;
        let respuestasCorrectas = 0;

        preguntas.forEach(pregunta => {
            const respuestaEstudiante = estudiante[pregunta];
            const respuestaCorrecta = estudiante['Respuesta ' + pregunta.split(' ')[1]];

            if (respuestaEstudiante === respuestaCorrecta) {
                respuestasCorrectas++;
            }
        });

        return (respuestasCorrectas / totalPreguntas) * 100;
    }

    let ordenAscendente = true; // Variable para controlar el orden ascendente/descendente

    function ordenarTablaResumen() {
        const table = document.getElementById('summary-table');
        const tbody = document.getElementById('summary-body');
        const rows = Array.from(tbody.rows);

        rows.sort((rowA, rowB) => {
            const errorA = parseFloat(rowA.cells[2].textContent);
            const errorB = parseFloat(rowB.cells[2].textContent);

            if (ordenAscendente) {
                return errorA - errorB;
            } else {
                return errorB - errorA;
            }
        });

        while (tbody.firstChild) {
            tbody.removeChild(tbody.firstChild);
        }

        rows.forEach(row => {
            tbody.appendChild(row);
        });

        // Cambiar el texto del botón según el orden actual
        const button = document.querySelector('.summary-table button');
        if (ordenAscendente) {
            button.textContent = 'Ordenar por Errores (Descendente)';
        } else {
            button.textContent = 'Ordenar por Errores (Ascendente)';
        }

        // Cambiar el estado de orden
        ordenAscendente = !ordenAscendente;
    }

    function restaurarPagina() {
        location.reload();
    }




</script>
</body>
</html>



