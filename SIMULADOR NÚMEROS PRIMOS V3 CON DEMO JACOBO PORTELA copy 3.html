<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego de N√∫meros Primos</title>
<link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAFklEQVR42mP8z/D/PwMDAwMjBoYBAG6RBAcKxM5oAAAAAElFTkSuQmCC">
  <link rel="icon" type="image/svg+xml" 
        href="data:image/svg+xml;utf8,
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
          <polygon points='32,4 39,24 60,24 42,38 48,58 32,46 16,58 22,38 4,24 25,24' 
                   fill='%23ffcc00' stroke='%23ff6600' stroke-width='3'/>
        </svg>">

<style>

  body{
    font-family:"Segoe UI",sans-serif;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:#fff;margin:0;padding:0;text-align:center;
  }
  h1{margin:20px 0;font-size:2.2em}
  .pantalla{display:none;min-height:100vh;padding:20px}
  .activa{display:block}
  button{
    padding:12px 20px;margin:15px;font-size:1.1em;
    border:none;border-radius:8px;cursor:pointer;
    background:#ff9800;color:#fff;transition:0.3s;
  }
  button:hover{background:#ffa733;transform:scale(1.05)}
  #grid{
    display:grid;grid-template-columns:repeat(10,1fr);
    gap:6px;max-width:600px;margin:20px auto;
  }
  .num{
    background:#ffffff33;padding:12px;border-radius:8px;
    font-size:1.1em;cursor:pointer;transition:0.3s;
  }
  .num:hover{transform:scale(1.1);background:#ffffff55}
  .correcto{background:#4caf50 !important;color:#fff}
  .error{background:#e53935 !important;color:#fff}
  #instruccion{margin:15px;font-size:1.2em;background:#ffffff22;padding:10px;border-radius:8px}
  #factorTree{margin-top:20px;text-align:center;font-size:1.2em}
  .nodo{margin:10px auto;padding:8px;border:2px solid #fff;border-radius:8px;display:inline-block;min-width:40px}
  .rama{margin:5px auto}
  .pregunta{margin:20px auto;font-size:1.3em;background:#ffffff22;padding:15px;border-radius:10px;max-width:600px}
  .feedback{font-weight:bold;margin-top:10px}
  /* Nivel 4 */
  .zonaNumeros, .zonaDrop{
    display:flex;flex-wrap:wrap;justify-content:center;
    margin:15px;gap:10px;
  }
  .ficha{
    padding:12px 18px;background:#ffffff33;border-radius:8px;
    cursor:grab;font-size:1.2em;
  }
  .drop{
    width:100px;height:50px;background:#ffffff22;
    border:2px dashed #fff;border-radius:8px;
    display:flex;align-items:center;justify-content:center;
    font-size:1.2em;
  }
  .completado{background:#4caf50 !important;border:none;color:#fff}
  /* Scoreboard animaci√≥n */
  .fila-ranking {
    opacity: 0;
    transform: translateY(15px);
    animation: aparecerFila 0.6s forwards;
  }
  @keyframes aparecerFila {
    to {opacity:1; transform:translateY(0);}
  }

  /* Splash Screen estilo arcade */
  #pantallaSplash {
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background:linear-gradient(135deg,#000000,#111827,#1f2937);
  }
  .tituloSplash {
    font-size:3em;
    color:#ffcc00;
    text-shadow:2px 2px 8px #ff6600, -2px -2px 8px #ff0000;
    margin-bottom:30px;
  }
  .pressStart {
    font-size:1.5em;
    color:#fff;
    animation:parpadeo 1s infinite;
    cursor:pointer;
  }
  @keyframes parpadeo {
    0%,50%{opacity:1;}
    50.1%,100%{opacity:0;}
  }


@keyframes slideUp {
  from {
    transform: translate(-50%, 50px);
    opacity: 0;
  }
  to {
    transform: translate(-50%, 0);
    opacity: 1;
  }
}

@keyframes slideUpBounce {
  0%   { transform: translate(-50%, 80px); opacity: 0; }
  60%  { transform: translate(-50%, -10px); opacity: 1; }
  80%  { transform: translate(-50%, 5px); }
  100% { transform: translate(-50%, 0); }
}



#toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 1.2em;
  opacity: 0;
  pointer-events: none;
  z-index: 9999;
}

/* Men√∫ debug */
  #menuDebug {
    display:none;
    position:fixed;
    top:10px; right:10px;
    background:#222;
    padding:10px;
    border-radius:8px;
    z-index:9999;
    color:#fff;
    font-size:14px;
  }
  #menuDebug select {
    margin-top:5px;
    padding:4px;
    border-radius:4px;
    font-size:14px;
  }


</style>
</head>
<body>


<!-- Splash Screen -->
<div id="pantallaSplash" class="pantalla activa">
  <h1 class="tituloSplash">‚≠ê Juego de N√∫meros Primos ‚≠ê</h1>
  <p class="pressStart">‚ñ∂Ô∏è Press Start</p>
</div>


<!-- Men√∫ de depuraci√≥n (solo visible en DEBUG) -->
<div id="menuDebug">
  <label for="selectNivel">Ir al nivel:</label><br>
  <select id="selectNivel">
    <option value="">-- Selecciona --</option>
    <option value="pantallaNivel1">Nivel 1 - Criba</option>
    <option value="pantallaNivel2">Nivel 2 - Factorizaci√≥n</option>
    <option value="pantallaNivel3">Nivel 3 - Verdadero/Falso</option>
    <option value="pantallaNivel4">Nivel 4 - Pares de Factores</option>
    <option value="pantallaNivel5">Nivel 5 - Producto de dos primos</option>
    <option value="pantallaNivel6">Nivel 6 - Arcade</option>
    <option value="pantallaRankingGlobal">Ranking Global</option>
  </select>





<!-- Pantalla de inicio (YA SIN activa) -->
<div id="pantallaInicio" class="pantalla">
  <h1>üéÆ Juego de N√∫meros Primos</h1>
  <p>Aprende y juega descubriendo qu√© son los n√∫meros primos y compuestos.</p>
  <button onclick="cambiarPantalla('pantallaIntro')">‚ñ∂Ô∏è Comenzar</button>
  <button onclick="mostrarRankingGlobal()">üèÖ Ver Ranking Arcade</button>
</div>

<div id="toast" 
     style="position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
            background:#333;color:#fff;padding:12px 20px;border-radius:8px;
            opacity:0;transition:opacity 0.5s;font-size:1.1em;z-index:999;">
</div>


<!-- Nivel 1: Criba -->
<div id="pantallaNivel1" class="pantalla">
  <h1>Nivel 1: Descubre los N√∫meros Primos</h1>
  <div id="instruccion">Marca todos los m√∫ltiplos de <b>2</b>, excepto el 2.</div>

  <div style="display:flex;justify-content:center;gap:40px;align-items:flex-start;">
    <!-- Grid principal -->
    <div id="grid"></div>

    <!-- Tabla de m√∫ltiplos como mini-grid -->
    <div id="tablaMultiplos" style="background:#ffffff22;padding:12px;border-radius:8px;">
      <h3 style="margin-top:0;">M√∫ltiplos de 2</h3>
      <div id="gridMultiplos" 
           style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;max-width:220px;">
      </div>
    </div>
  </div>
</div>




<!-- Pantalla de explicaci√≥n -->
<div id="pantallaIntro" class="pantalla">
  <h1>¬øQu√© es un n√∫mero primo?</h1>
  <p>Un n√∫mero primo tiene <b>solo dos divisores</b>: el 1 y √©l mismo.<br>
     Ejemplos: 2, 3, 5, 7, 11.</p>
  <h1>¬øQu√© es un n√∫mero compuesto?</h1>
  <p>Un n√∫mero compuesto tiene <b>m√°s de dos divisores</b>.<br>
     Ejemplo: 4 (1, 2, 4), 6 (1, 2, 3, 6).</p>
  <button id="btnNarrar">üîä Escuchar explicaci√≥n</button>
  <br>
  <button onclick="cambiarPantalla('pantallaNivel1')">‚û°Ô∏è Ir al Nivel 1</button>
</div>

<!-- Nivel 1: Criba -->
<div id="pantallaNivel1" class="pantalla">
  <h1>Nivel 1: Descubre los N√∫meros Primos</h1>
  <div id="instruccion">Marca todos los m√∫ltiplos de <b>2</b>, excepto el 2.</div>
  <div id="grid"></div>
  <button id="btnSiguiente">‚û°Ô∏è Siguiente paso</button>
</div>

<!-- Transici√≥n -->
<div id="pantallaTransicion" class="pantalla">
  <h1>üéâ ¬°Nivel Completado!</h1>
  <p>Prep√°rate para el siguiente reto...</p>
  <button onclick="cambiarPantalla('pantallaNivel2')">‚û°Ô∏è Ir al Nivel 2</button>
</div>

<!-- Nivel 2: Factorizaci√≥n -->
<div id="pantallaNivel2" class="pantalla">
  <h1>Nivel 2: Factorizaci√≥n Prima</h1>
  <p>Escribe un n√∫mero y observa su √°rbol de factores:</p>
  <input type="number" id="numFactor" value="60" min="2" style="padding:8px;font-size:1em">
  <button onclick="factorizar()">Descomponer</button>
  <div id="factorTree"></div>
  <button onclick="cambiarPantalla('pantallaNivel3')">‚û°Ô∏è Siguiente Nivel</button>
</div>

<!-- Nivel 3: Verdadero/Falso -->
<div id="pantallaNivel3" class="pantalla">
  <h1>Nivel 3: Verdadero o Falso</h1>
  <div id="contenedorPreguntas"></div>
  <button onclick="mostrarResultados()">üìä Ver Resultados</button>
  <div id="resultados"></div>
  <button onclick="cambiarPantalla('pantallaNivel4')">‚û°Ô∏è Siguiente Nivel</button>
</div>

<!-- Nivel 4: Pares de Factores -->

<div id="pantallaNivel4" class="pantalla">
  <h1>Nivel 4: Pares de Factores</h1>
  <p>Ingresa un n√∫mero y arrastra los factores correctos para formar las parejas.</p>
  <input type="number" id="inputNumeroNivel4" value="24" min="2" style="padding:6px;font-size:1em;">
  <button onclick="generarNivel4()">Generar ejercicio</button>
  <button id="btnRepetirNivel4">üîä Repetir instrucci√≥n</button>
  
  <div class="zonaNumeros" id="zonaNumeros"></div>
  <div class="zonaDrop" id="zonaDrop"></div>
  <div id="estadoNivel4"></div>
</div>




<!-- Nivel 5: Producto de dos primos -->
<div id="pantallaNivel5" class="pantalla">
  <h1>Nivel 5: Producto de dos primos</h1>
  <div id="contenedorQuiz"></div>
</div>

<!-- Nivel 6: Reto arcade -->
<div id="pantallaNivel6" class="pantalla">
  <h1>Nivel 6: Reto Arcade ‚è±Ô∏è</h1>
  <p>Clasifica el n√∫mero como Primo o Compuesto antes de que acabe el tiempo.</p>
  <h2 id="numeroReto">--</h2>
  <button onclick="responderArcade(true)">üîπ Primo</button>
  <button onclick="responderArcade(false)">üî∏ Compuesto</button>
  <p>Tiempo: <span id="tiempoArcade">30</span> s</p>
  <p>Puntos: <span id="puntosArcade">0</span></p>
</div>

<!-- Resultados arcade -->
<div id="pantallaArcadeFinal" class="pantalla">
  <h1>‚è∞ ¬°Tiempo terminado!</h1>
  <p>Tu puntaje final: <b id="puntajeFinalArcade"></b></p>
  <h2 id="medallaArcade"></h2>
  <canvas id="confetiArcade"></canvas>
  <h3>üèÖ Ranking de Mejores Puntajes</h3>
  <table style="margin:0 auto; border-collapse:collapse; color:#fff;">
    <thead>
      <tr><th style="padding:6px 12px; border-bottom:1px solid #fff;">Puntaje</th>
          <th style="padding:6px 12px; border-bottom:1px solid #fff;">Medalla</th>
          <th style="padding:6px 12px; border-bottom:1px solid #fff;">Fecha</th></tr>
    </thead>
    <tbody id="cuerpoRanking"></tbody>
  </table>
  <br>
  <button onclick="reiniciarArcade()">üîÑ Volver a intentar</button>
  <button onclick="cambiarPantalla('pantallaInicio')">üè† Volver al inicio</button>
</div>

<!-- Pantalla Ranking Global -->
<div id="pantallaRankingGlobal" class="pantalla">
  <h1>üèÖ Ranking Arcade Global</h1>
  <table style="margin:0 auto; border-collapse:collapse; color:#fff;">
    <thead>
      <tr>
        <th style="padding:6px 12px; border-bottom:1px solid #fff;">Puntaje</th>
        <th style="padding:6px 12px; border-bottom:1px solid #fff;">Medalla</th>
        <th style="padding:6px 12px; border-bottom:1px solid #fff;">Fecha</th>
      </tr>
    </thead>
    <tbody id="cuerpoRankingGlobal"></tbody>
  </table>
  <br>
  <button onclick="cambiarPantalla('pantallaInicio')">üè† Volver al inicio</button>
</div>

<script>


// ====== MODO DEBUG ======
const DEBUG = true; // üëà pon en false para ocultar el men√∫

if(DEBUG){
  document.getElementById("menuDebug").style.display = "block";

  document.getElementById("selectNivel").addEventListener("change", e=>{
    if(e.target.value){
      cambiarPantalla(e.target.value);
    }
  });
}




// ===== Splash Screen =====
const sonidoStart = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
document.querySelector(".pressStart").addEventListener("click",()=>{
  sonidoStart.currentTime = 0;
  sonidoStart.play();
  setTimeout(()=>cambiarPantalla("pantallaInicio"), 800);
});

const sonidoToast = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");




 // ===== Funci√≥n pantallas =====
// ===== Funci√≥n cambiar pantalla =====
  function cambiarPantalla(id){
    document.querySelectorAll(".pantalla").forEach(p=>p.classList.remove("activa"));
    const pantalla = document.getElementById(id);
    if(pantalla){
      pantalla.classList.add("activa");
    } else {
      console.error("No existe la pantalla con id:", id);
    }
  }

  if(DEBUG){
    document.getElementById("menuDebug").style.display = "block";

    document.getElementById("selectNivel").addEventListener("change", e=>{
      if(e.target.value){
        cambiarPantalla(e.target.value);
      }
    });
  }
  // ===== Narrador =====
  document.getElementById("btnNarrar").addEventListener("click",()=>{
    let texto="Un n√∫mero primo solo tiene dos divisores: el uno y √©l mismo. Ejemplos: dos, tres, cinco, siete. Un n√∫mero compuesto tiene m√°s de dos divisores, como el cuatro o el seis.";
    const utter=new SpeechSynthesisUtterance(texto);
    utter.lang="es-ES"; utter.rate=1;
    speechSynthesis.speak(utter);
  });

  // ===== Sonidos =====
  const sonidoCorrecto=new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
  const sonidoError=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
  const sonidoVictoria=new Audio("https://actions.google.com/sounds/v1/cartoon/descending_whistle.ogg");
  const sonidoScoreboard=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");

// ===== Nivel 1: Criba =====
const grid = document.getElementById("grid");
for (let i = 1; i <= 100; i++) {
  const div = document.createElement("div");
  div.className = "num";
  div.textContent = i;
  div.dataset.valor = i;
  grid.appendChild(div);
}

const pasos = [2, 3, 5, 7];
let pasoIndex = 0;



function actualizarInstruccion() {
  const n = pasos[pasoIndex];
  document.getElementById("instruccion").innerHTML = 
    `Marca todos los m√∫ltiplos de <b>${n}</b>, excepto el ${n}.`;
  mostrarMultiplos(n); // üëâ aqu√≠ se actualiza el mini-grid
}




actualizarInstruccion();

// Verificar si ya se marcaron todos los m√∫ltiplos del primo actual
function todosMarcados(primo) {
  const multiples = [];
  for (let i = primo * 2; i <= 100; i += primo) {
    multiples.push(i);
  }
  return multiples.every(m => {
    const cell = [...grid.children].find(c => Number(c.dataset.valor) === m);
    return cell && cell.classList.contains("correcto");
  });
}

// Avanzar al siguiente paso autom√°ticamente
function avanzarPaso() {
  pasoIndex++;
  if (pasoIndex < pasos.length) {
    actualizarInstruccion();

    // üéâ Toast verde (correcto)
    mostrarToast("¬°Bien hecho! Pasemos al siguiente primo.", "verde");

    // üé§ Narrador autom√°tico
    const primo = pasos[pasoIndex];
    setTimeout(() => {
      const mensaje = `Ahora encuentra los m√∫ltiplos de ${primo}, excepto el ${primo}`;
      const utter = new SpeechSynthesisUtterance(mensaje);
      utter.lang = "es-ES";
      utter.rate = 1.1;
      speechSynthesis.speak(utter);
    }, 1000);

  } else {
    sonidoVictoria.play();

    // üéâ Toast dorado (fin de nivel)
    mostrarToast("‚úÖ Nivel 1 completado", "dorado");

    const utter = new SpeechSynthesisUtterance("¬°Muy bien! Has completado el nivel uno.");
    utter.lang = "es-ES";
    utter.rate = 1.1;
    speechSynthesis.speak(utter);

    cambiarPantalla("pantallaTransicion");
  }
}

grid.addEventListener("click", e => {
  if (!e.target.classList.contains("num")) return;

  const n = Number(e.target.dataset.valor);
  const primo = pasos[pasoIndex];

  if (n === primo) {
    e.target.classList.add("error");
    sonidoError.play();
    return;
  }

  if (n % primo === 0) {
    // Marcar en tablero principal
    e.target.classList.add("correcto");
    sonidoCorrecto.play();

    // üëâ Marcar tambi√©n en la tabla lateral
    const celda = document.getElementById("m" + n);
    if (celda) {
      celda.style.background = "#4caf50"; 
      celda.style.color = "#000";
      celda.style.textDecoration = "line-through"; // ‚úÖ Tachado
    }

    // Verificar si ya est√°n todos los m√∫ltiplos encontrados
    if (todosMarcados(primo)) {
      setTimeout(avanzarPaso, 800); // peque√±o delay para ver el √∫ltimo
    }

  } else {
    e.target.classList.add("error");
    sonidoError.play();
  }
});

  // ===== Nivel 2: Factorizaci√≥n =====
 function factorizar(){
  const n=Number(document.getElementById("numFactor").value);
  const container=document.getElementById("factorTree");
  container.innerHTML="";
  if(isNaN(n)||n<2) return;
  let huboDescomposicion = false; // üëà

  function crearNodo(num){
    const div=document.createElement("div");
    div.className="nodo";
    div.textContent=num;
    return div;
  }
  function descomponer(num,parent){
    if(esPrimo(num)){
      const nodo=crearNodo(num);
      parent.appendChild(nodo);
      return;
    }
    let factor=2;
    while(num%factor!==0){factor++;}
    const rama=document.createElement("div");
    rama.className="rama";
    rama.appendChild(crearNodo(num));
    const sub1=crearNodo(factor);
    rama.appendChild(sub1);
    parent.appendChild(rama);
    descomponer(num/factor,rama);
    huboDescomposicion = true; // üëà hubo divisi√≥n
  }
  descomponer(n,container);

  if(huboDescomposicion){
    mostrarToast("‚úÖ Has descompuesto el n√∫mero", "azul");
  } else {
    mostrarToast("üîπ El n√∫mero ya es primo", "verde");
  }
}

 
 
 
 
  function esPrimo(num){
    if(num<2) return false;
    for(let i=2;i<=Math.sqrt(num);i++){if(num%i===0)return false;}
    return true;
  }

  // ===== Nivel 3: Verdadero/Falso =====
  const preguntas=[
    {texto:"Todos los impares son primos.",respuesta:false},
    {texto:"Todos los pares son compuestos.",respuesta:false},
    {texto:"Los n√∫meros que terminan en 0 no son primos.",respuesta:true},
    {texto:"Los que terminan en 1 son primos.",respuesta:false}
  ];
  const contenedor=document.getElementById("contenedorPreguntas");
  preguntas.forEach((p,i)=>{
    const div=document.createElement("div");
    div.className="pregunta";
    div.innerHTML=`
      <p>${p.texto}</p>
      <button onclick="responder(${i},true,this)">‚úÖ Verdadero</button>
      <button onclick="responder(${i},false,this)">‚ùå Falso</button>
      <div class="feedback" id="fb${i}"></div>
    `;
    contenedor.appendChild(div);
  });
  let aciertos=0;
  function responder(i,respuesta,btn){
  const fb=document.getElementById("fb"+i);
  if(respuesta===preguntas[i].respuesta){
    fb.textContent="¬°Correcto!";
    fb.style.color="lightgreen";
    sonidoCorrecto.play();
    aciertos++;
    mostrarToast("‚úÖ ¬°Correcto!", "verde"); // üëà mini-toast inmediato
  }else{
    fb.textContent="Incorrecto.";
    fb.style.color="red";
    sonidoError.play();
    mostrarToast("‚ùå Incorrecto", "dorado"); // üëà mini-toast tambi√©n en error
  }
  btn.parentElement.querySelectorAll("button").forEach(b=>b.disabled=true);
}

  function mostrarResultados(){
    document.getElementById("resultados").innerHTML=
      `<h2>Resultados</h2><p>Has acertado ${aciertos} de ${preguntas.length}.</p>`;
    sonidoVictoria.play();
    mostrarToast("üìä Resultados listos", "azul");

  }




// ===== Nivel 4 din√°mico: Pares de Factores =====
function generarNivel4(){
  const num = Number(document.getElementById("inputNumeroNivel4").value);
  if(isNaN(num) || num < 2) {
    mostrarToast("‚ùå Ingresa un n√∫mero mayor que 1", "dorado");
    return;
  }

  // 1) Obtener todos los divisores
  let divisores = [];
  for(let i=1;i<=num;i++){
    if(num % i === 0) divisores.push(i);
  }

  // 2) Crear pares √∫nicos [a,b]
  let pares = [];
  for(let i=0;i<divisores.length;i++){
    let a = divisores[i];
    let b = num / a;
    if(a <= b && !pares.some(([x,y]) => (x===a && y===b))){
      pares.push([a,b]);
    }
  }

  // üëâ Estado
  const zonaEstado = document.getElementById("estadoNivel4");
  zonaEstado.innerHTML = "";
  if (divisores.length === 2) {
    const msg = `${num} es un n√∫mero primo porque solo tiene dos divisores: 1 y ${num}.`;
    zonaEstado.innerHTML = `<p style="color:#39FF14; font-weight:bold; font-size:1.5em; margin:10px 0">‚ú® ${msg}</p>`;
    narrarTexto(msg);
  } else {
    const msg = `Forma los pares de factores de ${num}.`;
    zonaEstado.innerHTML = `<p style="color:#39FF14; font-weight:bold; font-size:1.2em; margin:10px 0">${msg}</p>`;
    narrarTexto(msg);
  }

  // 3) Renderizar fichas arrastrables (1 ficha por cada factor individual)
  const zonaNumeros = document.getElementById("zonaNumeros");
  zonaNumeros.innerHTML = "";

  let factores = [];
  pares.forEach(([a,b])=>{
    factores.push(a);
    factores.push(b);
  });

  factores.forEach((f, idx)=>{
    crearFicha(f, `f${f}_${idx}`, zonaNumeros);
  });

  // 4) Renderizar zonas de drop
  const zonaDrop = document.getElementById("zonaDrop");
  zonaDrop.innerHTML = "";
  pares.forEach(([a,b])=>{
    const grupo = document.createElement("div");
    grupo.className = "grupo-pareja";
    grupo.style.display = "inline-flex";
    grupo.style.alignItems = "center";
    grupo.style.margin = "0 14px";

    const d1 = document.createElement("div");
    const d2 = document.createElement("div");
    d1.className = "drop"; d2.className = "drop";
    d1.dataset.pairA = a; d1.dataset.pairB = b;
    d2.dataset.pairA = a; d2.dataset.pairB = b;

    const x = document.createElement("span");
    x.textContent = " √ó ";
    x.style.margin = "0 8px";
    x.style.fontWeight = "bold";

    grupo.appendChild(d1);
    grupo.appendChild(x);
    grupo.appendChild(d2);
    zonaDrop.appendChild(grupo);
  });

  activarArrastreNivel4(pares);
}

// ===== Crear ficha con ID √∫nico =====
function crearFicha(valor, id, contenedor){
  const div = document.createElement("div");
  div.className = "ficha";
  div.textContent = valor;
  div.draggable  = true;
  div.dataset.valor = valor;
  div.id = id;
  div.addEventListener("dragstart", ev => ev.dataTransfer.setData("text", id));
  contenedor.appendChild(div);
}

// ===== L√≥gica de arrastre =====
function activarArrastreNivel4(pares){
  const zonaDrop = document.getElementById("zonaDrop");

  zonaDrop.addEventListener("dragover", ev => ev.preventDefault());

  zonaDrop.addEventListener("drop", ev=>{
    ev.preventDefault();
    const target = ev.target;
    if (!target.classList.contains("drop")) return;

    const fichaId = ev.dataTransfer.getData("text");
    const ficha = document.getElementById(fichaId);
    if (!ficha) return;

    const n = Number(ficha.dataset.valor);

    // Ya ocupado
    if (target.textContent.trim() !== "") { 
      sonidoError.play();
      efectoError(target);
      return; 
    }

    const a = Number(target.dataset.pairA);
    const b = Number(target.dataset.pairB);

    const grupo = target.parentElement;
    const drops = grupo.querySelectorAll(".drop");
    const other = drops[0] === target ? drops[1] : drops[0];
    const otherVal = other.textContent.trim();

    let ok = false;
    if (otherVal === "") {
      ok = (n === a || n === b);
    } else {
      const x = Number(otherVal);
      ok = ( (x === a && n === b) || (x === b && n === a) );
    }

    if (!ok) { 
      sonidoError.play();
      efectoError(target);
      efectoError(ficha);
      return; 
    }

    // ‚úÖ Encaje correcto
    target.textContent = String(n);
    target.classList.add("completado");
    ficha.style.display = "none";

    sonidoCorrecto.play();
    verificarNivel4(pares);
  });
}


// ===== Verificaci√≥n de finalizaci√≥n =====
function verificarNivel4(pares){
  const completos = document.querySelectorAll(".drop.completado").length;
  const totalNecesario = pares.length * 2; // siempre 2 casillas por par

  if (completos === totalNecesario){
    const estado = document.getElementById("estadoNivel4");
    if (!estado.querySelector(".msg-victoria")) {
      estado.innerHTML += "<h2 class='msg-victoria'>üéâ ¬°Nivel completado!</h2>";
      sonidoVictoria.play();
      mostrarToast("üéâ ¬°Nivel 4 completado!", "verde");
    }
  }
}


// üî¥ Vibraci√≥n + parpadeo rojo
function efectoError(el){
  el.style.animation = "vibrar 0.3s, parpadeoRojo 0.6s";
  el.style.background = "#e57373"; 
  setTimeout(()=>{
    el.style.animation = "";
    el.style.background = "";
  }, 600);
}


// ===== Narraci√≥n auxiliar =====
function narrarTexto(msg){
  if (typeof narracionHabilitada !== "undefined" && narracionHabilitada) {
    speechSynthesis.cancel();
    const utter = new SpeechSynthesisUtterance(msg);
    utter.lang = "es-ES";
    utter.rate = 1.0;
    speechSynthesis.speak(utter);
  }
}



// ===== Narraci√≥n autom√°tica y bot√≥n repetir (Nivel 4) =====
let narrandoNivel4 = false;
let narracionHabilitada = false;

function narrarNivel4(auto = false){
  if (!narracionHabilitada) return;

  // Si es autom√°tica, aplicamos candado para no repetir doble
  if (auto && narrandoNivel4) return;

  speechSynthesis.cancel();
  narrandoNivel4 = true;

  // üëâ Tomar el n√∫mero actual del input
  const num = Number(document.getElementById("inputNumeroNivel4").value) || 24; 
  // fallback en 24 si no hay nada escrito

  const texto = `Da clic en generar ejercicio, luego arrastra los n√∫meros hacia los cuadros para formar los pares de factores de ${num}. 
  Recuerda que el orden no importa, gracias a la propiedad conmutativa de la multiplicaci√≥n.`;

  const utter = new SpeechSynthesisUtterance(texto);
  utter.lang = "es-ES";
  utter.rate = 1.0;

  utter.onend = () => { narrandoNivel4 = false; };

  speechSynthesis.speak(utter);
}

// üëâ Auto-narraci√≥n SOLO cuando entro al Nivel 4
function cambiarPantalla(id){
  document.querySelectorAll(".pantalla").forEach(p=>p.classList.remove("activa"));
  const pantalla = document.getElementById(id);
  if(pantalla){
    pantalla.classList.add("activa");

    if(id === "pantallaNivel4" && narracionHabilitada){
      narrarNivel4(true); // üëà auto
    }
  }
}

// üëâ Bot√≥n repetir narraci√≥n (sin candado, siempre habla)
document.getElementById("btnRepetirNivel4").addEventListener("click", ()=>{
  if (!narracionHabilitada) return;
  speechSynthesis.cancel();
  setTimeout(()=> narrarNivel4(false), 100); // üëà siempre reproduce
});

// üëâ Bot√≥n para desbloquear narraciones al inicio
document.addEventListener("DOMContentLoaded", ()=>{
  const btn = document.createElement("button");
  btn.textContent = "üîä Activar narraci√≥n";
  btn.style.position = "fixed";
  btn.style.bottom = "20px";
  btn.style.right = "20px";
  btn.style.padding = "10px 15px";
  btn.style.zIndex = "9999";

  btn.addEventListener("click", ()=>{
    narracionHabilitada = true;
    const utterTest = new SpeechSynthesisUtterance(" ");
    utterTest.lang = "es-ES";
    speechSynthesis.speak(utterTest);
    mostrarToast("Narraci√≥n activada ‚úÖ", "azul");
    btn.remove();
  });

  document.body.appendChild(btn);
});



  // ===== Nivel 5: Producto de dos primos =====
  const ejercicios=[
    {numero:35, opciones:["5√ó7","3√ó11","2√ó19"], correcta:"5√ó7"},
    {numero:34, opciones:["2√ó17","11√ó3","5√ó5"], correcta:"2√ó17"},
    {numero:77, opciones:["7√ó11","13√ó5","19√ó2"], correcta:"7√ó11"},
    {numero:21, opciones:["3√ó7","2√ó11","5√ó5"], correcta:"3√ó7"}
  ];
  const contQuiz=document.getElementById("contenedorQuiz");
  let hechos=0;
  function cargarQuiz(){
    contQuiz.innerHTML="";
    hechos=0;
    ejercicios.forEach((ej,i)=>{
      const div=document.createElement("div");
      div.className="pregunta";
      let html=`<p>¬øCu√°l es la factorizaci√≥n prima de <b>${ej.numero}</b>?</p>`;
      ej.opciones.forEach(op=>{
        html+=`<button onclick="responderQuiz(${i},'${op}',this)">${op}</button> `;
      });
      html+=`<div class="feedback" id="fbq${i}"></div>`;
      div.innerHTML=html;
      contQuiz.appendChild(div);
    });
  }
  cargarQuiz();
function responderQuiz(i,resp,btn){
  const ej=ejercicios[i];
  const fb=document.getElementById("fbq"+i);
  if(resp===ej.correcta){
    fb.textContent="¬°Correcto!";
    fb.style.color="lightgreen";
    sonidoCorrecto.play();
    hechos++;
    mostrarToast("‚úÖ Bien hecho", "verde"); // üëà
  }else{
    fb.textContent="Incorrecto.";
    fb.style.color="red";
    sonidoError.play();
    mostrarToast("‚ùå Incorrecto", "dorado"); // üëà
  }
  btn.parentElement.querySelectorAll("button").forEach(b=>b.disabled=true);
  if(hechos===ejercicios.length){
    sonidoVictoria.play();
    mostrarToast("üöÄ Pasando al Arcade", "dorado");
    setTimeout(()=>iniciarArcade(),1500); // pasa al nivel 6
  }
}

  // ===== Nivel 6: Arcade =====
  let tiempo=30;
  let puntos=0;
  let intervaloArcade;
  let numeroActual;
  const canvasArc=document.getElementById("confetiArcade");
  const ctxArc=canvasArc.getContext("2d");
  let confetisArc=[], animArc;

  function iniciarArcade(){
    tiempo=30;
    puntos=0;
    document.getElementById("puntosArcade").textContent=puntos;
    document.getElementById("tiempoArcade").textContent=tiempo;
    cambiarPantalla("pantallaNivel6");
    nuevoNumeroArcade();
    intervaloArcade=setInterval(()=>{
      tiempo--;
      document.getElementById("tiempoArcade").textContent=tiempo;
      if(tiempo<=0){
        clearInterval(intervaloArcade);
        mostrarResultadosArcade();
      }
    },1000);
  }
  function nuevoNumeroArcade(){
    numeroActual=Math.floor(Math.random()*98)+2;
    document.getElementById("numeroReto").textContent=numeroActual;
  }
  function responderArcade(esPrimoSeleccion){
    if(esPrimo(numeroActual)===esPrimoSeleccion){
      puntos++;
      document.getElementById("puntosArcade").textContent=puntos;
      sonidoCorrecto.play();
    }else{
      sonidoError.play();
    }
    nuevoNumeroArcade();
  }

  // ===== Confeti Arcade =====
  function resizeCanvasArc(){
    canvasArc.width=window.innerWidth;
    canvasArc.height=200;
  }
  window.addEventListener("resize",resizeCanvasArc);
  resizeCanvasArc();
  function crearConfetiArc(){
    const colores=["#ff0","#0f0","#0ff","#f0f","#f00","#00f","#ffa500"];
    for(let i=0;i<120;i++){
      confetisArc.push({
        x:Math.random()*canvasArc.width,
        y:Math.random()*canvasArc.height-canvasArc.height,
        r:Math.random()*6+4,
        color:colores[Math.floor(Math.random()*colores.length)],
        velocidad:Math.random()*3+2
      });
    }
  }
  function dibujarConfetiArc(){
    ctxArc.clearRect(0,0,canvasArc.width,canvasArc.height);
    confetisArc.forEach(c=>{
      ctxArc.beginPath();
      ctxArc.arc(c.x,c.y,c.r,0,Math.PI*2);
      ctxArc.fillStyle=c.color;
      ctxArc.fill();
    });
    moverConfetiArc();
  }
  function moverConfetiArc(){
    confetisArc.forEach(c=>{
      c.y+=c.velocidad;
      if(c.y>canvasArc.height){
        c.y=-10;
        c.x=Math.random()*canvasArc.width;
      }
    });
  }
  function animarConfetiArc(){
    dibujarConfetiArc();
    animArc=requestAnimationFrame(animarConfetiArc);
  }
  function iniciarConfetiArc(){
    confetisArc=[];
    crearConfetiArc();
    animarConfetiArc();
  }
  function detenerConfetiArc(){
    cancelAnimationFrame(animArc);
    ctxArc.clearRect(0,0,canvasArc.width,canvasArc.height);
  }

  // ===== Ranking =====
  function guardarEnRanking(puntos,medalla){
    let ranking=JSON.parse(localStorage.getItem("rankingArcade")||"[]");
    const fecha=new Date().toLocaleString();
    ranking.push({puntos,medalla,fecha});
    ranking.sort((a,b)=>b.puntos-a.puntos);
    ranking=ranking.slice(0,5);
    localStorage.setItem("rankingArcade",JSON.stringify(ranking));
    mostrarRanking();
  }
  function mostrarRanking(){
    const ranking=JSON.parse(localStorage.getItem("rankingArcade")||"[]");
    const cuerpo=document.getElementById("cuerpoRanking");
    cuerpo.innerHTML="";
    ranking.forEach(r=>{
      const fila=document.createElement("tr");
      fila.innerHTML=`<td style="padding:6px 12px;">${r.puntos}</td>
                      <td style="padding:6px 12px;">${r.medalla}</td>
                      <td style="padding:6px 12px;">${r.fecha}</td>`;
      cuerpo.appendChild(fila);
    });
  }
  function mostrarResultadosArcade(){
    document.getElementById("puntajeFinalArcade").textContent=puntos;
    let medalla="";
    detenerConfetiArc();
    if(puntos<=5){
      medalla="ü•â Bronce";
    }else if(puntos<=12){
      medalla="ü•à Plata";
    }else{
      medalla="ü•á Oro";
      iniciarConfetiArc();
    }
    document.getElementById("medallaArcade").textContent=medalla;
    guardarEnRanking(puntos,medalla);
    mostrarToast("üèÜ Arcade terminado", "dorado");
    cambiarPantalla("pantallaArcadeFinal");
    sonidoVictoria.play();
  }
  function reiniciarArcade(){
    clearInterval(intervaloArcade);
    detenerConfetiArc();
    iniciarArcade();
  }

  // ===== Ranking Global =====
  function mostrarRankingGlobal(){
    const ranking=JSON.parse(localStorage.getItem("rankingArcade")||"[]");
    const cuerpo=document.getElementById("cuerpoRankingGlobal");
    cuerpo.innerHTML="";
    ranking.forEach((r,i)=>{
      const fila=document.createElement("tr");
      fila.className="fila-ranking";
      fila.style.animationDelay=`${i*0.4}s`;
      fila.innerHTML=`<td style="padding:6px 12px;">${r.puntos}</td>
                      <td style="padding:6px 12px;">${r.medalla}</td>
                      <td style="padding:6px 12px;">${r.fecha}</td>`;
      cuerpo.appendChild(fila);
    });
    cambiarPantalla("pantallaRankingGlobal");
    sonidoScoreboard.currentTime=0;
    sonidoScoreboard.play();
  }



function mostrarMultiplos(primo) {
  const gridM = document.getElementById("gridMultiplos");
  gridM.innerHTML = "";
  let multiplos = [];
  for (let i = primo * 2; i <= 100; i += primo) {
    multiplos.push(i);
  }
  document.querySelector("#tablaMultiplos h3").textContent = `M√∫ltiplos de ${primo}`;
  
  multiplos.forEach(m => {
    const div = document.createElement("div");
    div.textContent = m;
    div.id = "m" + m;  // üëâ identificador √∫nico
    div.style.background = "#ffffff33";
    div.style.padding = "10px";
    div.style.borderRadius = "6px";
    div.style.textAlign = "center";
    div.style.fontWeight = "bold";
    gridM.appendChild(div);
  });
}


function mostrarToast(mensaje, color="default") {
  const toast = document.getElementById("toast");
  toast.textContent = mensaje;

  // üé® Colores din√°micos
  if (color === "verde") {
    toast.style.background = "#2e7d32";
    toast.style.color = "#fff";
  } else if (color === "azul") {
    toast.style.background = "#1565c0";
    toast.style.color = "#fff";
  } else if (color === "dorado") {
    toast.style.background = "#ffb300";
    toast.style.color = "#000";
  } else {
    toast.style.background = "#333";
    toast.style.color = "#fff";
  }

  // üé∂ Sonido
  sonidoToast.currentTime = 0;
  sonidoToast.play();

  // üëâ Animaci√≥n con rebote
  toast.style.opacity = "1";
  toast.style.animation = "slideUpBounce 0.8s ease forwards";

  // Ocultar despu√©s de 2s con fade out
  setTimeout(() => {
    toast.style.opacity = "0";
  }, 2000);
}



</script>



</body>
</html>


