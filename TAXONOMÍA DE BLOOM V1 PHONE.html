<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Juego Bloom Docente</title>

<!-- Librer√≠as -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>



<style>
:root{
  --txt:#fff; --borde:#334155; --panel:#111827; --bg:#0b1022;
}
body{
  margin:0; background:var(--bg); color:var(--txt);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
}
header{padding:16px; text-align:center}
h1{margin:0; font-size:20px}
button{
  border:1px solid var(--borde); background:#1f2937;
  color:var(--txt); padding:8px 12px; border-radius:8px;
  font-weight:700; cursor:pointer; margin:4px 2px;
}
.panel{background:var(--panel); border:1px solid var(--borde);
  border-radius:12px; padding:12px; margin:12px}
.bank{padding:12px}
.card{
  padding:12px;
  background:#1e293b;
  border:2px solid #a78bfa; /* üíú Borde morado */
  border-radius:14px;
  text-align:center;
  font-weight:700;
  margin-bottom:10px;
  font-size:20px;
  color:#fff;
  box-shadow:0 0 10px rgba(167,139,250,0.6); /* ‚ú® Brillo suave */
}
.levels{display:grid; gap:10px; margin:12px}
.lvl{padding:10px; border-radius:12px; border:2px dashed var(--borde);}
.lvl h4{margin:0 0 4px; font-size:14px}
.lvl ul{margin:4px 0 0 14px; padding:0; font-size:16px;
  line-height:1.4; column-count:2; column-gap:20px; list-style:disc}
.lvl[data-level="1"]{border-color:#ef4444}
.lvl[data-level="2"]{border-color:#f79c00}
.lvl[data-level="3"]{border-color:#ffee52}
.lvl[data-level="4"]{border-color:#22c55e}

/* Botones de nivel */
.level-buttons{
  display:flex; justify-content:center; gap:12px; margin:10px 0;
}
.btn-lvl{
  width:55px; height:55px;
  border:none; border-radius:10px;
  font-weight:700; font-size:18px;
  color:#fff; cursor:pointer;
  transition: all 0.3s ease;
}
.btn1{background:#ef4444;} /* Rojo */
.btn2{background:#f79c00;} /* Naranja */
.btn3{background:#ffee52; color:#000;} /* Amarillo con texto negro */
.btn4{background:#22c55e;} /* Verde */

/* Modal */
.modal{position:fixed; inset:0; display:none; place-items:center;
  background:rgba(0,0,0,.6); z-index:1000}
.modal-card{background:#1e293b; border:1px solid #334155;
  border-radius:14px; padding:20px; max-width:95%; max-height:90%;
  overflow:auto; color:#fff}




</style>


</head>
<body>
<header>
  <h1>üéØ Juego Bloom Docente</h1>
  <p>Clasifica verbos en niveles de Bloom: SABER ‚Üí HACER ‚Üí SER</p>
</header>

<!-- Nombre -->
<div id="gate" class="panel">
  <h3>üë§ Ingrese su nombre</h3>
  <input id="teacherName" placeholder="Nombre completo" style="padding:8px;width:90%;border-radius:6px;border:1px solid #555">
  <button onclick="startGame()">Comenzar</button>
</div>

<!-- Juego -->
<div id="game" style="display:none">
  <div class="panel bank">
    <h3 id="dimTitle">üìò SABER</h3>
    <div id="bank"></div>

    <!-- Botones de nivel -->
    <div class="level-buttons">
      <button class="btn-lvl btn1" onclick="pressBtn(1)">1</button>
      <button class="btn-lvl btn2" onclick="pressBtn(2)">2</button>
      <button class="btn-lvl btn3" onclick="pressBtn(3)">3</button>
      <button class="btn-lvl btn4" onclick="pressBtn(4)">4</button>
    </div>

    <button onclick="skipCard()">‚è≠Ô∏è Saltar tarjeta</button>
  </div>
  <div class="panel">
    <div class="levels" id="levels"></div>
    <div style="text-align:center;margin-top:10px">
      <button onclick="endRound()">Finalizar Ronda</button>
    </div>
  </div>
</div>

<!-- Modal resultados -->
<div class="modal" id="modal">
  <div class="modal-card">
    <h3>üìä Resultados</h3>
    <div id="summary"></div>
    <canvas id="chartResumen" style="max-height:240px;margin:10px 0"></canvas>
    <div style="margin-top:10px;text-align:center">
      <button onclick="showErrors()">üìä Ver errores por dimensi√≥n</button>
      <button onclick="downloadExcel()">üì• Excel</button>
      <button onclick="downloadPDF()">üìÑ PDF</button>
      <button onclick="closeModal()">Cerrar</button>
    </div>
  </div>
</div>

<!-- Modal Errores -->
<div class="modal" id="modalErrores">
  <div class="modal-card">
    <h3>‚ùå Errores por dimensi√≥n</h3>
    <div id="erroresWrap"></div>
    <canvas id="chartComp" style="max-height:240px;margin:10px 0"></canvas>
    <div style="margin-top:10px;text-align:center">
      <button onclick="closeErrores()">Cerrar</button>
    </div>
  </div>
</div>

<script>
const DATA = {
  saber:{4:["Evaluar","Argumentar","Justificar"],3:["Aplicar","Analizar"],2:["Comprender","Describir"],1:["Recordar","Nombrar"]},
  hacer:{4:["Automatizar","Optimizar"],3:["Coordinar","Implementar"],2:["Ejecutar","Practicar"],1:["Imitar","Copiar"]},
  ser:{4:["Interiorizar","Liderar"],3:["Valorar","Promover"],2:["Responder","Participar"],1:["Atender","Escuchar"]}
};
const DIM_ORDER=["saber","hacer","ser"];
const TITLE={saber:"üìò SABER",hacer:"üõ†Ô∏è HACER",ser:"ü§ù SER"};

let teacher="", currentDim=0, queue=[], current=null, STATS={};
let chartCompInstance=null;

function startGame(){
  teacher=document.getElementById("teacherName").value||"Docente";
  document.getElementById("gate").style.display="none";
  document.getElementById("game").style.display="block";
  startDimension(0);
}
function startDimension(i){
  currentDim=i; document.getElementById("dimTitle").textContent=TITLE[DIM_ORDER[i]];
  buildQueue(); renderCard(); buildLevels();
}
function buildQueue(){
  const dim=DIM_ORDER[currentDim]; queue=[];
  Object.keys(DATA[dim]).forEach(lvl=>{
    DATA[dim][lvl].forEach(v=>{
      queue.push({verb:v,level:+lvl});
      if(!STATS[dim])STATS[dim]={};
      STATS[dim][v]={wrong:0,placed:false,level:+lvl};
    });
  });
  shuffle(queue);
}
function renderCard(){
  const bank=document.getElementById("bank"); bank.innerHTML="";
  if(queue.length===0){bank.innerHTML="<em>Sin tarjetas</em>";return;}
  current=queue[0];
  const c=document.createElement("div"); c.className="card"; c.textContent=current.verb;
  bank.appendChild(c);
}
function buildLevels(){
  const lvls=document.getElementById("levels"); lvls.innerHTML="";
  for(let i=1;i<=4;i++){
    const box=document.createElement("div"); box.className="lvl"; box.dataset.level=i;
    const h=document.createElement("h4"); h.textContent="Nivel "+i;
    const list=document.createElement("ul"); list.id="list"+i;
    box.appendChild(h); box.appendChild(list);
    box.onclick=()=>tryPlace(i,box);
    lvls.appendChild(box);
  }
}
function tryPlace(lvl,box){
  if(!current)return;
  if(current.level===lvl){
    const li=document.createElement("li"); li.textContent=current.verb;
    document.getElementById("list"+lvl).appendChild(li);
    STATS[DIM_ORDER[currentDim]][current.verb].placed=true;
    queue.shift(); renderCard();
  }else{
    STATS[DIM_ORDER[currentDim]][current.verb].wrong++;
    alert("‚ùå Error, piensa de nuevo");
  }
}
function pressBtn(nivel){
  const box=document.querySelector(`.lvl[data-level="${nivel}"]`);
  if(box){ tryPlace(nivel, box); }
}
function skipCard(){ if(queue.length>1){queue.push(queue.shift()); renderCard();} }
function endRound(){ document.getElementById("modal").style.display="grid"; renderSummary(); }

function renderSummary(){
  const sum=document.getElementById("summary"); sum.innerHTML="";
  let total=0, aciertos=0, errores=0;
  DIM_ORDER.forEach(dim=>{
    Object.values(STATS[dim]).forEach(st=>{
      total++; if(st.placed) aciertos++; errores+=st.wrong;
    });
  });
  sum.innerHTML=`<p>Profesor ${teacher}, completaste <strong>${aciertos}/${total}</strong> verbos. Errores: <strong>${errores}</strong></p>`;
  const ctx=document.getElementById("chartResumen");
  new Chart(ctx,{type:"doughnut",data:{labels:["Aciertos","Errores"],datasets:[{data:[aciertos,errores],backgroundColor:["#22c55e","#ef4444"]}]},
    options:{plugins:{legend:{labels:{color:"#fff"}}}}});
}

function showErrors(){
  document.getElementById("modal").style.display="none";
  document.getElementById("modalErrores").style.display="grid";
  const wrap=document.getElementById("erroresWrap"); wrap.innerHTML="";
  DIM_ORDER.forEach(dim=>{
    const d=document.createElement("div");
    d.innerHTML=`<h4>${TITLE[dim]}</h4>`;
    Object.keys(DATA[dim]).forEach(l=>{
      const ul=document.createElement("ul");
      ul.style.border="2px dashed "+(l==1?"#ef4444":l==2?"#f59e0b":l==3?"#eab308":"#22c55e");
      DATA[dim][l].forEach(v=>{
        const st=STATS[dim][v]; if(st.wrong>0){
          const li=document.createElement("li"); li.textContent=`${v} ‚Üí ${st.wrong} errores`;
          ul.appendChild(li);
        }
      });
      if(ul.children.length>0) d.appendChild(ul);
    });
    wrap.appendChild(d);
  });
  renderCompChart();
}
function renderCompChart(){
  const ctx=document.getElementById("chartComp").getContext("2d");
  if(chartCompInstance){ chartCompInstance.destroy(); }
  const labels=["Nivel 1","Nivel 2","Nivel 3","Nivel 4"];
  const saber=[0,0,0,0],hacer=[0,0,0,0],ser=[0,0,0,0];
  DIM_ORDER.forEach(dim=>{
    Object.keys(DATA[dim]).forEach(l=>{
      DATA[dim][l].forEach(v=>{
        const st=STATS[dim][v]; if(st.wrong>0){
          const idx=(+l)-1;
          if(dim==="saber") saber[idx]+=st.wrong;
          if(dim==="hacer") hacer[idx]+=st.wrong;
          if(dim==="ser") ser[idx]+=st.wrong;
        }
      });
    });
  });
  chartCompInstance=new Chart(ctx,{
    type:"bar",
    data:{labels:labels,datasets:[
      {label:"SABER",data:saber,backgroundColor:"#38bdf8"},
      {label:"HACER",data:hacer,backgroundColor:"#fb923c"},
      {label:"SER",data:ser,backgroundColor:"#34d399"}]},
    options:{
      plugins:{legend:{labels:{color:"#fff"}},tooltip:{callbacks:{
        label:function(c){
          const total=c.dataset.data.reduce((a,b)=>a+b,0);
          const val=c.parsed.y;
          const pct=total?((val/total*100).toFixed(1)+"%"):"0%";
          return `${c.dataset.label}: ${val} (${pct})`;
        }}}},
      scales:{
        x:{ticks:{color:"#fff"},grid:{color:"rgba(255,255,255,0.15)"}},
        y:{ticks:{color:"#fff"},grid:{color:"rgba(255,255,255,0.15)"}}
      }
    }
  });
}

function closeModal(){document.getElementById("modal").style.display="none";}
function closeErrores(){document.getElementById("modalErrores").style.display="none";}

function downloadExcel(){
  const wb=XLSX.utils.book_new(); const rows=[["Dimensi√≥n","Nivel","Verbo","Errores"]];
  DIM_ORDER.forEach(dim=>{
    Object.keys(DATA[dim]).forEach(l=>{
      DATA[dim][l].forEach(v=>{
        const st=STATS[dim][v]; rows.push([dim,l,v,st.wrong]);
      });
    });
  });
  const ws=XLSX.utils.aoa_to_sheet(rows);
  XLSX.utils.book_append_sheet(wb,ws,"Errores");
  XLSX.writeFile(wb,`Informe_Bloom_${teacher}.xlsx`);
}

async function downloadPDF(){
  const { jsPDF }=window.jspdf; const doc=new jsPDF();
  doc.setFontSize(14); doc.text(`Informe Bloom ‚Äì ${teacher}`,14,20);
  const rows=[]; DIM_ORDER.forEach(dim=>{
    Object.keys(DATA[dim]).forEach(l=>{
      DATA[dim][l].forEach(v=>{
        const st=STATS[dim][v]; if(st.wrong>0) rows.push([dim,l,v,st.wrong]);
      });
    });
  });
  doc.autoTable({head:[["Dim","Nivel","Verbo","Errores"]],body:rows,startY:30});
  let maxErr=0, maxDim="", maxLvl="";
  DIM_ORDER.forEach(dim=>{
    Object.keys(DATA[dim]).forEach(l=>{
      DATA[dim][l].forEach(v=>{
        const st=STATS[dim][v]; if(st.wrong>maxErr){maxErr=st.wrong; maxDim=dim; maxLvl=l;}
      });
    });
  });
  const resumen=maxErr>0?
    `Profesor ${teacher}, la mayor concentraci√≥n de errores estuvo en Nivel ${maxLvl} de la dimensi√≥n ${maxDim.toUpperCase()} (${maxErr} errores).`:
    `Profesor ${teacher}, no se registraron errores significativos.`;
  doc.text(resumen,14,doc.lastAutoTable.finalY+10);
  doc.save(`Informe_Bloom_${teacher}.pdf`);
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}


function playFeedback(success, nivel){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();

  if(success){
    // üéµ "Tin-tin" ‚Üí dos tonos agudos cortos
    const freqs = [1000, 1400];
    freqs.forEach((f, i)=>{
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.type = "sine";
      osc.frequency.value = f;
      gain.gain.setValueAtTime(0.2, ctx.currentTime + i*0.15);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i*0.15 + 0.15);
      osc.start(ctx.currentTime + i*0.15);
      osc.stop(ctx.currentTime + i*0.15 + 0.15);
    });
  } else {
    // ‚ùå Error: tono grave
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type = "sine";
    osc.frequency.value = 200;
    gain.gain.setValueAtTime(0.25, ctx.currentTime);
    osc.start();
    osc.stop(ctx.currentTime + 0.3);
  }

  // üì≥ Vibraci√≥n
  if(navigator.vibrate){
    navigator.vibrate(success ? [80, 80, 80] : 300); 
  }

  // üåü Feedback visual en bot√≥n
  const btn = document.querySelector(`.btn-lvl.btn${nivel}`);
  if(btn){
    btn.style.boxShadow = success ? "0 0 10px 3px #22c55e" : "0 0 10px 3px #ef4444";
    btn.style.transform = "scale(1.1)";
    setTimeout(()=>{
      btn.style.boxShadow = "";
      btn.style.transform = "";
    },400);
  }

  // üé® Feedback visual en tarjeta + ‚ú® destello m√°gico
  const card = document.querySelector(".card");
  if(card){
    if(success){
      card.style.position = "relative";
      const flash = document.createElement("div");
      flash.style.position = "absolute";
      flash.style.inset = "-10px";
      flash.style.borderRadius = "12px";
      flash.style.background = "radial-gradient(circle, rgba(34,197,94,0.6) 0%, transparent 70%)";
      flash.style.zIndex = "-1";
      flash.style.animation = "flashEffect 0.6s ease-out forwards";
      card.appendChild(flash);
      setTimeout(()=> flash.remove(),600);
    }
    card.style.backgroundColor = success ? "#064e3b" : "#7f1d1d"; 
    card.style.color = "#fff";
    setTimeout(()=>{
      card.style.backgroundColor = "#1e293b";
      card.style.color = "#fff";
    },400);
  }
}

// ‚ú® Animaci√≥n CSS del destello
const style = document.createElement("style");
style.textContent = `
@keyframes flashEffect {
  0% { opacity: 1; transform: scale(0.9); }
  70% { opacity: 0.6; transform: scale(1.2); }
  100% { opacity: 0; transform: scale(1.5); }
}`;
document.head.appendChild(style);

function tryPlace(lvl,box){
  if(!current) return;

  if(current.level === lvl){
    const li=document.createElement("li"); 
    li.textContent=current.verb;
    document.getElementById("list"+lvl).appendChild(li);
    STATS[DIM_ORDER[currentDim]][current.verb].placed=true;
    queue.shift(); 
    renderCard();
    playFeedback(true, lvl); // üéµ‚úÖ Acierto
  } else {
    STATS[DIM_ORDER[currentDim]][current.verb].wrong++;
    playFeedback(false, lvl); // üéµ‚ùå Error (sin alertas)
  }
}



</script>
</body>
</html>
