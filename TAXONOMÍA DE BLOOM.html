<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Taxonom√≠a de Bloom ‚Äì Equipos + Cron√≥metro + Examen</title>
<style>
  :root{
    --bg:#0b1022; --panel:#111827; --borde:#1f2937; --txt:#e5e7eb; --muted:#9ca3af;
    --green:#22c55e; --yellow:#f59e0b; --red:#ef4444; --blue:#22d3ee; --vio:#a78bfa;
    --saber:#38bdf8; --hacer:#fb923c; --ser:#34d399;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
       color:var(--txt); background:radial-gradient(1200px 800px at 70% -20%, #1f2937, #0b1022) fixed;}
  header{padding:20px clamp(16px,4vw,40px)}
  h1{margin:0 0 6px; font-size:clamp(22px,3.6vw,34px)}
  .sub{margin:0; color:var(--muted); font-size:clamp(12px,2.4vw,14px)}

  .wrap{display:grid; gap:clamp(12px,2vw,18px); grid-template-columns:1fr; padding:0 clamp(16px,4vw,40px) 26px}
  @media(min-width:1200px){ .wrap{grid-template-columns:2.5fr 1.1fr} }

  .panel{background:rgba(17,24,39,.6); border:1px solid var(--borde); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.45); backdrop-filter: blur(6px)}
  .top{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px 16px; border-bottom:1px solid var(--borde); flex-wrap:wrap}
  .hud{display:flex; gap:12px; flex-wrap:wrap; align-items:center; color:var(--muted); font-size:13px}
  .chip{padding:6px 10px; border:1px solid #334155; border-radius:999px; background:#0b1224; color:#e5e7eb; font-weight:800}
  .chip.good{border-color:#14532d; background:#0b1c14}
  .controls{display:flex; gap:8px; flex-wrap:wrap}
  button{border:1px solid var(--borde); background:#0b1224; color:#e5e7eb; cursor:pointer; padding:8px 12px; border-radius:10px; font-weight:700}
  button:hover{border-color:#334155; box-shadow:0 6px 16px rgba(34,211,238,.15), inset 0 1px 0 rgba(255,255,255,.04)}
  .btn-lite{opacity:.9}
  input, select{background:#0b1224; color:#e5e7eb; border:1px solid #334155; border-radius:10px; padding:6px 10px}

  .board{padding:16px}
  .grid{display:grid; gap:12px}
  @media(min-width:900px){ .grid{grid-template-columns:repeat(3,1fr)} }

  .dim{border:1px solid var(--borde); border-radius:14px; overflow:hidden; background:#0b1224;}
  .dim-header{display:flex; align-items:center; gap:8px; padding:10px 12px; border-bottom:1px solid #223048; font-weight:900; letter-spacing:.02em}
  .dim.saber .dim-header{background:linear-gradient(90deg, rgba(56,189,248,.18), transparent); color:#dff6ff}
  .dim.hacer .dim-header{background:linear-gradient(90deg, rgba(251,146,60,.18), transparent); color:#fff3e6}
  .dim.ser   .dim-header{background:linear-gradient(90deg, rgba(52,211,153,.18), transparent); color:#eafff5}

  .levels{display:grid; gap:10px; padding:12px}
  .level{border:1px dashed #2b3b57; border-radius:12px; padding:10px; min-height:110px; position:relative}
  .level h4{margin:0 0 8px; font-size:14px; color:#cbd5e1}
  .dropzone{display:flex; flex-wrap:wrap; gap:8px; min-height:52px}
  .hint{position:absolute; inset:auto 10px 10px auto; color:#9ca3af; font-size:12px}
  .hint.hidden{display:none}

  /* ---------- BANCO: ancho completo + rejilla uniforme ---------- */
  .bank{padding:12px 14px}
  .bank h3{margin:0 0 8px; font-size:16px}

  /* Rejilla fluida que se adapta al ancho disponible */
  .bank-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* ajusta 160‚Üí140/180 si prefieres */
    gap:12px;
    align-items:start;
    min-height:70px;
  }
  /* Las tarjetas llenan su celda */
  .bank-grid .card{width:100%; justify-content:center}

  /* En escritorio: el banco ocupa TODA la fila (ambas columnas) */
  @media (min-width:1200px){
    .wrap{ grid-template-columns: 2.5fr 1.1fr; }
    .bank{
      grid-column: 1 / -1;   /* ocupa todo el ancho */
      position: static;
      max-height: none;
      overflow: visible;
      margin-top: 8px;
    }
  }

  .card{
    --bgc:#0e162a;
    display:inline-flex; align-items:center; gap:6px;
    padding:8px 10px; border-radius:12px; border:1px solid #2a3a59;
    background:var(--bgc); color:#e5e7eb; font-weight:800; letter-spacing:.01em;
    box-shadow:0 4px 12px rgba(0,0,0,.35); user-select:none; touch-action:none;
    transition:transform .1s ease, box-shadow .1s ease;
  }
  .card[data-dim="saber"]{--bgc:rgba(56,189,248,.10); border-color:rgba(56,189,248,.35)}
  .card[data-dim="hacer"]{--bgc:rgba(251,146,60,.10);  border-color:rgba(251,146,60,.35)}
  .card[data-dim="ser"]  {--bgc:rgba(52,211,153,.10);  border-color:rgba(52,211,153,.35)}

  .card.dragging{position:fixed; z-index:1000; pointer-events:none;
    box-shadow:0 10px 22px rgba(0,0,0,.55); transform:scale(1.04) rotate(-1deg)}
  .card.locked{background:linear-gradient(180deg, rgba(34,197,94,.18), rgba(0,0,0,.04));
    border-color:#14532d; color:#dcfce7}

  /* Lateral: Equipos y Cron√≥metro */
  .side{position:sticky; top:16px}
  .box{padding:12px 14px; border-bottom:1px solid var(--borde)}
  .box h3{margin:0 0 8px; font-size:16px}
  .flex{display:flex; gap:8px; flex-wrap:wrap}
  .row{display:flex; align-items:center; gap:6px; margin-top:6px}
  .timer{font-weight:900; font-size:22px; letter-spacing:.04em}
  .timer.low{color:#ffd1d1}

  .teams{display:grid; gap:8px}
  .team{display:flex; align-items:center; justify-content:space-between; gap:8px;
        background:#0b1224; border:1px solid #334155; border-radius:12px; padding:8px 10px}
  .team.active{outline:2px solid var(--vio)}
  .score{font-weight:900}

  /* Botones del banco */
  #sortAZ, #shuffleBank{
    border:1px solid #334155; background:#0b1224; color:#e5e7eb;
    cursor:pointer; padding:6px 10px; border-radius:8px; font-weight:700;
  }
  #sortAZ:hover, #shuffleBank:hover{ border-color:#475569; box-shadow:0 0 8px rgba(255,255,255,.1) }

  /* Modal final */
  .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.4); z-index:1001}
  .card-modal{background:#0b1224; border:1px solid #334155; border-radius:16px; padding:22px; max-width:560px; text-align:center}
  .card-modal h3{margin:0 0 6px}
  .card-modal p{margin:6px 0 12px; color:#cbd5e1}
</style>
</head>
<body>
<header>
  <h1>Taxonom√≠a de Bloom ‚Äì Equipos + Cron√≥metro + Examen</h1>
  <p class="sub">Organiza los <strong>verbos</strong> por dimensi√≥n y nivel. Juega por equipos con tiempo y puntuaci√≥n.</p>
</header>

<div class="wrap">
  <!-- TABLERO -->
  <section class="panel">
    <div class="top">
      <div class="hud">
        <span class="chip">Aciertos: <strong id="ok">0</strong>/<strong id="total">0</strong></span>
        <span class="chip">Restantes: <strong id="left">0</strong></span>
        <span class="chip" id="examBadge" style="display:none">Modo Examen</span>
      </div>
      <div class="controls">
        <button id="reshuffle">üîÄ Reorganizar verbos</button>
        <button id="reset">‚Üª Reiniciar</button>
      </div>
    </div>

    <div class="board">
      <div class="grid" id="grid">

        <!-- SABER -->
        <div class="dim saber" data-dim="saber">
          <div class="dim-header">üìò SABER (Cognitivo)</div>
          <div class="levels">
            <div class="level" data-dim="saber" data-level="1">
              <h4>Nivel 1 ‚Äì Bajo</h4>
              <div class="dropzone"></div>
              <div class="hint">recordar, identificar, reconocer, definir, listar, nombrar</div>
            </div>
            <div class="level" data-dim="saber" data-level="2">
              <h4>Nivel 2 ‚Äì B√°sico</h4>
              <div class="dropzone"></div>
              <div class="hint">comprender, describir, explicar, interpretar, ejemplificar, clasificar, refinar</div>
            </div>
            <div class="level" data-dim="saber" data-level="3">
              <h4>Nivel 3 ‚Äì Alto</h4>
              <div class="dropzone"></div>
              <div class="hint">aplicar, analizar, comparar, organizar, diferenciar, contrastar, revisar</div>
            </div>
            <div class="level" data-dim="saber" data-level="4">
              <h4>Nivel 4 ‚Äì Superior</h4>
              <div class="dropzone"></div>
              <div class="hint">evaluar, argumentar, justificar, dise√±ar, formular, crear, innovar, planificar, concebir, dise√±ar prompts</div>
            </div>
          </div>
        </div>

        <!-- HACER -->
        <div class="dim hacer" data-dim="hacer">
          <div class="dim-header">üõ†Ô∏è HACER (Psicomotor)</div>
          <div class="levels">
            <div class="level" data-dim="hacer" data-level="1">
              <h4>Nivel 1 ‚Äì Bajo</h4>
              <div class="dropzone"></div>
              <div class="hint">imitar, copiar, seguir instrucciones, manipular con ayuda</div>
            </div>
            <div class="level" data-dim="hacer" data-level="2">
              <h4>Nivel 2 ‚Äì B√°sico</h4>
              <div class="dropzone"></div>
              <div class="hint">ejecutar, practicar, demostrar, operar, utilizar con apoyo</div>
            </div>
            <div class="level" data-dim="hacer" data-level="3">
              <h4>Nivel 3 ‚Äì Alto</h4>
              <div class="dropzone"></div>
              <div class="hint">coordinar, implementar, integrar, perfeccionar, aplicar con autonom√≠a</div>
            </div>
            <div class="level" data-dim="hacer" data-level="4">
              <h4>Nivel 4 ‚Äì Superior</h4>
              <div class="dropzone"></div>
              <div class="hint">automatizar, optimizar, transferir, innovar, trazar estrategias, combinar herramientas</div>
            </div>
          </div>
        </div>

        <!-- SER -->
        <div class="dim ser" data-dim="ser">
          <div class="dim-header">ü§ù SER (Afectivo/Actitudinal)</div>
          <div class="levels">
            <div class="level" data-dim="ser" data-level="1">
              <h4>Nivel 1 ‚Äì Bajo</h4>
              <div class="dropzone"></div>
              <div class="hint">atender, escuchar, aceptar, mostrar disposici√≥n</div>
            </div>
            <div class="level" data-dim="ser" data-level="2">
              <h4>Nivel 2 ‚Äì B√°sico</h4>
              <div class="dropzone"></div>
              <div class="hint">responder, participar, colaborar, respetar, cumplir</div>
            </div>
            <div class="level" data-dim="ser" data-level="3">
              <h4>Nivel 3 ‚Äì Alto</h4>
              <div class="dropzone"></div>
              <div class="hint">valorar, argumentar, promover, asumir responsabilidades, ser consciente</div>
            </div>
            <div class="level" data-dim="ser" data-level="4">
              <h4>Nivel 4 ‚Äì Superior</h4>
              <div class="dropzone"></div>
              <div class="hint">interiorizar, liderar, modelar, transformar, influir positivamente, validar √©ticamente</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- LATERAL: EQUIPOS + TIMER + EXAMEN -->
  <aside class="panel side">
    <div class="box">
      <h3>‚è±Ô∏è Cron√≥metro</h3>
      <div class="row">
        <label>Min:</label><input type="number" id="min" value="5" min="1" style="width:64px">
        <label>Seg:</label><input type="number" id="sec" value="0" min="0" max="59" style="width:64px">
      </div>
      <div class="row" style="margin-top:10px">
        <span id="timer" class="timer">05:00</span>
      </div>
      <div class="flex" style="margin-top:8px">
        <button id="start" class="btn-lite">‚ñ∂ Iniciar</button>
        <button id="pause" class="btn-lite">‚è∏ Pausa</button>
        <button id="restart" class="btn-lite">‚Ü∫ Reiniciar</button>
      </div>
      <div class="row" style="margin-top:8px">
        <label><input type="checkbox" id="exam"> Modo Examen</label>
      </div>
      <small class="muted">En examen: se ocultan pistas, -5 puntos por error y no se puede reordenar.</small>
    </div>

    <div class="box">
      <h3>üë• Equipos</h3>
      <div class="row">
        <label>N¬∞ de equipos</label>
        <select id="teamCount">
          <option>2</option><option>3</option><option>4</option>
        </select>
        <button id="applyTeams" class="btn-lite">Aplicar</button>
      </div>
      <div class="teams" id="teams"></div>
      <div class="flex" style="margin-top:10px">
        <button id="prevTeam">‚óÄ Anterior</button>
        <button id="nextTeam">Siguiente ‚ñ∂</button>
      </div>
    </div>

    <div class="box">
      <h3>üìé Ayuda</h3>
      <small class="muted">Turno: el equipo activo recibe puntos al acertar. En error, puedes cambiar de turno.</small>
    </div>
  </aside>

  <!-- BANCO (ahora es hermano de section y aside y ocupa todo el ancho) -->
  <div class="bank panel">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; flex-wrap:wrap; gap:6px;">
      <h3 style="margin:0">üóÇÔ∏è Verbos desordenados</h3>
      <div style="display:flex; gap:6px;">
        <button id="sortAZ">üî§ Ordenar A‚ÄìZ</button>
        <button id="shuffleBank">üîÄ Desordenar</button>
      </div>
    </div>
    <div id="bank" class="bank-grid"></div>
  </div>
</div>

<!-- MODAL FINAL -->
<div class="modal" id="modal">
  <div class="card-modal">
    <h3>üéâ ¬°Fin de la ronda!</h3>
    <p id="finalMsg">Resultados‚Ä¶</p>
    <button id="closeModal">Aceptar</button>
  </div>
</div>

<script>
/* ================== Datos base ================== */

const DRAG_THRESHOLD = 6; // px: distancia m√≠nima para considerar que s√≠ se arrastr√≥


const DATA = {
  saber: {
    4: ["Evaluar","Argumentar","Justificar","Dise√±ar","Formular","Crear","Innovar","Planificar","Concebir","Dise√±ar Prompts"],
    3: ["Aplicar","Analizar","Comparar","Organizar","Diferenciar","Contrastar","Revisar","Refinar"],
    2: ["Comprender","Describir","Explicar","Interpretar","Ejemplificar","Clasificar"],
    1: ["Recordar","Identificar","Reconocer","Definir","Listar","Nombrar"]
  },
  hacer: {
    4: ["Automatizar","Optimizar","Transferir","Innovar","Trazar Estrategias","Combinar Herramientas"],
    3: ["Coordinar","Implementar","Integrar","Perfeccionar","Aplicar Con Autonom√≠a"],
    2: ["Ejecutar","Practicar","Demostrar","Operar","Utilizar Con Apoyo"],
    1: ["Imitar","Copiar","Seguir Instrucciones","Manipular Con Ayuda"]
  },
  ser: {
    4: ["Interiorizar","Liderar","Modelar","Transformar","Influir Positivamente","Validar √âticamente"],
    3: ["Valorar","Argumentar","Promover","Asumir Responsabilidades","Ser Consciente"],
    2: ["Responder","Participar","Colaborar","Respetar","Cumplir"],
    1: ["Atender","Escuchar","Aceptar","Mostrar Disposici√≥n"]
  }
};
const bankEl = document.getElementById('bank');
const okEl = document.getElementById('ok');
const totalEl = document.getElementById('total');
const leftEl = document.getElementById('left');
const modal = document.getElementById('modal');
const finalMsg = document.getElementById('finalMsg');
const closeModal = document.getElementById('closeModal');
const btnReset = document.getElementById('reset');
const btnShuffle = document.getElementById('reshuffle');
const timerEl = document.getElementById('timer');
const minEl = document.getElementById('min');
const secEl = document.getElementById('sec');
const startBtn = document.getElementById('start');
const pauseBtn = document.getElementById('pause');
const restartBtn = document.getElementById('restart');
const examChk = document.getElementById('exam');
const examBadge = document.getElementById('examBadge');

const teamsEl = document.getElementById('teams');
const teamCountEl = document.getElementById('teamCount');
const applyTeamsBtn = document.getElementById('applyTeams');
const prevTeamBtn = document.getElementById('prevTeam');
const nextTeamBtn = document.getElementById('nextTeam');

/* ====== Audio m√≠nimo (ding/buzz) ====== */
let audioCtx;
function ding(){ try{ audioCtx=audioCtx||new (window.AudioContext||window.webkitAudioContext)();
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.type='triangle'; o.frequency.value=900; g.gain.value=0.001;
  o.connect(g); g.connect(audioCtx.destination);
  const t=audioCtx.currentTime; g.gain.exponentialRampToValueAtTime(0.12,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+0.22);
  o.start(); o.stop(t+0.25);}catch(e){} }
function buzz(){ try{ audioCtx=audioCtx||new (window.AudioContext||window.webkitAudioContext)();
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.type='sawtooth'; o.frequency.value=180; g.gain.value=0.001;
  o.connect(g); g.connect(audioCtx.destination);
  const t=audioCtx.currentTime; g.gain.exponentialRampToValueAtTime(0.12,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+0.38);
  o.start(); o.stop(t+0.4);}catch(e){} }

/* ====== Modelo de tarjetas ====== */
let CARDS = []; // {el, verb, dim, level, locked, homeParent}
function allVerbs(){
  const list=[];
  for(const dim of Object.keys(DATA)){
    for(const lvl of Object.keys(DATA[dim])){
      for(const v of DATA[dim][lvl]){
        list.push({verb:v, dim, level:+lvl});
      }
    }
  }
  return list;
}
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

function buildCards(){
  bankEl.innerHTML='';
  CARDS = [];
  const items = shuffle(allVerbs());
  for(const it of items){
    const el = document.createElement('div');
    el.className='card';
    el.textContent = it.verb;
    el.dataset.dim = it.dim;
    el.dataset.level = String(it.level);
    bankEl.appendChild(el);
    CARDS.push({el, verb:it.verb, dim:it.dim, level:it.level, locked:false, homeParent:bankEl});
  }
  updateCounters();
}

/* ====== Drag & Drop con Pointer Events + captura ====== */
let dragging = null; // {card, dx, dy, lastPoint}
let activePointerId = null;

document.addEventListener('pointerdown', onPointerDown, {passive:false});
function onPointerDown(e){
  const cardEl = e.target.closest('.card');
  if(!cardEl) return;
  const card = CARDS.find(c=>c.el===cardEl);
  if(!card || card.locked) return;
  if(e.pointerType==='mouse' && e.button!==0) return;
  e.preventDefault();

  activePointerId = e.pointerId ?? null;
  try{ cardEl.setPointerCapture(activePointerId); }catch(_){}

  const rect = cardEl.getBoundingClientRect();
  dragging = {
    card,
    dx: e.clientX - rect.left,
    dy: e.clientY - rect.top,
    lastPoint: {x:e.clientX, y:e.clientY}
  };
  cardEl.classList.add('dragging');
  cardEl.style.width = rect.width+'px';
  cardEl.style.height = rect.height+'px';
  moveAt(e.clientX, e.clientY);

  document.addEventListener('pointermove', onPointerMove, {passive:false});
  document.addEventListener('pointerup', onPointerUp, {once:true});
  document.addEventListener('pointercancel', onPointerCancel, {once:true});
}
function moveAt(x,y){
  if(!dragging) return;
  const {card, dx, dy} = dragging;
  card.el.style.left = (x - dx)+'px';
  card.el.style.top  = (y - dy)+'px';
  card.el.style.transform = 'translateZ(0)';
}
function onPointerMove(e){
  if(!dragging) return;
  e.preventDefault();
  dragging.lastPoint = {x:e.clientX, y:e.clientY};
  moveAt(e.clientX, e.clientY);
}
function dropTargetFromPoint(x,y){
  const el = document.elementFromPoint(x,y);
  if(!el) return null;
  const dz = el.closest('.level');
  if(!dz) return null;
  return {levelEl:dz, zoneEl:dz.querySelector('.dropzone'), dim:dz.dataset.dim, level:+dz.dataset.level};
}


function onPointerUp(){
  if(!dragging) return;
  const {card, lastPoint} = dragging;

  const target = dropTargetFromPoint(lastPoint.x, lastPoint.y);
  const isCorrect = target && target.dim===card.dim && target.level===card.level;

  if(isCorrect){
    target.zoneEl.appendChild(card.el);
    card.locked = true;
    card.el.classList.remove('dragging');
    card.el.classList.add('locked');
    card.el.style.cssText='';
    awardPoints(+POINT_CORRECT);
    ding();
    checkWin();
  }else{
    card.homeParent.appendChild(card.el);
    card.el.classList.remove('dragging');
    card.el.style.cssText='';
    penalize();
    buzz();
    if(navigator.vibrate) navigator.vibrate(60);
  }
  dragging = null;
  document.removeEventListener('pointermove', onPointerMove);
  updateCounters();
}



function onPointerCancel(){
  if(!dragging) return;
  const {card} = dragging;
  card.homeParent.appendChild(card.el);
  card.el.classList.remove('dragging');
  card.el.style.cssText='';
  dragging = null;
  document.removeEventListener('pointermove', onPointerMove);
}

/* ====== Contadores ====== */
function updateCounters(){
  const ok = CARDS.filter(c=>c.locked).length;
  okEl.textContent = ok;
  const total = CARDS.length;
  totalEl.textContent = total;
  leftEl.textContent = (total-ok);
}

/* ====== Equipos y Puntuaci√≥n ====== */
const POINT_CORRECT = 10;
const PENALTY_WRONG = -5; // s√≥lo en examen
let teams = [];
let activeTeam = 0;

function renderTeams(){
  teamsEl.innerHTML='';
  teams.forEach((t,i)=>{
    const row = document.createElement('div');
    row.className = 'team'+(i===activeTeam ? ' active' : '');
    row.innerHTML = `
      <input value="${t.name}" data-idx="${i}" style="flex:1; min-width:120px">
      <span class="score" id="score_${i}">${t.score}</span>
    `;
    teamsEl.appendChild(row);
  });
  teamsEl.querySelectorAll('input').forEach(inp=>{
    inp.addEventListener('input', e=>{
      const idx = +e.target.dataset.idx;
      teams[idx].name = e.target.value;
    });
  });
}

function setupTeams(n=2){
  teams = Array.from({length:n}, (_,i)=>({name:'Equipo '+(i+1), score:0}));
  activeTeam = 0;
  renderTeams();
}
function setActive(idx){
  activeTeam = (idx+teams.length)%teams.length;
  renderTeams();
}
function nextTeam(){ setActive(activeTeam+1); }
function prevTeam(){ setActive(activeTeam-1); }
prevTeamBtn.addEventListener('click', prevTeam);
nextTeamBtn.addEventListener('click', nextTeam);
applyTeamsBtn.addEventListener('click', ()=>{
  const n = Math.max(2, Math.min(4, +teamCountEl.value||2));
  setupTeams(n);
});

/* Puntuaci√≥n: acierto/penalizaci√≥n */
function awardPoints(p){
  if(!teams.length) return;
  teams[activeTeam].score += p;
  const slot = document.getElementById('score_'+activeTeam);
  if(slot) slot.textContent = teams[activeTeam].score;
}
function penalize(){
  if(examChk.checked){
    awardPoints(PENALTY_WRONG);
    nextTeam(); // pasar turno tras error (puedes quitarlo si prefieres)
  }
}

/* ====== Cron√≥metro / Modo examen ====== */
let timerId=null, timeLeft=300, running=false, finished=false;

function setTimeFromInputs(){
  const m = Math.max(0, +minEl.value|0);
  const s = Math.max(0, Math.min(59, +secEl.value|0));
  timeLeft = m*60 + s;
  updateTimer();
}
function pad2(n){return String(n).padStart(2,'0')}
function updateTimer(){
  timerEl.textContent = `${pad2(Math.floor(timeLeft/60))}:${pad2(timeLeft%60)}`;
  timerEl.classList.toggle('low', timeLeft<=10);
}
function startTimer(){
  if(running) return;
  running=true;
  if(timerId) clearInterval(timerId);
  timerId = setInterval(()=>{
    timeLeft--;
    updateTimer();
    if(timeLeft<=0){
      timeLeft=0; updateTimer();
      endRound();
    }
  },1000);
}
function pauseTimer(){ running=false; if(timerId){clearInterval(timerId); timerId=null;} }
function restartTimer(){ pauseTimer(); setTimeFromInputs(); updateTimer(); }

startBtn.addEventListener('click', ()=>{ if(!finished) startTimer(); });
pauseBtn.addEventListener('click', pauseTimer);
restartBtn.addEventListener('click', ()=>{ restartTimer(); });

minEl.addEventListener('change', ()=>{ if(!running) setTimeFromInputs(); });
secEl.addEventListener('change', ()=>{ if(!running) setTimeFromInputs(); });

examChk.addEventListener('change', ()=>{
  examBadge.style.display = examChk.checked ? 'inline-block' : 'none';
  document.querySelectorAll('.hint').forEach(h=> h.classList.toggle('hidden', examChk.checked));
  btnShuffle.disabled = examChk.checked && running; // bloquear reordenar durante examen en marcha
});

/* ====== Fin de ronda y bonus por tiempo ====== */
function endRound(){
  if(finished) return;
  finished = true;
  pauseTimer();

  const maxScore = Math.max(...teams.map(t=>t.score));
  const winners = teams
    .map((t,i)=>({i,score:t.score}))
    .filter(t=>t.score===maxScore)
    .map(t=>t.i);
  const timeBonus = Math.floor(timeLeft/15); // 1 punto cada 15s restantes
  winners.forEach(i=>{ teams[i].score += timeBonus; });
  renderTeams();

  const summary = teams.map(t=>`${t.name}: ${t.score} pts`).join(' ¬∑ ');
  finalMsg.textContent = `Tiempo agotado o actividad completa. ${summary}. ${winners.length>1 ? '¬°Empate!' : 'üèÜ Ganador: '+teams[winners[0]].name}`;
  modal.style.display='grid';
}
closeModal.addEventListener('click', ()=> modal.style.display='none');

/* Tambi√©n termina si completan todas las tarjetas antes de tiempo */
function checkWin(){
  const okAll = CARDS.every(c=>c.locked);
  if(okAll) endRound();
}

/* ====== Reset y Reordenar (tablero) ====== */
btnReset.addEventListener('click', resetBoard);
btnShuffle.addEventListener('click', ()=>{
  if(examChk.checked && running) return; // bloqueado en examen en curso
  reshuffle();
});
function resetBoard(){
  for(const c of CARDS){
    c.locked=false;
    c.el.classList.remove('locked','dragging');
    c.el.style.cssText='';
    bankEl.appendChild(c.el);
  }
  updateCounters();
  finished=false; pauseTimer(); setTimeFromInputs(); updateTimer();
  teams.forEach((t,i)=>{t.score=0; const slot=document.getElementById('score_'+i); if(slot) slot.textContent=t.score;});
}
function reshuffle(){
  const arr = CARDS.slice();
  shuffle(arr);
  bankEl.innerHTML='';
  for(const c of arr){ bankEl.appendChild(c.el); }
}

/* ====== Inicializaci√≥n ====== */
function init(){
  buildCards();
  updateCounters();
  setupTeams(2);
  setTimeFromInputs();
  updateTimer();
  document.querySelectorAll('.hint').forEach(h=> h.classList.toggle('hidden', examChk.checked));
}
init();

/* ====== Banco: Ordenar A‚ÄìZ y Desordenar ====== */
document.getElementById('sortAZ').addEventListener('click', ()=>{
  const arr = CARDS.filter(c=>!c.locked);
  arr.sort((a,b)=> a.verb.localeCompare(b.verb,'es',{sensitivity:'base'}));
  bankEl.innerHTML='';
  for(const c of arr){ bankEl.appendChild(c.el); }
});
document.getElementById('shuffleBank').addEventListener('click', ()=>{
  const arr = CARDS.filter(c=>!c.locked);
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  bankEl.innerHTML='';
  for(const c of arr){ bankEl.appendChild(c.el); }
});
</script>


</body>
</html>
