<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego Espacial ‚Äì Potencias Matem√°ticas</title>
<style>
  body {
    background:#000;
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
  }
  canvas {
    border:3px solid #22d3ee;
    background: radial-gradient(circle at center, #0f172a 0%, #000 100%);
  }
</style>
</head>
<body>
<canvas id="game" width="700" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// === BASE DE LA NAVE (SE ELIGE ALEATORIAMENTE CADA PARTIDA) ===
let baseNave = Math.floor(Math.random()*8)+2; // entre 2 y 9

// === NAVE ===
let nave = { x: canvas.width/2 - 25, y: 430, w: 50, h: 50 };

// === ENEMIGOS (POTENCIAS CON BASES MEZCLADAS) ===
let potencias = [];
function crearPotencia(){
  let base = Math.floor(Math.random()*8)+2; // base entre 2 y 9
  let exp = Math.floor(Math.random()*4)+2;  // exponente entre 2 y 5
  return { 
    x: Math.random()*(canvas.width-80)+40, 
    y: -40, 
    base: base, 
    exp: exp, 
    v: 1.5+Math.random()*1.5, 
    vivo: true 
  };
}
for (let i=0;i<6;i++) potencias.push(crearPotencia());

// === BALAS ===
let balas = [];

// === PUNTAJE Y VIDAS ===
let score = 0;
let vidas = 5;

// === MENSAJES (para mostrar resultados al destruir) ===
let mensajes = [];
function mostrarMensaje(texto,x,y,color="yellow"){
  mensajes.push({texto: texto, x:x, y:y, t:60, color:color}); // 60 frames visible
}

// === CONTROLES ===
let keys = { left:false, right:false, space:false };
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft") keys.left=true;
  if(e.key==="ArrowRight") keys.right=true;
  if(e.key===" " && !keys.space){
    keys.space=true; disparar();
  }
});
document.addEventListener("keyup", e=>{
  if(e.key==="ArrowLeft") keys.left=false;
  if(e.key==="ArrowRight") keys.right=false;
  if(e.key===" ") keys.space=false;
});

// === DIBUJAR ===
function drawNave(x,y,w,h){
  ctx.save(); ctx.translate(x+w/2,y+h/2); ctx.scale(w/60,h/60);
  ctx.fillStyle="#3b82f6";
  ctx.beginPath(); ctx.moveTo(0,-30); ctx.lineTo(20,20); ctx.lineTo(-20,20); ctx.closePath(); ctx.fill();
  ctx.fillStyle="#22d3ee"; ctx.beginPath(); ctx.arc(0,-10,8,0,Math.PI*2); ctx.fill();
  ctx.restore();

  // mostrar base de la nave sobre ella
  ctx.fillStyle="white";
  ctx.font="20px Arial Black";
  ctx.fillText("BASE = " + baseNave, x+5, y-10);
}

function drawPotencia(p){
  if(!p.vivo) return;
  ctx.fillStyle="rgba(0,0,0,0.6)";
  ctx.fillRect(p.x-25, p.y-30, 60, 40); // caj√≥n
  ctx.strokeStyle= (p.base===baseNave) ? "lime" : "red";
  ctx.lineWidth=2;
  ctx.strokeRect(p.x-25, p.y-30, 60, 40);

  ctx.fillStyle=(p.base===baseNave) ? "lime" : "red";
  ctx.font="20px Arial Black";
  ctx.fillText(p.base+"^"+p.exp, p.x-12, p.y-5);
}

function drawBala(b){ ctx.fillStyle=b.color; ctx.fillRect(b.x,b.y,b.w,b.h); }
function drawHUD(){
  ctx.fillStyle="white"; ctx.font="18px Arial";
  ctx.fillText("Puntos: "+score,20,30);
  ctx.fillText("Vidas: "+vidas,20,55);
}

function drawMensajes(){
  mensajes.forEach(m=>{
    ctx.fillStyle=m.color;
    ctx.font="20px Arial Black";
    ctx.fillText(m.texto, m.x, m.y);
    m.t--;
  });
  mensajes = mensajes.filter(m=>m.t>0);
}

// === DISPARAR ===
function disparar(){
  balas.push({x:nave.x+nave.w/2-2,y:nave.y-10,w:4,h:10,v:-8,color:"yellow"});
}

// === LOOP PRINCIPAL ===
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(keys.left) nave.x-=6;
  if(keys.right) nave.x+=6;
  nave.x=Math.max(0,Math.min(canvas.width-nave.w,nave.x));
  drawNave(nave.x,nave.y,nave.w,nave.h);

  potencias.forEach(p=>{
    if(p.vivo){
      p.y+=p.v;
      if(p.y>canvas.height+40){ 
        p.vivo=false; 
        setTimeout(()=>potencias.push(crearPotencia()),1000); 
      }

      // colisi√≥n con la nave
      if(p.x-25 < nave.x+nave.w && p.x+25 > nave.x &&
         p.y-30 < nave.y+nave.h && p.y+10 > nave.y){
         vidas--; p.vivo=false;
         setTimeout(()=>potencias.push(crearPotencia()),1000);
      }
    }
    drawPotencia(p);
  });

  balas.forEach(b=>{
    b.y+=b.v; drawBala(b);
    potencias.forEach(p=>{
      if(p.vivo &&
        b.x < p.x+30 && b.x+b.w > p.x-30 &&
        b.y < p.y && b.y+b.h > p.y-30){
          p.vivo=false; b.y=-50;

          if(p.base===baseNave){
            // acierto correcto
            let resultado = Math.pow(p.base,p.exp);
            score += resultado;
            mostrarMensaje(p.base+"^"+p.exp+" = "+resultado, p.x, p.y,"yellow");
          } else {
            // dispar√≥ a base incorrecta
            mostrarMensaje("‚ùå BASE ERR√ìNEA", p.x, p.y,"red");
          }

          setTimeout(()=>potencias.push(crearPotencia()),1000);
      }
    });
  });
  balas=balas.filter(b=>b.y>-20);

  drawHUD();
  drawMensajes();

  if(vidas<=0){
    ctx.fillStyle="red"; ctx.font="40px Arial Black";
    ctx.fillText("üíÄ GAME OVER üíÄ",canvas.width/2-160,canvas.height/2);
    return;
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
