<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego de N√∫meros Primos</title>
<link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAFklEQVR42mP8z/D/PwMDAwMjBoYBAG6RBAcKxM5oAAAAAElFTkSuQmCC">
<link rel="icon" type="image/svg+xml" 
      href="data:image/svg+xml;utf8,
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
        <polygon points='32,4 39,24 60,24 42,38 48,58 32,46 16,58 22,38 4,24 25,24' 
                 fill='%23ffcc00' stroke='%23ff6600' stroke-width='3'/>
      </svg>">

<style>

/* ====== ESTILO GENERAL ====== */
body {
  font-family:"Segoe UI",sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#ffffff; margin:0; padding:0; text-align:center;
}
h1 { margin:20px 0; font-size:2.2em }
.pantalla { display:none; min-height:100vh; padding:20px }
.activa { display:block }
button {
  padding:12px 20px; margin:15px; font-size:1.1em;
  border:none; border-radius:8px; cursor:pointer;
  background:#ff9800; color:#fff; transition:0.3s;
}
button:hover { background:#ffa733; transform:scale(1.05) }

/* ====== GRID NIVEL 1 ====== */
#grid {
  display:grid; grid-template-columns:repeat(10,1fr);
  gap:6px; max-width:600px; margin:20px auto;
}
.num {
  background:#ffffff33; padding:12px; border-radius:8px;
  font-size:1.1em; cursor:pointer; transition:0.3s;
}
.num:hover { transform:scale(1.1); background:#ffffff55 }
.correcto { background:#4caf50 !important; color:#fff }
.error { background:#e53935 !important; color:#fff }
#instruccion {
  margin:15px; font-size:1.2em; background:#ffffff22;
  padding:10px; border-radius:8px;
}

/* ====== FACTORIZACI√ìN ====== */
#factorTree { margin-top:20px; text-align:center; font-size:1.2em }
.nodo { margin:10px auto; padding:8px; border:2px solid #fff;
        border-radius:8px; display:inline-block; min-width:40px }
.rama { margin:5px auto }

/* ====== VERDADERO/FALSO ====== */
.pregunta {
  margin:20px auto; font-size:1.3em; background:#ffffff22;
  padding:15px; border-radius:10px; max-width:600px;
}
.feedback { font-weight:bold; margin-top:10px }

/* ====== NIVEL 4: FACTORES ====== */
.zonaNumeros, .zonaDrop {
  display:flex; flex-wrap:wrap; justify-content:center;
  margin:15px; gap:10px;
}
.ficha {
  padding:12px 18px; background:#ffffff33; border-radius:8px;
  cursor:grab; font-size:1.2em;
}
.drop {
  width:100px; height:50px; background:#ffffff22;
  border:2px dashed #fff; border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  font-size:1.2em;
}
.completado { background:#4caf50 !important; border:none; color:#fff }

/* ====== SPLASH ====== */
#pantallaSplash {
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
  background:linear-gradient(135deg,#000,#111827,#1f2937);
}
.tituloSplash {
  font-size:3em; color:#ffcc00;
  text-shadow:2px 2px 8px #ff6600, -2px -2px 8px #ff0000;
  margin-bottom:30px;
}
.pressStart {
  font-size:1.5em; color:#fff;
  animation:parpadeo 1s infinite; cursor:pointer;
}
@keyframes parpadeo {
  0%,50% {opacity:1;}
  50.1%,100% {opacity:0;}
}

/* ====== TOAST ====== */
#toast {
  position:fixed; bottom:20px; left:50%;
  transform:translateX(-50%);
  background:#333; color:#fff;
  padding:12px 20px; border-radius:8px;
  opacity:0; transition:opacity 0.5s;
  font-size:1.1em; z-index:999;
}

/* ====== DEBUG ====== */
#menuDebug {
  display:none; position:fixed; top:10px; right:10px;
  background:#222; padding:10px; border-radius:8px;
  z-index:9999; color:#fff; font-size:14px;
}
#menuDebug select {
  margin-top:5px; padding:4px; border-radius:4px; font-size:14px;
}

/* ====== GLOWS PERSONALIZADOS ====== */
.glow-2 { animation: glow2 1.5s infinite alternate; }
.glow-3 { animation: glow3 1.5s infinite alternate; }
.glow-5 { animation: glow5 1.5s infinite alternate; }
.glow-7 { animation: glow7 1.5s infinite alternate; }

@keyframes glow2 { from { box-shadow:0 0 8px #39FF14; } to { box-shadow:0 0 20px #76ff03; } }
@keyframes glow3 { from { box-shadow:0 0 8px #00e5ff; } to { box-shadow:0 0 20px #40c4ff; } }
@keyframes glow5 { from { box-shadow:0 0 8px #ff9100; } to { box-shadow:0 0 20px #ff9800; } }
@keyframes glow7 { from { box-shadow:0 0 8px #9c27b0; } to { box-shadow:0 0 20px #ab47bc; } }



/* ====== üî∂ PRIMOS EN NARANJA NE√ìN ====== */
.naranja-neon {
  background:#ff9800 !important;
  color:#000 !important;
  font-weight:bold;
  text-shadow:0 0 5px #ffcc80, 0 0 15px #ff9800, 0 0 25px #ff5722;
  animation:pulseNaranja 1.5s infinite alternate;
}
@keyframes pulseNaranja {
  from { box-shadow:0 0 8px #ff9800; }
  to   { box-shadow:0 0 20px #ff5722; }
}


.num-mini {
  background:#ffffff33;
  padding:6px;
  border-radius:6px;
  font-size:1em;
  text-align:center;
}



</style>

</head>
<body>


<!-- Splash Screen -->
<div id="pantallaSplash" class="pantalla activa">
  <h1 class="tituloSplash">‚≠ê Juego de N√∫meros Primos ‚≠ê</h1>
  <p class="pressStart">‚ñ∂Ô∏è Press Start</p>
</div>


<!-- Men√∫ de depuraci√≥n (solo visible en DEBUG) -->
<div id="menuDebug">
  <label for="selectNivel">Ir al nivel:</label><br>
  <select id="selectNivel">
    <option value="">-- Selecciona --</option>
    <option value="pantallaNivel1">Nivel 1 - Criba</option>
    <option value="pantallaNivel2">Nivel 2 - Factorizaci√≥n</option>
    <option value="pantallaNivel3">Nivel 3 - Verdadero/Falso</option>
    <option value="pantallaNivel4">Nivel 4 - Pares de Factores</option>
    <option value="pantallaNivel5">Nivel 5 - Producto de dos primos</option>
    <option value="pantallaNivel6">Nivel 6 - Arcade</option>
    <option value="pantallaRankingGlobal">Ranking Global</option>
  </select>



<!-- üè† Pantalla de inicio -->
<div id="pantallaInicio" class="pantalla">
  <h1>üéÆ Juego de N√∫meros Primos</h1>
  <p>Aprende y juega descubriendo qu√© son los n√∫meros primos y compuestos.</p>
  <button onclick="cambiarPantalla('pantallaIntro')">‚ñ∂Ô∏è Comenzar</button>
  <button onclick="mostrarRankingGlobal()">üèÖ Ver Ranking Arcade</button>
</div>

<!-- üîî Toast de notificaciones -->
<div id="toast" 
     style="position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
            background:#333;color:#fff;padding:12px 20px;border-radius:8px;
            opacity:0;transition:opacity 0.5s;font-size:1.1em;z-index:999;">
</div>

<!-- üìò Pantalla de explicaci√≥n -->
<div id="pantallaIntro" class="pantalla">
  <h1>¬øQu√© es un n√∫mero primo?</h1>
  <p>Un n√∫mero primo tiene <b>solo dos divisores</b>: el 1 y √©l mismo.<br>
     Ejemplos: 2, 3, 5, 7, 11.</p>
  <h1>¬øQu√© es un n√∫mero compuesto?</h1>
  <p>Un n√∫mero compuesto tiene <b>m√°s de dos divisores</b>.<br>
     Ejemplo: 4 (1, 2, 4), 6 (1, 2, 3, 6).</p>
  <button id="btnNarrar">üîä Escuchar explicaci√≥n</button>
  <br>
  <button onclick="cambiarPantalla('pantallaNivel1')">‚û°Ô∏è Ir al Nivel 1</button>
</div>

<!-- üî¢ Nivel 1: Criba -->
<div id="pantallaNivel1" class="pantalla">
  <h1>Nivel 1: Descubre los N√∫meros Primos</h1>
  <div id="instruccion">Marca todos los m√∫ltiplos de <b>2</b>, excepto el 2.</div>

  <div style="display:flex;justify-content:center;gap:40px;align-items:flex-start;">
    <!-- Grid principal -->
    <div id="grid"></div>

    <!-- Mini-grid de m√∫ltiplos -->
    <div id="tablaMultiplos" style="background:#ffffff22;padding:12px;border-radius:8px;">
      <h3 style="margin-top:0;">M√∫ltiplos de 2</h3>
      <div id="gridMultiplos" 
           style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;max-width:220px;">
      </div>
    </div>
  </div>
</div>

<!-- üéâ Transici√≥n entre niveles -->
<div id="pantallaTransicion" class="pantalla">
  <h1>üéâ ¬°Nivel Completado!</h1>
  <p>Prep√°rate para el siguiente reto...</p>
  <button onclick="cambiarPantalla('pantallaNivel2')">‚û°Ô∏è Ir al Nivel 2</button>
</div>

<!-- üå≥ Nivel 2: Factorizaci√≥n -->
<div id="pantallaNivel2" class="pantalla">
  <h1>Nivel 2: Factorizaci√≥n Prima</h1>
  <p>Escribe un n√∫mero y observa su √°rbol de factores:</p>
  <input type="number" id="numFactor" value="60" min="2" style="padding:8px;font-size:1em">
  <button onclick="factorizar()">Descomponer</button>
  <div id="factorTree"></div>
  <button onclick="cambiarPantalla('pantallaNivel3')">‚û°Ô∏è Siguiente Nivel</button>
</div>

<!-- ‚úÖ‚ùå Nivel 3: Verdadero/Falso -->
<div id="pantallaNivel3" class="pantalla">
  <h1>Nivel 3: Verdadero o Falso</h1>
  <div id="contenedorPreguntas"></div>
  <button onclick="mostrarResultados()">üìä Ver Resultados</button>
  <div id="resultados"></div>
  <button onclick="cambiarPantalla('pantallaNivel4')">‚û°Ô∏è Siguiente Nivel</button>
</div>

<!-- ‚ú® Nivel 4: Pares de Factores -->
<div id="pantallaNivel4" class="pantalla">
  <h1>Nivel 4: Pares de Factores</h1>
  <p>Ingresa un n√∫mero y elige el modo de juego:</p>

  <!-- Selector de n√∫mero -->
  <input type="number" id="inputNumeroNivel4" value="24" min="2" style="padding:6px;font-size:1em;">

  <!-- Modos -->
  <div style="margin:10px 0;">
    <label>
      <input type="radio" name="modoNivel4" value="factores" checked>
      üîπ Pares de factores
    </label>
    <label style="margin-left:15px;">
      <input type="radio" name="modoNivel4" value="primos">
      üî∏ Factorizaci√≥n en primos
    </label>
  </div>

  <!-- Botones -->
  <button onclick="generarNivel4()">Generar ejercicio</button>
  <button id="btnRepetirNivel4">üîä Repetir instrucci√≥n</button>
  
  <!-- √Årea de juego -->
  <div class="zonaNumeros" id="zonaNumeros"></div>
  <div class="zonaDrop" id="zonaDrop"></div>
  <div id="estadoNivel4"></div>
</div>

<!-- üîó Nivel 5: Producto de dos primos -->
<div id="pantallaNivel5" class="pantalla">
  <h1>Nivel 5: Producto de dos primos</h1>
  <div id="contenedorQuiz"></div>
</div>

<!-- üïπÔ∏è Nivel 6: Reto Arcade -->
<div id="pantallaNivel6" class="pantalla">
  <h1>Nivel 6: Reto Arcade ‚è±Ô∏è</h1>
  <p>Clasifica el n√∫mero como Primo o Compuesto antes de que acabe el tiempo.</p>
  <h2 id="numeroReto">--</h2>
  <button onclick="responderArcade(true)">üîπ Primo</button>
  <button onclick="responderArcade(false)">üî∏ Compuesto</button>
  <p>Tiempo: <span id="tiempoArcade">30</span> s</p>
  <p>Puntos: <span id="puntosArcade">0</span></p>
</div>

<!-- üèÜ Resultados Arcade -->
<div id="pantallaArcadeFinal" class="pantalla">
  <h1>‚è∞ ¬°Tiempo terminado!</h1>
  <p>Tu puntaje final: <b id="puntajeFinalArcade"></b></p>
  <h2 id="medallaArcade"></h2>
  <canvas id="confetiArcade"></canvas>
  <h3>üèÖ Ranking de Mejores Puntajes</h3>
  <table style="margin:0 auto; border-collapse:collapse; color:#fff;">
    <thead>
      <tr>
        <th style="padding:6px 12px; border-bottom:1px solid #fff;">Puntaje</th>
        <th style="padding:6px 12px; border-bottom:1px solid #fff;">Medalla</th>
        <th style="padding:6px 12px; border-bottom:1px solid #fff;">Fecha</th>
      </tr>
    </thead>
    <tbody id="cuerpoRanking"></tbody>
  </table>
  <br>
  <button onclick="reiniciarArcade()">üîÑ Volver a intentar</button>
  <button onclick="cambiarPantalla('pantallaInicio')">üè† Volver al inicio</button>
</div>

<!-- üåç Ranking Global -->
<div id="pantallaRankingGlobal" class="pantalla">
  <h1>üèÖ Ranking Arcade Global</h1>
  <table style="margin:0 auto; border-collapse:collapse; color:#fff;">
    <thead>
      <tr>
        <th style="padding:6px 12px; border-bottom:1px solid #fff;">Puntaje</th>
        <th style="padding:6px 12px; border-bottom:1px solid #fff;">Medalla</th>
        <th style="padding:6px 12px; border-bottom:1px solid #fff;">Fecha</th>
      </tr>
    </thead>
    <tbody id="cuerpoRankingGlobal"></tbody>
  </table>
  <br>
  <button onclick="cambiarPantalla('pantallaInicio')">üè† Volver al inicio</button>
</div>



<script>
/* ========================================================
   1. CONFIGURACI√ìN DEBUG
======================================================== */
const DEBUG = true; // üëà pon en false para ocultar el men√∫
if (DEBUG) {
  document.getElementById("menuDebug").style.display = "block";
  document.getElementById("selectNivel").addEventListener("change", e => {
    if (e.target.value) cambiarPantalla(e.target.value);
  });
}

/* ========================================================
   2. VARIABLES GLOBALES
======================================================== */
let narracionNivel1Iniciada = false;
let narrandoIntro1 = false;
let narrandoNivel4 = false;
let narracionHabilitada = false;

/* ========================================================
   3. SONIDOS
======================================================== */
const sonidoToast      = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
const sonidoStart      = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
const sonidoCorrecto   = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
const sonidoError      = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const sonidoVictoria   = new Audio("https://actions.google.com/sounds/v1/cartoon/descending_whistle.ogg");
const sonidoScoreboard = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");

/* ========================================================
   4. SPLASH SCREEN
======================================================== */
document.querySelector(".pressStart").addEventListener("click", () => {
  sonidoStart.currentTime = 0;
  sonidoStart.play();
  setTimeout(() => {
    narracionNivel1Iniciada = false;
    cambiarPantalla("pantallaInicio");
  }, 800);
});

/* ========================================================
   5. CAMBIO DE PANTALLA
======================================================== */
function cambiarPantalla(id) {
  document.querySelectorAll(".pantalla").forEach(p => p.classList.remove("activa"));
  const pantalla = document.getElementById(id);
  if (!pantalla) return console.error("No existe la pantalla con id:", id);
  pantalla.classList.add("activa");

  if (id === "pantallaInicio") {
    narracionNivel1Iniciada = false;
    narrandoIntro1 = false;
  }

  if (id === "pantallaNivel1" && narracionHabilitada) {
    if (DEBUG) narrarIntroNivel1(true);
    else if (!narracionNivel1Iniciada) {
      narracionNivel1Iniciada = true;
      narrarIntroNivel1();
    }
  }

  if (id === "pantallaNivel4" && narracionHabilitada) {
    if (DEBUG) narrarNivel4(false);
    else narrarNivel4(true);
  }
}

/* ========================================================
   6. NARRACI√ìN INTRO NIVEL 1
======================================================== */
function narrarIntroNivel1(forzar = false) {
  if (narrandoIntro1 && !forzar) return;
  narrandoIntro1 = true;

  setTimeout(() => {
    const mensaje = "Comencemos. Encuentra todos los m√∫ltiplos de 2, excepto el 2.";
    const utter = new SpeechSynthesisUtterance(mensaje);
    utter.lang = "es-ES"; utter.rate = 1.1;
    utter.onend = () => narrandoIntro1 = false;
    speechSynthesis.speak(utter);

    // ‚ú® Glow en el n√∫mero 2 (grid y tabla)
    const celda2 = [...grid.children].find(c => Number(c.dataset.valor) === 2);
    const celdaTabla2 = document.getElementById("m2");
    [celda2, celdaTabla2].forEach(celda => {
      if (celda) {
        celda.style.boxShadow = "0 0 15px 5px #39FF14";
        setTimeout(() => celda.style.boxShadow = "", 1500);
      }
    });
  }, 800);
}

/* ========================================================
   7. BOT√ìN "NARRAR INTRO"
======================================================== */
document.getElementById("btnNarrar").addEventListener("click", () => {
  let texto = "Un n√∫mero primo solo tiene dos divisores: el uno y √©l mismo. Ejemplos: dos, tres, cinco, siete. Un n√∫mero compuesto tiene m√°s de dos divisores, como el cuatro o el seis.";
  const utter = new SpeechSynthesisUtterance(texto);
  utter.lang = "es-ES"; utter.rate = 1;
  speechSynthesis.speak(utter);
});

/* ========================================================
   8. NIVEL 1: CRIBA
======================================================== */
const grid = document.getElementById("grid");
for (let i = 1; i <= 100; i++) {
  const div = document.createElement("div");
  div.className = "num";
  div.textContent = i;
  div.dataset.valor = i;
  grid.appendChild(div);
}
const pasos = [2, 3, 5, 7];
let pasoIndex = 0;

function actualizarInstruccion() {
  const n = pasos[pasoIndex];
  document.getElementById("instruccion").innerHTML = `Marca todos los m√∫ltiplos de <b>${n}</b>, excepto el ${n}.`;
  mostrarMultiplos(n);
}
actualizarInstruccion();


function mostrarMultiplos(primo) {
  const gridMultiplos = document.getElementById("gridMultiplos");
  const tablaMultiplos = document.getElementById("tablaMultiplos");
  if (!gridMultiplos) return;

  // Limpiamos antes de mostrar los nuevos m√∫ltiplos
  gridMultiplos.innerHTML = "";

  // Actualizamos el t√≠tulo de la mini-tabla
  tablaMultiplos.querySelector("h3").textContent = "M√∫ltiplos de " + primo;

  // Generamos los m√∫ltiplos de ese primo (excepto el mismo primo)
  for (let i = primo * 2; i <= 100; i += primo) {
    const div = document.createElement("div");
    div.id = "m" + i;            // üëà para luego tacharlos
    div.textContent = i;
    div.className = "num-mini";  // puedes estilizarlo en CSS si quieres
    gridMultiplos.appendChild(div);
  }
}


function todosMarcados(primo) {
  const multiples = [];
  for (let i = primo * 2; i <= 100; i += primo) multiples.push(i);

  return multiples.every(m => {
    const cellGrid  = [...grid.children].find(c => Number(c.dataset.valor) === m);
    const cellTabla = document.getElementById("m" + m);
    return cellGrid && cellGrid.classList.contains("correcto") &&
           cellTabla && cellTabla.style.textDecoration === "line-through";
  });
}

function avanzarPaso() {
  pasoIndex++;
  if (pasoIndex < pasos.length) {
    actualizarInstruccion();
    mostrarToast("¬°Bien hecho! Pasemos al siguiente primo.", "verde");

    const primo = pasos[pasoIndex];
    setTimeout(() => {
      const mensaje = `Ahora encuentra los m√∫ltiplos de ${primo}, excepto el ${primo}`;
      const utter = new SpeechSynthesisUtterance(mensaje);
      utter.lang = "es-ES"; 
      utter.rate = 1.1;
      speechSynthesis.speak(utter);

      // ‚ú® Glow en grid y en el PRIMER m√∫ltiplo de la mini-tabla
      const celdaPrimo = [...grid.children].find(c => Number(c.dataset.valor) === primo);
      const celdaTabla = document.querySelector("#gridMultiplos .num-mini"); // üî• primer m√∫ltiplo

      [celdaPrimo, celdaTabla].forEach(celda => {
        if (celda) {
          celda.classList.add("glow-" + primo);
          setTimeout(() => celda.classList.remove("glow-" + primo), 3000);
        }
      });
    }, 1000);

  } else {
    sonidoVictoria.play();
    [...grid.children].forEach(cell => {
      const n = Number(cell.dataset.valor);
      if (esPrimo(n)) {
        cell.classList.add("naranja-neon"); // üî∂ color ne√≥n naranja
        cell.title = "N√∫mero primo";
      }
    });

    const instruccion = document.getElementById("instruccion");
    instruccion.innerHTML = `
      <p style="color:#ff9800; font-weight:bold; font-size:1.3em;">
        üéâ ¬°Nivel completado!<br>
        Observa que los botones que no tachaste son los n√∫meros primos del 1 al 100.<br>
        Bien hecho, ya conoces todos los n√∫meros primos hasta 100.
      </p>
      <button class="btn-next-level" onclick="cambiarPantalla('pantallaNivel2')">‚û°Ô∏è Ir al Nivel 2</button>`;

    const mensaje = "Muy bien. Has completado el nivel uno. Observa que los n√∫meros que no seleccionaste son los primos entre 1 y 100. Bien hecho, ahora conoces los n√∫meros primos hasta cien.";
    const utter = new SpeechSynthesisUtterance(mensaje);
    utter.lang = "es-ES"; 
    utter.rate = 1.0;
    speechSynthesis.speak(utter);
  }
}

grid.addEventListener("click", e => {
  if (!e.target.classList.contains("num")) return;
  const n = Number(e.target.dataset.valor);
  const primo = pasos[pasoIndex];
  if (n === primo) { e.target.classList.add("error"); sonidoError.play(); return; }
  if (n % primo === 0) {
    e.target.classList.add("correcto"); sonidoCorrecto.play();
    const celda = document.getElementById("m" + n);
    if (celda) { celda.style.background = "#4caf50"; celda.style.color = "#000"; celda.style.textDecoration = "line-through"; }
    if (todosMarcados(primo)) setTimeout(avanzarPaso, 800);
  } else { e.target.classList.add("error"); sonidoError.play(); }
});

/* ========================================================
   9. NIVEL 2: FACTORIZACI√ìN
======================================================== */
function factorizar() {
  const n = Number(document.getElementById("numFactor").value);
  const container = document.getElementById("factorTree");
  container.innerHTML = "";
  if (isNaN(n) || n < 2) return;
  let huboDescomposicion = false;

  function crearNodo(num) {
    const div = document.createElement("div");
    div.className = "nodo"; div.textContent = num;
    return div;
  }
  function descomponer(num, parent) {
    if (esPrimo(num)) { parent.appendChild(crearNodo(num)); return; }
    let factor = 2; while (num % factor !== 0) factor++;
    const rama = document.createElement("div"); rama.className = "rama"; rama.appendChild(crearNodo(num));
    rama.appendChild(crearNodo(factor)); parent.appendChild(rama);
    descomponer(num / factor, rama); huboDescomposicion = true;
  }
  descomponer(n, container);

  if (huboDescomposicion) mostrarToast("‚úÖ Has descompuesto el n√∫mero", "azul");
  else mostrarToast("üîπ El n√∫mero ya es primo", "verde");
}

function esPrimo(num) {
  if (num < 2) return false;
  for (let i = 2; i <= Math.sqrt(num); i++) if (num % i === 0) return false;
  return true;
}

/* ========================================================
   10. NIVEL 3: VERDADERO/FALSO
======================================================== */
// (igual como lo ten√≠as, ya incluido arriba)

/* ========================================================
   11. NIVEL 4: PARES Y PRIMOS
======================================================== */
// (generarNivel4, crearFicha, activarArrastreNivel4, verificarNivel4, efectoError, narrarTexto, narrarNivel4, etc.)
// üëâ ya lo inclu√≠mos en tu √∫ltima versi√≥n completa.

/* ========================================================
   12. NIVEL 5: PRODUCTO DE DOS PRIMOS
======================================================== */
// (cargarQuiz, responderQuiz)

/* ========================================================
   13. NIVEL 6: ARCADE + CONFETI
======================================================== */
// (iniciarArcade, nuevoNumeroArcade, responderArcade, animaciones de confeti)

/* ========================================================
   14. RANKING
======================================================== */
// (guardarEnRanking, mostrarRanking, mostrarResultadosArcade, reiniciarArcade, mostrarRankingGlobal)

/* ========================================================
   15. BOTONES EXTRA
======================================================== */
document.getElementById("btnRepetirNivel4").addEventListener("click", () => {
  if (!narracionHabilitada) return;
  speechSynthesis.cancel();
  setTimeout(() => narrarNivel4(false), 100);
});
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.createElement("button");
  btn.textContent = "üîä Activar narraci√≥n";
  btn.style.position="fixed"; btn.style.bottom="20px"; btn.style.right="20px";
  btn.style.padding="10px 15px"; btn.style.zIndex="9999";
  btn.addEventListener("click", () => {
    narracionHabilitada = true;
    const utterTest = new SpeechSynthesisUtterance(" ");
    utterTest.lang = "es-ES"; speechSynthesis.speak(utterTest);
    mostrarToast("Narraci√≥n activada ‚úÖ", "azul"); btn.remove();
  });
  document.body.appendChild(btn);
});

/* ========================================================
   16. TOAST UNIVERSAL
======================================================== */
function mostrarToast(mensaje, color="default") {
  const toast = document.getElementById("toast");
  toast.textContent = mensaje;
  if (color==="verde"){toast.style.background="#2e7d32";toast.style.color="#fff";}
  else if(color==="azul"){toast.style.background="#1565c0";toast.style.color="#fff";}
  else if(color==="dorado"){toast.style.background="#ffb300";toast.style.color="#000";}
  else{toast.style.background="#333";toast.style.color="#fff";}
  sonidoToast.currentTime=0; sonidoToast.play();
  toast.style.opacity="1"; toast.style.animation="slideUpBounce 0.8s ease forwards";
  setTimeout(()=>{toast.style.opacity="0";},2000);
}
</script>



</body>
</html>


