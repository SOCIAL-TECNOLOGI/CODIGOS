<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Simulador Dihíbrido</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background: #f4f4f4;
      transition: background 0.5s, color 0.5s;
    }

    body.dark-mode {
      background: #1e1e1e;
      color: #f4f4f4;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .selectors {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    select {
      padding: 5px 10px;
      font-size: 16px;
    }

    .responsive-table {
      overflow-x: auto;
      margin: 20px auto;
      max-width: 100%;
    }

    table {
      border-collapse: collapse;
      margin: 0 auto;
      min-width: 600px;
      display: block;
      overflow-x: auto;
      white-space: nowrap;
    }

    td, th {
      border: 1px solid #999;
      padding: 10px;
      text-align: center;
      min-width: 120px;
    }

    th {
      background: #eee;
    }

    .btn {
      background: #27ae60;
      color: white;
      padding: 10px 20px;
      border: none;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
    }

    .btn:hover {
      background: #219150;
    }

    .fenotipo-label {
      font-weight: bold;
      margin-top: 10px;
    }

    #chartBarContainer {
      max-width: 800px;
      margin: 30px auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    #graficoBarras,
    #graficoFenotipos,
    #graficoGenotipos {
      width: 430px !important;
      height: 430px !important;
      margin: 0 auto;
      display: block;
    }

    .leyenda {
      text-align: center;
      font-style: italic;
      margin-top: 20px;
    }

    .preguntas-educativas,
    .respuestas-estudiante {
      max-width: 70% !important;
      margin: 40px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .preguntas-educativas h3,
    .respuestas-estudiante h3 {
      color: #2c3e50;
    }

    .preguntas-educativas ul {
      padding-left: 20px;
    }

    textarea {
      width: 100%;
      min-height: 80px;
      margin-bottom: 15px;
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .btn-flotante {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #34495e;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      z-index: 999;
    }

    .btn-flotante:hover {
      background: #2c3e50;
    }

    #cuadro {
      display: flex;
      justify-content: center;
    }

    #cuadro table {
      margin: 0 auto;
    }

    body.dark-mode th {
      background-color: #333;
      color: #f4f4f4;
    }

    body.dark-mode .leyenda {
      color: #ffffff;
    }

    body.dark-mode .btn {
      background: #2ecc71;
      color: #ffffff;
    }

    body.dark-mode .leyenda {
      color: #ffffff;
    }

    /* NUEVAS CLASES ANIMACIÓN */
    .fade-in {
      animation: fadeIn 0.8s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

td[style*="red"] {
  box-shadow: 0 0 5px red;
}

.alerta-proporcion {
background-color: #fff3cd;
color: #856404;
border: 1px solid #ffeeba;
padding: 10px;
margin: 10px 0;
border-radius: 5px;
}
.tabla-resumen {
margin-top: 10px;
border-collapse: collapse;
}
.tabla-resumen td, .tabla-resumen th {
border: 1px solid #ccc;
padding: 5px 10px;
}
.tabla-resumen th {
background-color: #eee;
}

 #explicacionMutaciones {
    margin: 20px 0;
    padding: 15px;
    border-left: 5px solid #e74c3c;
    background-color: #fef6f6;
    color: #333;
    font-family: 'Segoe UI', sans-serif;
    font-size: 16px;
    line-height: 1.6;
  }

  body.dark-mode #explicacionMutaciones {
    background-color: #2c2c2c;
    color: #f8f8f8;
    border-left-color: #f39c12;
  }

  #explicacionMutaciones strong {
    color: #c0392b;
  }

  body.dark-mode #explicacionMutaciones strong {
    color: #f1c40f;
  }

  #explicacionMutaciones u {
    text-decoration: underline;
    font-weight: bold;
  }


/* Forzar texto negro en todas las celdas de Punnett */
.celda-punnett {
  color: #000 !important;
}

  </style>
</head>
<body>

<button class="btn-flotante" onclick="toggleDarkMode()">🌓</button>

<div id="contenedorExportable">
  <h1>🐰 Simulador Dihíbrido</h1>

  <div class="header">
    <h2>🧬 Información de los Progenitores</h2>
    <p><strong>Progenitor 1:</strong> Selecciona el genotipo del primer progenitor y observa su fenotipo.</p>
    <p><strong>Progenitor 2:</strong> Selecciona el genotipo del segundo progenitor y observa su fenotipo.</p>
    <p>Luego de identificar los fenotipos, se procede a realizar el <strong>cruce genético dihíbrido</strong> para determinar la descendencia probable.</p>
  </div>

  <div class="leyenda">
    <p><strong>Nota:</strong> B = pelaje negro (dominante), b = pelaje blanco (recesivo); E = orejas grandes (dominante), e = orejas pequeñas (recesivo).</p>
  </div>

  <div class="selectors">
    <label title="Selecciona el genotipo del primer progenitor">
      Progenitor 1:
      <select id="gen1" onchange="actualizarFenotipos()">
        <option value="BBEE" title="Pelaje negro, orejas grandes">BBEE</option>
        <option value="BBEe" title="Pelaje negro, orejas grandes">BBEe</option>
        <option value="BbEE" title="Pelaje negro, orejas grandes">BbEE</option>
        <option value="BbEe" title="Pelaje negro, orejas grandes" selected>BbEe</option>
        <option value="BBee" title="Pelaje negro, orejas pequeñas">BBee</option>
        <option value="bbEE" title="Pelaje blanco, orejas grandes">bbEE</option>
        <option value="Bbee" title="Pelaje negro, orejas pequeñas">Bbee</option>
        <option value="bbee" title="Pelaje blanco, orejas pequeñas">bbee</option>
        <option value="bbEe" title="Pelaje blanco, orejas grandes">bbEe</option>
      </select>
    </label>

    <span style="font-size: 24px;">&times;</span>

    <label title="Selecciona el genotipo del segundo progenitor">
      Progenitor 2:
      <select id="gen2" onchange="actualizarFenotipos()">
        <option value="BBEE" title="Pelaje negro, orejas grandes">BBEE</option>
        <option value="BBEe" title="Pelaje negro, orejas grandes">BBEe</option>
        <option value="BbEE" title="Pelaje negro, orejas grandes">BbEE</option>
        <option value="BbEe" title="Pelaje negro, orejas grandes">BbEe</option>
        <option value="BBee" title="Pelaje negro, orejas pequeñas">BBee</option>
        <option value="bbEE" title="Pelaje blanco, orejas grandes">bbEE</option>
        <option value="Bbee" title="Pelaje negro, orejas pequeñas">Bbee</option>
        <option value="bbee" title="Pelaje blanco, orejas pequeñas" selected>bbee</option>
        <option value="bbEe" title="Pelaje blanco, orejas grandes">bbEe</option>
      </select>
    </label>

    <button class="btn" onclick="generarCuadro()">🧪 Generar Cruce</button>
    <label>
  <input type="checkbox" id="activarMutaciones">
  🔬 Activar mutaciones aleatorias (10%)
</label>

    <button class="btn" onclick="reiniciarSimulador()">🔄 Reiniciar</button>
  </div>

  <div class="selectors">
    <div id="fenotipo1" class="fenotipo-label">Fenotipo: -</div>
    <div style="width: 40px;"></div>
    <div id="fenotipo2" class="fenotipo-label">Fenotipo: -</div>
  </div>

  <div class="responsive-table fade-in">
    <div id="cuadro"></div>
  </div>




  
  <div id="explicacionMutaciones" class="leyenda fade-in"></div>
<div id="alertaProporcion" class="alerta-proporcion fade-in"></div>
<div id="tablaComparativa" class="fade-in"></div>
  <canvas id="graficoFenotipos" class="fade-in"></canvas>
  <div id="proporcionTexto" class="leyenda fade-in"></div>
<div id="explicacionMutaciones" class="leyenda fade-in"></div>


<div id="alertaProporcion" class="alerta-proporcion fade-in"></div>
<div id="tablaComparativa" class="fade-in"></div>
<div id="conclusionEducativa" class="leyenda fade-in"></div>



  <canvas id="graficoBarras" class="fade-in"></canvas>
  <canvas id="graficoGenotipos" class="fade-in"></canvas>
  <button class="btn" onclick="exportarResultado()">📸 Descargar Resultado</button>

  <h3>🧪 Preguntas para Reflexionar</h3>
<div id="preguntasReflexion" style="font-size: 1rem; margin-bottom: 1rem;"></div>


  <h3>✍️ Tus Respuestas</h3>
  <textarea placeholder="Escribe tu análisis sobre el fenotipo más frecuente..."></textarea>
  <textarea placeholder="Escribe tu interpretación sobre la proporción fenotípica obtenida..."></textarea>
  <textarea placeholder="¿Qué observas si uno de los progenitores es homocigoto recesivo?..."></textarea>
</div>
  <script>
    let chart, chartBar, chartGen;
    let ultimaFrecuencia = {}, ultimoGenotipo = {};

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      if (chart || chartBar || chartGen) {
        if (chart) chart.destroy();
        if (chartBar) chartBar.destroy();
        if (chartGen) chartGen.destroy();
        generarGrafico(ultimaFrecuencia, ultimoGenotipo);
      }
    }

    function obtenerFenotipo(genotipo) {
      const B = genotipo.includes('B');
      const E = genotipo.includes('E');
      let color = B ? 'Negro' : 'Blanco';
      let orejas = E ? 'Orejas grandes' : 'Orejas pequeñas';
      return `${color} con ${orejas}`;
    }

    function obtenerGametas(genotipo) {
      const alelo1 = [genotipo[0], genotipo[1]];
      const alelo2 = [genotipo[2], genotipo[3]];
      const gametas = [];
      for (let a1 of alelo1) {
        for (let a2 of alelo2) {
          gametas.push(a1 + a2);
        }
      }
      return gametas;
    }

    function ordenarAlelos(genes) {
      const ordenar = (a, b) => {
        const mayusculas = [a, b].filter(l => l === l.toUpperCase()).sort();
        const minusculas = [a, b].filter(l => l === l.toLowerCase()).sort();
        return [...mayusculas, ...minusculas].join('');
      };
      return ordenar(genes[0], genes[1]) + ordenar(genes[2], genes[3]);
    }

    function asignarColor(fenotipo) {
      const colores = {
        "Negro con Orejas grandes": "#A3E4D7",
        "Negro con Orejas pequeñas": "#F7DC6F",
        "Blanco con Orejas grandes": "#AED6F1",
        "Blanco con Orejas pequeñas": "#F5B7B1"
      };
      return colores[fenotipo] || "#ffffff";
    }

    function detectarProporcionClasica(frecuencias) {
      const valores = Object.values(frecuencias).sort((a, b) => b - a);
      const total = valores.reduce((a, b) => a + b, 0);
      const proporciones = valores.map(v => Math.round((v / total) * 16));
      const texto = proporciones.join(':');
      return texto === "9:3:3:1" ? texto + " (Mendeliana clásica)" : texto;
    }

  function generarGrafico(frecuencias, genotipos) {
  ultimaFrecuencia = frecuencias;
  ultimoGenotipo = genotipos;

  const ctx = document.getElementById('graficoFenotipos').getContext('2d');
  const ctxBar = document.getElementById('graficoBarras').getContext('2d');
  const ctxGen = document.getElementById('graficoGenotipos').getContext('2d');

  if (chart) chart.destroy();
  if (chartBar) chartBar.destroy();
  if (chartGen) chartGen.destroy();

  // 🎨 Diccionario fijo de colores por fenotipo
  const colorFenotipoFijo = {
  "Negro con Orejas grandes": "#A3E4D7",    // Verde menta suave
  "Negro con Orejas pequeñas": "#FCF3CF",  // Amarillo pastel
  "Blanco con Orejas grandes": "#AED6F1",  // Azul celeste claro
  "Blanco con Orejas pequeñas": "#F9C8D9", // Rosa suave
  // Puedes agregar más si aparecen nuevos fenotipos:
  "Otro fenotipo 1": "#D7BDE2",            // Lavanda
  "Otro fenotipo 2": "#FAD7A0",            // Durazno
  "Otro fenotipo 3": "#D5DBDB"             // Gris perla

  };

  const obtenerColorFenotipo = (fenotipo) => {
    return colorFenotipoFijo[fenotipo] || "#CCCCCC"; // Gris si no está definido
  };

  const etiquetasFenotipos = Object.keys(frecuencias);
  const datosFenotipos = Object.values(frecuencias);
  const coloresFenotipos = etiquetasFenotipos.map(f => obtenerColorFenotipo(f));

  // ===================== GRAFICO DOUGHNUT =====================
  chart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: etiquetasFenotipos,
      datasets: [{
        data: datosFenotipos,
        backgroundColor: coloresFenotipos,
        borderColor: '#ffffff',
        borderWidth: 2
      }]
    },
    options: {
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: document.body.classList.contains('dark-mode') ? '#ffffff' : '#000000'
          }
        },
        datalabels: {
          color: '#000',
          font: { weight: 'bold', size: 14 },
          formatter: (value, context) => {
            const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
            const percentage = ((value / total) * 100).toFixed(2);
            return `${value} (${percentage}%)`;
          }
        }
      },
      responsive: true
    },
    plugins: [ChartDataLabels]
  });

  // ===================== GRAFICO DE BARRAS FENOTIPOS =====================
  chartBar = new Chart(ctxBar, {
    type: 'bar',
    data: {
      labels: etiquetasFenotipos,
      datasets: [{
        label: 'Frecuencia',
        data: datosFenotipos,
        backgroundColor: coloresFenotipos,
        borderColor: '#ffffff',
        borderWidth: 2,
        borderRadius: 10
      }]
    },
    options: {
      plugins: {
        legend: { display: false }
      },
      interaction: {
        mode: 'index',
        intersect: false
      },
      hover: {
        mode: 'index',
        intersect: false
      },
      scales: {
        x: {
          ticks: {
            color: document.body.classList.contains('dark-mode') ? '#ffffff' : '#000000'
          }
        },
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1,
            color: document.body.classList.contains('dark-mode') ? '#ffffff' : '#000000'
          }
        }
      }
    }
  });

  // ===================== GRAFICO DE GENOTIPOS =====================
  function generarColoresPastel(cantidad) {
    const colores = [];
    const hueStep = 360 / cantidad;
    for (let i = 0; i < cantidad; i++) {
      const hue = i * hueStep;
      colores.push(`hsl(${hue}, 60%, 75%)`);
    }
    return colores;
  }

  const genotipoLabels = Object.keys(genotipos);
  const genotipoData = Object.values(genotipos);
  const genotipoColores = generarColoresPastel(genotipoLabels.length);

  chartGen = new Chart(ctxGen, {
    type: 'bar',
    data: {
      labels: genotipoLabels,
      datasets: [{
        label: 'Genotipos',
        data: genotipoData,
        backgroundColor: genotipoColores,
        borderColor: '#ffffff',
        borderWidth: 2,
        borderRadius: 8
      }]
    },
    options: {
      plugins: {
        legend: { display: false },
        datalabels: {
          anchor: 'end',
          align: 'top',
          color: document.body.classList.contains('dark-mode') ? '#ffffff' : '#333333',
          font: { weight: 'bold' }
        }
      },
      interaction: {
        mode: 'index',
        intersect: false
      },
      hover: {
        mode: 'index',
        intersect: false
      },
      scales: {
        x: {
          ticks: {
            color: document.body.classList.contains('dark-mode') ? '#ffffff' : '#000000'
          }
        },
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1,
            color: document.body.classList.contains('dark-mode') ? '#ffffff' : '#000000'
          }
        }
      }
    },
    plugins: [ChartDataLabels]
  });

  // ===================== TEXTO DE PROPORCIÓN =====================
  const proporcion = Object.entries(frecuencias)
    .map(([fenotipo, valor]) => `${valor} ${fenotipo}`)
    .join(', ');
  const proporcionCl = detectarProporcionClasica(frecuencias);
  document.getElementById("proporcionTexto").innerHTML = `<strong>Proporción fenotípica obtenida:</strong> ${proporcion}.<br><strong>Proporción clásica aproximada:</strong> ${proporcionCl}`;

  // Reinicia animaciones fade-in
  ['graficoFenotipos', 'graficoBarras', 'graficoGenotipos'].forEach(id => {
    const el = document.getElementById(id);
    el.classList.remove('fade-in');
    void el.offsetWidth;
    el.classList.add('fade-in');
  });
}

function cruzar(g1, g2) {
  const gam1 = obtenerGametas(g1);
  const gam2 = obtenerGametas(g2);

  let html = '<table><tr><th></th>';
  gam2.forEach(g => html += `<th>${g}</th>`);
  html += '</tr>';

  let frec = {}, genotipos = {}, combinaciones = [];
  let mutaciones = 0, sinCambioFenotipo = 0, fenotiposPrevios = new Set();
  const mutacionesFenotipos = [];

  gam1.forEach(gm1 => {
    html += `<tr><th>${gm1}</th>`;
    gam2.forEach(gm2 => {
      let genesOriginal = ordenarAlelos([gm1[0], gm2[0], gm1[1], gm2[1]]);
      let genes = genesOriginal;
      let fueMutado = false;

      if (document.getElementById("activarMutaciones").checked) {
        const alelos = genes.split('');
        const idx = Math.floor(Math.random() * alelos.length);

        if (Math.random() < 0.1) {
          alelos[idx] = alelos[idx] === alelos[idx].toUpperCase()
            ? alelos[idx].toLowerCase()
            : alelos[idx].toUpperCase();
          genes = ordenarAlelos(alelos);
          fueMutado = true;
          mutaciones++;
        }
      }

      const fenotipo = obtenerFenotipo(genes);
      frec[fenotipo] = (frec[fenotipo] || 0) + 1;
      genotipos[genes] = (genotipos[genes] || 0) + 1;

      const color = asignarColor(fenotipo);
      const icono = fueMutado ? ' 🔬' : '';
      const estilo = fueMutado ? 'border: 3px solid red;' : '';

      if (fueMutado) {
        const fenotipoOriginal = obtenerFenotipo(genesOriginal);
        if (fenotipoOriginal === fenotipo) {
          sinCambioFenotipo++;
        } else {
          mutacionesFenotipos.push(`🧬 ${genesOriginal} → 🔬 ${genes} (${fenotipoOriginal} → ${fenotipo})`);
        }
      }

      // 🔹 Clase agregada aquí: celda-punnett
      html += `<td class="celda-punnett" style="background-color:${color};${estilo}">
                  <strong>${genes}</strong>${icono}<br>${fenotipo}
              </td>`;
    });
    html += '</tr>';
  });

  html += '</table>';

  if (document.getElementById("activarMutaciones").checked) {
    const explicacion = `
      <strong>🔬 Mutaciones aplicadas:</strong> ${mutaciones}<br>
      <strong>🟢 Sin cambio de fenotipo:</strong> ${sinCambioFenotipo}<br>
      <strong>🔄 Con cambio fenotípico:</strong> ${mutaciones - sinCambioFenotipo}<br>
      ${mutacionesFenotipos.length > 0 ? '<br><u>🔍 Detalles:</u><br>' + mutacionesFenotipos.join('<br>') : ''}
    `;
    document.getElementById("explicacionMutaciones").innerHTML = explicacion;
  } else {
    document.getElementById("explicacionMutaciones").innerHTML = '';
  }

  generarGrafico(frec, genotipos);
  mostrarAlertaYComparacion(frec, mutaciones - sinCambioFenotipo);
  generarPreguntasReflexion(frec, mutaciones - sinCambioFenotipo);
  return html;
}

   function generarCuadro() {
  const gen1 = document.getElementById("gen1").value;
  const gen2 = document.getElementById("gen2").value;
  const f1 = obtenerFenotipo(gen1);
  const f2 = obtenerFenotipo(gen2);

  document.getElementById("fenotipo1").innerHTML = `🧬 <strong>${f1}</strong>`;
  document.getElementById("fenotipo2").innerHTML = `🧬 <strong>${f2}</strong>`;
  document.getElementById("cuadro").innerHTML = cruzar(gen1, gen2);
}

function asignarColor(fenotipo) {
  const colores = {
    "Negro con Orejas grandes": "#A3E4D7",
    "Negro con Orejas pequeñas": "#F7DC6F",
    "Blanco con Orejas grandes": "#AED6F1",
    "Blanco con Orejas pequeñas": "#F5B7B1"
  };
  return colores[fenotipo] || "#ffffff";
}

// Modificación para visibilidad del texto en modo oscuro y claro
document.querySelectorAll('.celda-punnett').forEach(celda => {
  celda.style.color = '#222'; // Texto oscuro para fondo pastel
});
    function actualizarFenotipos() {
      const gen1 = document.getElementById("gen1").value;
      const gen2 = document.getElementById("gen2").value;
      document.getElementById("fenotipo1").innerHTML = `🧬 <strong>${obtenerFenotipo(gen1)}</strong>`;
      document.getElementById("fenotipo2").innerHTML = `🧬 <strong>${obtenerFenotipo(gen2)}</strong>`;
    }

    function exportarResultado() {
      const contenedor = document.getElementById('contenedorExportable');
      html2canvas(contenedor, { backgroundColor: "#ffffff", scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'resultado_dihibrido.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    }

    function reiniciarSimulador() {
      document.getElementById("gen1").selectedIndex = 3;
      document.getElementById("gen2").selectedIndex = 7;
      document.getElementById("cuadro").innerHTML = "";
      document.getElementById("fenotipo1").innerText = "Fenotipo: -";
      document.getElementById("fenotipo2").innerText = "Fenotipo: -";
      document.getElementById("proporcionTexto").innerHTML = "";
      if (chart) chart.destroy();
      if (chartBar) chartBar.destroy();
      if (chartGen) chartGen.destroy();
      actualizarFenotipos();
    }

    window.onload = () => actualizarFenotipos();
  
 function mostrarAlertaYComparacion(frecuencias, mutacionesAplicadas) {
  const gen1 = document.getElementById("gen1").value;
  const gen2 = document.getElementById("gen2").value;
  const gam1 = obtenerGametas(gen1);
  const gam2 = obtenerGametas(gen2);

  const fenotiposEsperados = {};

  gam1.forEach(gm1 => {
    gam2.forEach(gm2 => {
      const genes = ordenarAlelos([gm1[0], gm2[0], gm1[1], gm2[1]]);
      const fenotipo = obtenerFenotipo(genes);
      fenotiposEsperados[fenotipo] = (fenotiposEsperados[fenotipo] || 0) + 1;
    });
  });

  const totalEsperado = Object.values(fenotiposEsperados).reduce((a, b) => a + b, 0);
  const totalObservado = Object.values(frecuencias).reduce((a, b) => a + b, 0);

  // Normalizar esperados proporcionalmente si hubo mutaciones
  if (totalEsperado !== totalObservado) {
    Object.keys(fenotiposEsperados).forEach(f => {
      fenotiposEsperados[f] = Math.round((fenotiposEsperados[f] / totalEsperado) * totalObservado);
    });
  }

  // Construir tabla comparativa
  const todosFenotipos = new Set([...Object.keys(fenotiposEsperados), ...Object.keys(frecuencias)]);
  let tabla = `
    <table style="margin-top:10px;border-collapse: collapse; width: 100%;">
      <thead>
        <tr style="background:#eaeaea;">
          <th style="border:1px solid #ccc;padding:5px;">Fenotipo</th>
          <th style="border:1px solid #ccc;padding:5px;">Esperado</th>
          <th style="border:1px solid #ccc;padding:5px;">Observado</th>
        </tr>
      </thead>
      <tbody>
  `;

  todosFenotipos.forEach(f => {
    tabla += `
      <tr>
        <td style="border:1px solid #ccc;padding:5px;">${f}</td>
        <td style="border:1px solid #ccc;padding:5px;text-align:center;">${fenotiposEsperados[f] || 0}</td>
        <td style="border:1px solid #ccc;padding:5px;text-align:center;">${frecuencias[f] || 0}</td>
      </tr>
    `;
  });

  tabla += '</tbody></table>';

  // Mostrar alerta solo si hay mutaciones que cambiaron fenotipo
  const alerta = mutacionesAplicadas > 0 ? `
    <strong>⚠️ ¡Atención!</strong> La proporción fenotípica fue alterada por mutaciones.<br>
    Se observó la aparición de nuevos fenotipos que no estaban en la proporción original.
  ` : '';

  // Conclusión educativa automática
  const conclusion = mutacionesAplicadas > 0 ? `
    <strong>🔍 Conclusión:</strong> ${mutacionesAplicadas === 1 ? 'Una' : mutacionesAplicadas} mutación${mutacionesAplicadas > 1 ? 'es' : ''} alteró la proporción esperada.<br>
    Esto demuestra cómo <strong>mutaciones aleatorias pueden influir significativamente en la variabilidad genética</strong>, afectando la distribución fenotípica resultante del cruce.
  ` : '';

  // Mostrar resultados
  document.getElementById("alertaProporcion").innerHTML = alerta;
  document.getElementById("tablaComparativa").innerHTML = tabla;
  document.getElementById("conclusionEducativa").innerHTML = conclusion;
}

  function generarPreguntasReflexion(frecuencias, mutacionesAplicadas) {
  const total = Object.values(frecuencias).reduce((a, b) => a + b, 0);
  const maxFenotipo = Object.entries(frecuencias).reduce((a, b) => b[1] > a[1] ? b : a)[0];
  const cantidadFenotipos = Object.keys(frecuencias).length;
  const proporcionCl = detectarProporcionClasica(frecuencias);
  const gen1 = document.getElementById("gen1").value;
  const gen2 = document.getElementById("gen2").value;
  const preguntas = [];

  preguntas.push(`🧪 <strong>¿Cuál fue el fenotipo más frecuente?</strong><br>➡️ ${maxFenotipo}`);

  if (cantidadFenotipos === 1) {
    preguntas.push("🧪 <strong>¿Por qué crees que solo apareció un fenotipo en todos los descendientes?</strong>");
  } else {
    preguntas.push("🧪 <strong>¿Qué factores explican la presencia de varios fenotipos diferentes?</strong>");
  }

  if (proporcionCl.includes("Mendeliana clásica")) {
    preguntas.push("🧪 <strong>¿Este cruce refleja una proporción mendeliana clásica (9:3:3:1)? ¿Por qué?</strong>");
  } else {
    preguntas.push("🧪 <strong>¿Este cruce se desvía de la proporción clásica esperada? ¿Qué lo pudo causar?</strong>");
  }

  if (mutacionesAplicadas > 0) {
    preguntas.push("🧪 <strong>¿Cómo influye la presencia de mutaciones en los resultados del cruce?</strong>");
  }

  if ((gen1.includes("bb") || gen1.includes("ee")) || (gen2.includes("bb") || gen2.includes("ee"))) {
    preguntas.push("🧪 <strong>¿Qué efectos observas cuando uno de los progenitores es homocigoto recesivo?</strong>");
  } else {
    preguntas.push("🧪 <strong>¿Cómo cambiarían los resultados si uno de los progenitores fuera homocigoto recesivo?</strong>");
  }

  // Mostrar preguntas en el contenedor
  const html = preguntas.map(p => `<li>${p}</li>`).join('');
  document.getElementById("preguntasReflexion").innerHTML = `<ul style="margin-top:10px">${html}</ul>`;
}

  
  </script>



</body>
</html>
